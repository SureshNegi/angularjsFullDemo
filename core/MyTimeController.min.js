angular.module("MyTimeApp").controller("loginCtrl",["$rootScope","$scope","loginService","$state","loadRevenueMonthsServices","$filter","constantService","$modal","$cookieStore","$interval","maintenanceService","$timeout",function(e,t,a,r,n,i,s,o,l,c,d,p){function u(t){e.errorLogMethod("loginCtrl.getCookie");for(var a=t+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(a))return i.substring(a.length,i.length)}return""}t.username=u("savedUsername"),t.password="",t.message="",t.previousUsername="",t.isUsernameSaved=u("savedUsername").length>0,t.lockMessage="Your username and password are the same as your network username and password. Your network account will be locked after ##count## more unsuccessful login attempt##s##. If you need assistance please contact the service desk.",t.lockedAccountMessage="Your username and password are the same as your network username and password. Your network account is now locked. You must wait 10 minutes before you can try to access your account again. If you need assistance please contact the service desk.",t.loginNote="Login using your network username and password.",t.clientType="iPhone",t.defaultPassword="mercer",t.nonADPassError="Access Denied. Please change your password on the desktop version of myTime.",t.applicationVersion=s.APPVERSION,null!=localStorage.getItem("Initial_Data")&&(e.displayUsername=JSON.parse(localStorage.getItem("Initial_Data")).EMPL_REC.FNAME+" "+JSON.parse(localStorage.getItem("Initial_Data")).EMPL_REC.LNAME),t.sessionExpire="",t.enableLoginFlag=!0,isMobile={BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},BB:function(){return navigator.userAgent.match(/BB/)},iPhone:function(){return navigator.userAgent.match(/iPhone/i)},iPad:function(){return navigator.userAgent.match(/iPad/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},t.getClientType=function(){return isMobile.iPhone()?"iPhone":isMobile.iPad()?"iPad":isMobile.BlackBerry()?"BlackBerry":isMobile.BB()?"BlackBerry":"Other"},t.IsValue=function(){e.errorLogMethod("loginCtrl.scope.IsValue"),""!=t.username&""!=t.password?(t.enableLoginFlag=!1,$("#loginbtn").removeAttr("disabled")):(t.enableLoginFlag=!0,$("#loginbtn").attr("disabled",!0))},t.resetField=function(){t.username="",t.IsValue()},t.checkDisable=function(){return e.errorLogMethod("loginCtrl.scope.checkDisable"),t.enableLoginFlag},t.getVersion=function(){return"Version: "+s.APPVERSION},t.rememberUsername=function(){e.errorLogMethod("loginCtrl.scope.rememberUsername"),$("#rmembrChck").is(":checked")||(document.cookie="savedUsername=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")};t.loadRevenueMonths=function(){e.errorLogMethod("loginCtrl.scope.loadRevenueMonths");var t=new Date;t=i("date")(t,"yyyy-MM-dd");var a=e.GetLoginDetail(!1,!0);n.loadRevenueMonths(a.SESKEY,t,function(e){var t=e.LOADREVM_OUT_OBJ.REVM_ARR;localStorage.setItem("Revenue_Months",JSON.stringify(t))})},t.login=function(){e.errorLogMethod("loginCtrl.scope.login"),e.expandedEntries=[],e.collapsedEntries=[],e.cntrExpandCollapse=0;var n=escape(t.username);if(e.globals=l.get("globals")||{},null!=localStorage.getItem("isLoggedIn")&&"true"==localStorage.getItem("isLoggedIn")&&null!=localStorage.getItem("Login_Detail")&&e.globals.currentUser&&e.globals.currentUser.username.toLowerCase()!=n.toLowerCase())t.message="Can not proceed further as another user is already logged in.";else{a.ClearCredentials(),e.ClearLocalStorage(!0);var i=0;null!=localStorage.getItem(t.username+"_attempts")&&(i=localStorage.getItem(t.username+"_attempts")),localStorage.setItem(t.username+"_attempts",i);var s=escape(navigator.userAgent);s=s.substring(0,100),a.login(n,t.password,t.getClientType(),t.applicationVersion,s,function(o){if(e.displayUsername=t.username,t.nonStepupMsg="",t.message="",4==parseInt(o.LOGIN_OUT_OBJ.RETCD))d.maintenanceNotification(o.LOGIN_OUT_OBJ.ERRMSG);else if(0==parseInt(o.LOGIN_OUT_OBJ.RETCD))localStorage.removeItem(t.username+"_attempts"),localStorage.setItem("Login_Detail",JSON.stringify(o.LOGIN_OUT_OBJ)),t.LOGIN_OUT_OBJ=o.LOGIN_OUT_OBJ,a.retrieveInitialData(o.LOGIN_OUT_OBJ.SESKEY,o.LOGIN_OUT_OBJ.EMPLID).then(function(i){var l=angular.lowercase(t.password)==t.defaultPassword;if(l||0!=parseInt(i.RETINIT_OUT_OBJ.RETCD))""!=i.RETINIT_OUT_OBJ.ERRMSG.trim()?t.nonStepupMsg=i.RETINIT_OUT_OBJ.ERRMSG:l&&(t.message=t.nonADPassError,a.logout(o.LOGIN_OUT_OBJ.SESKEY,s,function(t){e.ClearLocalStorage(!0)}));else{localStorage.setItem("Initial_Data",JSON.stringify(i.RETINIT_OUT_OBJ)),localStorage.removeItem("Revenue_Months"),t.loadRevenueMonths(),localStorage.setItem("InitialRev_Month",JSON.stringify(i.RETINIT_OUT_OBJ));new Date(i.RETINIT_OUT_OBJ.REVM_REC.STRTDTE),new Date(i.RETINIT_OUT_OBJ.REVM_REC.ENDDTE),new Date;if("Y"==e.GetInitialDetail(!1,!0).COMP_REC.LCKSTAT)e.ClearLocalStorage(!0),t.message="Time Recording is not available at this time.";else{if($("#rmembrChck").is(":checked")){var c=new Date;c.setTime(c.getTime()+31536e6),document.cookie="savedUsername ="+t.username+";expires="+c.toUTCString()}else document.cookie="savedUsername=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";a.SetCredentials(n,t.password),localStorage.setItem("isLoggedIn","true"),navigator.userAgent.match(/BB/i)||navigator.userAgent.match(/BlackBerry/i)?p(function(){r.go("Main")},1250):p(function(){r.go("Main")},500)}}});else if(""!=o.LOGIN_OUT_OBJ.ERRMSG.trim()){var l=o.LOGIN_OUT_OBJ.ERRMSG.toLowerCase().indexOf("[52e]")>-1,c=o.LOGIN_OUT_OBJ.ERRMSG.toLowerCase().indexOf("[775]")>-1,u=localStorage.getItem(t.username+"_attempts"),E=parseInt(u);l&&(E=parseInt(i)+1),localStorage.removeItem(t.username+"_attempts"),localStorage.setItem(t.username+"_attempts",E);var C=t.lockMessage;c?(localStorage.removeItem(t.username+"_attempts"),localStorage.setItem(t.username+"_attempts",0),t.message=t.lockedAccountMessage):1==E&&l?t.message=C.replace("##count##","5").replace("##s##","s"):2==E&&l?t.message=C.replace("##count##","4").replace("##s##","s"):3==E&&l?t.message=C.replace("##count##","3").replace("##s##","s"):4==E&&l?t.message=C.replace("##count##","2").replace("##s##","s"):5==E&&l?t.message=C.replace("##count##","1").replace("##s##",""):6==E&&l?(localStorage.removeItem(t.username+"_attempts"),localStorage.setItem(t.username+"_attempts",0),t.message=t.lockedAccountMessage):t.message=o.LOGIN_OUT_OBJ.ERRMSG}})}},t.logout=function(){var t=escape(navigator.userAgent);t=t.substring(0,100),e.isPanelOpen=!1,e.isCallAtInterval=!1,e.expandedEntries=[],e.collapsedEntries=[],e.cntrExpandCollapse=0,c.cancel(e.callBroadcastAtInterval),c.cancel(e.callMonthEndAtIntervalMobile),e.isCallBroadcastAtInterval=!1,e.errorLogMethod("loginCtrl.scope.logout");var n=e.GetLoginDetail(!0,!0);a.ClearCredentials(),a.logout(n.SESKEY,t,function(t){parseInt(t.LOGOUT_OUT_OBJ.RETCD),e.ClearLocalStorage(!0),r.go("login")})},t.$on("sessionExpire",function(t,a){e.isTimeOut&&(e.isTimeOut=!1,r.go("login"))}),t.$on("maintenanceNotificationBroadcast",function(t,a){e.errorLogMethod("loginCtrl.scope.$on.maintenanceNotificationBroadcast");var r=a.value;d.maintenanceNotification(r)}),t.sessionExpireOk=function(){e.isTimeOut||E(),e.isTimeOut=!1,r.go("login")},t.sessionExpireInit=function(){angular.element(document.getElementsByClassName("modal-dialog")).addClass("positionTop"),angular.element(document.getElementsByClassName("modal-content")).addClass("mcontent"),e.isTimeOut?(t.sessionExpire=i("translate")("msg_SessionExpire"),e.isCallAtInterval=!1,E()):(e.isCallAtInterval=!1,t.sessionExpire=i("translate")("msg_SessionInvalid"))};var E=function(){var t=escape(navigator.userAgent);t=t.substring(0,100),e.isPanelOpen=!1,e.errorLogMethod("loginCtrl.scope.logout");var r=e.GetLoginDetail(!0,!1);null!=r&&(c.cancel(e.callBroadcastAtInterval),c.cancel(e.callMonthEndAtIntervalMobile),e.isCallBroadcastAtInterval=!1,a.ClearCredentials(),a.logout(r.SESKEY,t,function(t){parseInt(t.LOGOUT_OUT_OBJ.RETCD),e.ClearLocalStorage(!0)}))}}]).controller("Preference",["$rootScope","$scope","$modalInstance","$state","selectedData","preferencesService","$filter","loginService",function(e,t,a,r,n,i,s,o){t.popUpName="Preference",t.selectedData=n,t.ok=function(){e.errorLogMethod("Preference.$scope.ok"),a.close()},t.isfocus=!1,t.cancel=function(){e.errorLogMethod("Preference.$scope.cancel"),a.dismiss("cancel")},t.setFocus=function(){isfocus=!0},t.view={selected:null,list:[]},t.language={selected:null,list:[]},t.detail={selected:null,list:[]};var l=function(e,t){for(var a=[],r=0;r<t.length;r++){var n=$.grep(e,function(e){return e.KEY==t[r]});a.push(n)}return a},c=function(e,t){var a=[];if(null!=e&&void 0!=e){if("[object Array]"!=Object.prototype.toString.call(e)){var r=e;(e=[]).push({KEY:r.PREF_OBJ.KEY,VAL:r.PREF_OBJ.VAL})}for(var n=0;n<t.length;n++){var i=angular.fromJson(e).filter(function(e){if(null!=e&&e.KEY==t[n])return!0});void 0!=i&&null!=i&&i.length>0&&a.push({KEY:i[0].KEY,VAL:i[0].VAL})}}return a},d=function(e,t){var e=angular.lowercase(e);return"lang"==t?Number(e.indexOf("fr_ca"))>=Number(0)?s("translate")("lbl_French"):s("translate")("lbl_English"):"view"==t?e.indexOf("week")<0?s("translate")("lbl_Daily"):s("translate")("lbl_Weekly"):"prefDetail"==t?Number(e.indexOf("collapsed"))>=Number(0)?s("translate")("lbl_Collapsed"):s("translate")("lbl_Expanded"):void 0};t.init=function(){e.errorLogMethod("Preference.$scope.init"),t.loginDetail=e.GetLoginDetail(!1,!0);var a=["INITIAL_TAB","INITIAL_DETAIL"];if(void 0!=t.loginDetail){var r=null;o.retrieveInitialData(t.loginDetail.SESKEY,t.loginDetail.EMPLID).then(function(e){0==parseInt(e.RETINIT_OUT_OBJ.RETCD)&&(r=c(e.RETINIT_OUT_OBJ.PREF_ARR,a)),i.loadGlobalPreferences(t.loginDetail.SESKEY).then(function(e){if(0==parseInt(e.GLBPREF_OUT_OBJ.RETCD)){var n=l(e.GLBPREF_OUT_OBJ.GLBPREF,a);if(n.length>0)for(var i=0;i<n.length;i++)if(n[i].length>0){var s=n[i];switch(i){case 0:for(var o=c(r,[a[0]])[0],p=0;p<s[0].KEYVAL_ARR.length;p++)s[0].KEYVAL_ARR[p].KEYVALDESC=d(s[0].KEYVAL_ARR[p].KEYVAL,"view"),t.view.list.push(s[0].KEYVAL_ARR[p]),null==t.view.selected&&(void 0!=o&&null!=o?angular.uppercase(s[0].KEYVAL_ARR[p].KEYVAL)==angular.uppercase(o.VAL)&&(t.view.selected=s[0].KEYVAL_ARR[p].KEYVAL):"Y"==angular.uppercase(s[0].KEYVAL_ARR[p].DEF)&&(t.view.selected=s[0].KEYVAL_ARR[p].KEYVAL));break;case 1:for(var o=c(r,[a[1]])[0],p=0;p<s[0].KEYVAL_ARR.length;p++)s[0].KEYVAL_ARR[p].KEYVALDESC=d(s[0].KEYVAL_ARR[p].KEYVAL,"prefDetail"),t.detail.list.push(s[0].KEYVAL_ARR[p]),null==t.detail.selected&&(void 0!=o&&null!=o?angular.uppercase(s[0].KEYVAL_ARR[p].KEYVAL)==angular.uppercase(o.VAL)&&(t.detail.selected=s[0].KEYVAL_ARR[p].KEYVAL):"Y"==angular.uppercase(s[0].KEYVAL_ARR[p].DEF)&&(t.detail.selected=s[0].KEYVAL_ARR[p].KEYVAL))}}}})})}},t.save=function(){var e={KEY:"INITIAL_TAB",VAL:t.view.selected},a={KEY:"INITIAL_DETAIL",VAL:t.detail.selected};(n=[]).push(e),n.push(a);var r={PREF_OBJ:n},n=JSON.stringify(r);i.savePreferences(t.loginDetail.SESKEY,n).then(function(e){t.ok()})}}]).controller("ErrorPopup",["$rootScope","$scope","$modalInstance","$state","selectedData",function(e,t,a,r,n){t.popUpName="ErrorPopup",t.selectedData=n,t.isCancelBtnOn=n.isCancelBtnOn,t.ok=function(){e.errorLogMethod("ErrorPopup.$scope.ok"),a.close()},t.cancel=function(){e.errorLogMethod("ErrorPopup.$scope.cancel"),a.dismiss("cancel")},t.isError=!1,t.message="",t.init=function(){var a=[];e.errorLogMethod("ErrorPopup.$scope.init"),angular.element(document.getElementsByClassName("modal-dialog")).addClass("positionTop"),angular.element(document.getElementsByClassName("modal-content")).addClass("mcontent"),t.isError=t.selectedData.isError,"[object Array]"!==Object.prototype.toString.call(t.selectedData.message)?a[0]=t.selectedData.message:a=t.selectedData.message,t.message=a}}]).controller("ConfirmMessage",["$rootScope","$scope","$modalInstance","$state","selectedData",function(e,t,a,r,n){t.popUpName="ConfirmMessage",t.selectedData=n,t.isCancelBtnOn=n.isCancelBtnOn,t.ok=function(){e.errorLogMethod("ConfirmMessage.$scope.ok"),a.close()},t.cancel=function(){e.errorLogMethod("ConfirmMessage.$scope.cancel"),a.dismiss("cancel")},t.isError=!1,t.message="",t.init=function(){e.errorLogMethod("ConfirmMessage.$scope.init"),angular.element(document.getElementsByClassName("modal-dialog")).addClass("positionTop"),t.isError=t.selectedData.isError,t.message=t.selectedData.message,t.isDailyModeOption=t.selectedData.isDailyModeOption}}]).controller("DescriptionCtrl",["$rootScope","$filter","$scope","$modalInstance","cepService","$state","selectedData","$window","commonUtilityService",function(e,t,a,r,n,i,s,o,l){a.popUpName="Description",a.hideValidation=!0,a.hideLngValidMsg=!0,a.maxCharLen=200,a.valdMsg="",a.LngvaldMsg="",a.domainURL="",a.loginDetail=null,a.initialDetail=null,a.description=[],a.descriptionList=[],a.ok=function(e){var t=JSON.parse(e),e={data:t.data,fav:!!a.selectedData.IsActivity&&t.fav};r.close(e)},a.defDesc="",a.selectedData=s,a.favDesc=!1,a.cancel=function(){e.errorLogMethod("DescriptionCtrl.$scope.cancel"),r.dismiss("cancel")},a.init=function(){a.valdMsg=t("translate")("msg_DesRequired"),a.LngvaldMsg="Description must be between 1 and 200 characters.",e.errorLogMethod("DescriptionCtrl.$scope.init"),a.domainURL=e.domainURL,a.loginDetail=e.GetLoginDetail(!1,!0),a.initialDetail=e.GetInitialDetail(!1,!0),a.defDesc=null==a.selectedData.desc?"":a.selectedData.desc,null!=a.selectedData.desc&&a.setFav(a.selectedData.desc),a.getFavDescription()},a.getFavDescription=function(){e.errorLogMethod("DescriptionCtrl.$scope.getFavDescription"),a.descriptionList=[];var t=localStorage.getItem("DescFav");if(""==t||null==t)n.retrieveDescriptionFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID).then(function(e){if(0==e.RETDESCFAV_OUT_OBJ.RETCD){if("[object Array]"!=Object.prototype.toString.call(e.RETDESCFAV_OUT_OBJ.DESTXT_ARR)){var t=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR;e.RETDESCFAV_OUT_OBJ.DESTXT_ARR=[],null!=t&&void 0!=t.VARCHAR2&&e.RETDESCFAV_OUT_OBJ.DESTXT_ARR.push(t.VARCHAR2)}a.description=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR,a.description.length>0&&a.description.sort();for(var r=0;r<a.description.length;r++){var n={data:a.description[r],fav:!0};a.descriptionList.push(n)}0==a.descriptionList.length?angular.element(document.getElementById("divNoRecord")).show():angular.element(document.getElementById("divNoRecord")).hide()}localStorage.setItem("DescFav",JSON.stringify(a.description))});else{a.description=JSON.parse(t),a.description.length>0&&a.description.sort();for(var r=0;r<a.description.length;r++){var i={data:a.description[r],fav:!0};a.descriptionList.push(i)}0==a.descriptionList.length?angular.element(document.getElementById("divNoRecord")).show():angular.element(document.getElementById("divNoRecord")).hide()}},a.rowSelected=function(t){if(e.errorLogMethod("DescriptionCtrl.$scope.rowSelected"),a.selectedData.IsActivity)a.favDesc=t.fav,a.sendDescBack(t);else{angular.element(document.getElementById("defDesc")).val(t.data).trigger("input"),angular.element(document.getElementById("btnOk")).focus();for(var r=!0,n=0;n<a.description.length;n++)if(t.data==a.description[n]){a.favDesc=!0,r=!1;break}r&&(a.favDesc=!1)}},a.sendDescBack=function(t){e.errorLogMethod("DescriptionCtrl.$scope.sendDescBack"),null!=t.data&&""!=t.data.trim()&&a.ok(JSON.stringify(t))},a.sendDesc=function(t){if(e.errorLogMethod("DescriptionCtrl.$scope.sendDesc"),null!=t&&""!=t.trim()){if(t.length>200)return a.hideLngValidMsg=!1,void(a.hideValidation=!0);var r={data:t,fav:a.favDesc};a.ok(JSON.stringify(r))}else a.hideValidation=!1,a.hideLngValidMsg=!0};var c=function(e){var t="",a=e;try{a=a.replace("⛔",""),a=a.replace("☺️",""),a=a.replace("☹️",""),a=a.replace("✊",""),a=a.replace("✌️",""),a=a.replace("✋",""),a=a.replace("☝️","");var r=(a=a.replace(/✍️|❤️|✍|⛹|⚓️|⛪️|⛴|⛺️|✈️|☹/g,"")).split(/([\uD800-\uDBFF][\uDC00-\uDFFF])/);a="";for(var n=0;n<r.length;n++)if(""!==(t=r[n])){var i=t.split(/([\uD800-\uDBFF][\uDC00-\uDFFF])/);1==i.length&&(a+=i[0])}return(a=a.replace(/\n/g," ")).trim()}catch(e){return a}};a.setFav=function(e){void 0===e&&(e=angular.element(document.getElementById("defDesc")).val().trim()),0==e.length&&(a.favDesc=!1),e.length>0&&(e=a.defDesc=c(e),d(e,!1)||(a.favDesc=!1),e.length<200&&(a.hideLngValidMsg=!0))};var d=function(e,t){0==a.description.length&&0==a.descriptionList.length&&a.getFavDescription();for(var r=!1,n=0;n<a.description.length;n++)if(e==a.description[n]){t||(a.favDesc=!0),r=!0;break}return r};a.addDescriptionFavorite=function(e,r,i){var s="";if(e?s=r.data.trim():(s=angular.element(document.getElementById("defDesc")).val().trim(),s=l.removeSpecialCharFromStr(s,0)),0!=s.length)if(i.preventDefault(),i.stopPropagation(),d(s,e))t("translate")("msg_DuplicateDescription");else n.addDescriptionFavorite(a.loginDetail.SESKEY,a.loginDetail.EMPLID,JSON.stringify(s)).then(function(t){0==t.ADDDESCFAV_OUT_OBJ.RETCD&&(localStorage.removeItem("DescFav"),e?(a.description.push(r.data),localStorage.setItem("DescFav",JSON.stringify(a.description)),r.fav=!0,a.selectedData.IsActivity||""==angular.element(document.getElementById("defDesc")).val()||a.setFav()):(a.getFavDescription(),a.favDesc=!0))})},a.removeDescriptionFavorites=function(e,t,r,i){var s="";if(e?s=t.data:(s=angular.element(document.getElementById("defDesc")).val().trim(),s=l.removeSpecialCharFromStr(s,0)),0!=s.length){var o={VARCHAR2:[s]};r.preventDefault(),r.stopPropagation();var c=JSON.stringify(o);d(s,e)?n.removeDescriptionFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,c).then(function(r){if(0==r.REMDESCFAV_OUT_OBJ.RETCD)if(localStorage.removeItem("DescFav"),e){for(var n=0;n<a.description.length;n++)a.description[n]==s&&a.description.splice(n,1);localStorage.setItem("DescFav",JSON.stringify(a.description)),t.fav=!1,a.selectedData.IsActivity||""==angular.element(document.getElementById("defDesc")).val()||a.setFav()}else a.getFavDescription(),a.favDesc=!1}):a.favDesc=!1}}}]).controller("ActivityCtrl",["$rootScope","$filter","$scope","$modalInstance","activityService","$state","$timeout","selectedData",function(e,t,a,r,n,i,s,o){a.popUpName="Activity",a.isFavActivityOn=!0,a.domainURL="",a.loginDetail=null,a.initialDetail=null,a.activityList=[],a.favActivityObj=[],a.selectedData=o,a.isSameCompany=!1,a.ActivityFavList=[],a.isLoaded=!1,a.ok=function(e){r.close(e)},a.cancel=function(){e.errorLogMethod("ActivityCtrl.$scope.cancel"),r.dismiss("cancel")},a.initActivity=function(){e.errorLogMethod("ActivityCtrl.$scope.initActivity"),a.domainURL=e.domainURL,a.loginDetail=e.GetLoginDetail(!1,!0),a.initialDetail=e.GetInitialDetail(!1,!0),a.selectedData.compId==a.initialDetail.COMP_REC.COMPID?(a.isSameCompany=!0,a.isFavActivityOn=!1,a.getFavActivity()):(a.isFavActivityOn=!0,a.isSameCompany=!1,a.getAllActivity())},a.getFavActivity=function(){e.errorLogMethod("ActivityCtrl.$scope.getFavActivity"),a.selectedData.compId==a.initialDetail.COMP_REC.COMPID?(a.isSameCompany=!0,n.retrieveActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID).then(function(e){if(a.isFavActivityOn=!0,a.isLoaded=!0,0==e.RETACTIFAV_OUT_OBJ.RETCD&&(a.activityList=e.RETACTIFAV_OUT_OBJ.ACTI_ARR),null!=e.RETACTIFAV_OUT_OBJ.ACTI_ARR&&"[object Array]"!=Object.prototype.toString.call(e.RETACTIFAV_OUT_OBJ.ACTI_ARR)){var t=e.RETACTIFAV_OUT_OBJ.ACTI_ARR;e.RETACTIFAV_OUT_OBJ.ACTI_ARR=[],null!=t&&e.RETACTIFAV_OUT_OBJ.ACTI_ARR.push(t.ACTI_OBJ)}var r=e.RETACTIFAV_OUT_OBJ.ACTI_ARR,n=0;if(a.favActivityObj=[],a.ActivityFavList=[],null!=r)for(var i=0;i<r.length;i++)"Y"==r[i].STAT&&(r[i].index=n,r[i].fav=!0,a.favActivityObj.push(r[i]),a.ActivityFavList.push(r[i]),n++);0==a.ActivityFavList.length?angular.element(document.getElementById("divNoRecord")).show():angular.element(document.getElementById("divNoRecord")).hide(),localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList))})):(a.isFavActivityOn=!0,a.favActivityObj=[],a.ActivityFavList=[],angular.element(document.getElementById("divNoRecord")).show())},a.sendFavDataBack=function(t){e.errorLogMethod("ActivityCtrl.$scope.sendFavDataBack"),a.ok(a.favActivityObj[t])},a.getAllActivity=function(){e.errorLogMethod("ActivityCtrl.$scope.getAllActivity"),n.searchActivityCode(a.loginDetail.SESKEY,a.selectedData.compId,a.domainURL).then(function(e){if(0==e.LOADACTI_OUT_OBJ.RETCD){if(a.isFavActivityOn=!1,a.isLoaded=!0,null!=e.LOADACTI_OUT_OBJ.ACTI_ARR&&"[object Array]"!=Object.prototype.toString.call(e.LOADACTI_OUT_OBJ.ACTI_ARR)){var t=e.LOADACTI_OUT_OBJ.ACTI_ARR;e.LOADACTI_OUT_OBJ.ACTI_ARR=[],null!=t&&e.LOADACTI_OUT_OBJ.ACTI_ARR.push(t.ACTI_OBJ)}var r=e.LOADACTI_OUT_OBJ.ACTI_ARR,n=0;a.favActivityObj=[];for(var i=0;i<r.length;i++)"Y"==r[i].STAT&&(r[i].index=n,r[i].fav=l(r[i]),a.favActivityObj.push(r[i]),n++);0==a.favActivityObj.length?angular.element(document.getElementById("divNoRecord")).show():angular.element(document.getElementById("divNoRecord")).hide()}})};var l=function(e){var t=!1;if(a.isSameCompany)for(var r=0;r<a.ActivityFavList.length;r++)if(a.ActivityFavList[r].ACTICD==e.ACTICD){t=!0;break}return t};a.addActivityFavorited=function(e,t){if(null!=e){var r={VARCHAR2:[e.ACTICD.toString()]},i=JSON.stringify(r);t.preventDefault(),t.stopPropagation(),!l(e)&&a.isSameCompany?n.addActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,i).then(function(t){0==t.ADDACTIFAV_OUT_OBJ.RETCD&&(e.fav=!0,localStorage.removeItem("ActivityFav"),a.ActivityFavList.push(e),localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList)))}):e.fav=!0}},a.removeActivityFavorites=function(e,t){if(null!=e){var r={VARCHAR2:[e.ACTICD.toString()]},i=JSON.stringify(r);t.preventDefault(),t.stopPropagation(),l(e)&&a.isSameCompany?n.removeActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,i).then(function(t){if(0==t.REMACTIFAV_OUT_OBJ.RETCD){e.fav=!1,localStorage.removeItem("ActivityFav");for(var r=0;r<a.ActivityFavList.length;r++)a.ActivityFavList[r].ACTICD==e.ACTICD&&a.ActivityFavList.splice(r,1);localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList))}}):e.fav=!0}}}]).controller("FavSearchCtrl",["$rootScope","$filter","$scope","$modalInstance","cepService","projectComponetService","activityService","loadICRates","$state","$rootScope","$timeout","selectedData",function(e,t,a,r,n,i,s,o,l,e,c,d){a.popUpName="FavSearch",a.isDesFocused=!1,a.domainURL="",a.PageNumber=1,a.DataPerPage=10,a.TotalPages=1,a.loginDetail=null,a.initialDetail=null,a.findCepCode="",a.selectedData=d,a.isFavSearchOn=!0,a.showButton=!1,a.ldingData="",a.noMoreData="";var p=function(){this.items=[],this.busy=!0,this.after="",this.pageNumber=1,this.loadMsg="Search Results . . ."};a.favCEPlObj=new p,p.prototype.nextPage=function(){if(e.errorLogMethod("FavSearchCtrl.SearchRslt.prototype.nextPage"),this.busy)return!1;this.busy=!0,c(function(){a.$broadcast("update_find_result")},1e3),a.searchRslObj.loadMsg=a.ldingData},a.ok=function(t){e.errorLogMethod("FavSearchCtrl.$scope.ok"),r.close(t)},a.cancel=function(){r.dismiss("cancel")},a.isPageLoaded=!1,a.initGetFavCEP=function(){e.errorLogMethod("FavSearchCtrl.$scope.initGetFavCEP"),a.ldingData=t("translate")("msg_LdingData"),a.noMoreData=t("translate")("msg_NoMoreData"),a.domainURL=e.domainURL,a.loginDetail=e.GetLoginDetail(!1,!0),a.initialDetail=e.GetInitialDetail(!1,!0),a.findCepCode=a.selectedData.cepCode,9==a.findCepCode.length&&(a.findCepCode=a.findCepCode.substring(0,6)+"-"+a.findCepCode.substring(6,9)),a.findCepCode.length>0&&(a.showButton=!0),a.getFavCEP(a.findCepCode)},p.prototype.getMoreFavCEP=function(){if(e.errorLogMethod("FavSearchCtrl.SearchRslt.prototype.getMoreFavCEP"),a.favCEPlObj.pageNumber>a.TotalPages&&(this.busy=!0),this.busy)return!1;this.busy=!0,a.isFavSearchOn?a.getFavCEP(a.findCepCode):a.getFavCEP(""),a.favCEPlObj.loadMsg=a.ldingData};var u=function(e,t){if(e.length>0)for(var r=a.sortCEP(e),n=0;n<r.length;n++)0!=r[n].CLIEID&&(r[n].index=t,r[n].fav="Y"==r[n].CEPFAV,a.favCEPlObj.items.push(r[n]),t++);a.favCEPlObj.pageNumber=a.favCEPlObj.pageNumber+1;var i=parseInt(localStorage.getItem("TOTFavAVAIL"));a.TotalPages=i>0?Math.ceil(i/a.DataPerPage):0,a.favCEPlObj.busy=!1,null==a.favCEPlObj.items||0==a.favCEPlObj.items.length?angular.element(document.getElementById("divNoRecord")).show():angular.element(document.getElementById("divNoRecord")).hide()};a.getFavCEP=function(t){if(e.errorLogMethod("FavSearchCtrl.$scope.getFavCEP"),1==a.favCEPlObj.pageNumber){var r=JSON.parse(localStorage.getItem("CEPFav"));if(null!=r&&""==t){var i=r,s=a.favCEPlObj.items.length;return void u(i,s)}}n.getFavCEP(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t,a.favCEPlObj.pageNumber,a.DataPerPage,"2").then(function(e){if(void 0==e.RETCEPFAV_OUT_OBJ.CEP_ARR||0==e.RETCEPFAV_OUT_OBJ.CEP_ARR.length)return a.favCEPlObj.busy=!0,void(a.favCEPlObj.loadMsg=a.noMoreData);if("[object Array]"!=Object.prototype.toString.call(e.RETCEPFAV_OUT_OBJ.CEP_ARR)){var r=e.RETCEPFAV_OUT_OBJ.CEP_ARR;e.RETCEPFAV_OUT_OBJ.CEP_ARR=[],e.RETCEPFAV_OUT_OBJ.CEP_ARR.push(r.CEP_DET_OBJ)}var n=e.RETCEPFAV_OUT_OBJ.CEP_ARR,i=a.favCEPlObj.items.length;n.length>0&&""==t&&1==a.favCEPlObj.pageNumber&&(localStorage.removeItem("CEPFav"),localStorage.removeItem("TOTFavAVAIL"),localStorage.setItem("CEPFav",JSON.stringify(n)),localStorage.setItem("TOTFavAVAIL",e.RETCEPFAV_OUT_OBJ.TOTAVAIL)),u(n,i)})},a.getAllFav=function(e){a.favCEPlObj=new p,e?(a.isFavSearchOn=!1,a.getFavCEP("")):(a.isFavSearchOn=!0,a.getFavCEP(a.findCepCode))},a.sortCEP=function(a){e.errorLogMethod("FavSearchCtrl.$scope.sortCEP");for(var r=0;r<a.length;r++)1==a[r].ENGNO.length&&(a[r].ENGNO="00"+a[r].ENGNO),2==a[r].ENGNO.length&&(a[r].ENGNO="0"+a[r].ENGNO),1==a[r].PRJNO.length&&(a[r].PRJNO="00"+a[r].PRJNO),2==a[r].PRJNO.length&&(a[r].PRJNO="0"+a[r].PRJNO);return t("orderBy")(a,["CLIENO","ENGNO","PRJNO"])},a.sendFavDataBack=function(e){a.ok(JSON.stringify(a.favCEPlObj.items[e]))};var E=function(){null==localStorage.getItem("CEPFav")&&n.getFavCEP(a.loginDetail.SESKEY,a.loginDetail.EMPLID,"",1,10,"2").then(function(e){if(void 0!=e.RETCEPFAV_OUT_OBJ.CEP_ARR&&0!=e.RETCEPFAV_OUT_OBJ.CEP_ARR.length){if("[object Array]"!=Object.prototype.toString.call(e.RETCEPFAV_OUT_OBJ.CEP_ARR)){var t=e.RETCEPFAV_OUT_OBJ.CEP_ARR;e.RETCEPFAV_OUT_OBJ.CEP_ARR=[],e.RETCEPFAV_OUT_OBJ.CEP_ARR.push(t.CEP_DET_OBJ)}var a=e.RETCEPFAV_OUT_OBJ.CEP_ARR;a.length>0&&(localStorage.setItem("CEPFav",JSON.stringify(a)),localStorage.setItem("TOTFavAVAIL",e.RETCEPFAV_OUT_OBJ.TOTAVAIL))}})},C=function(){localStorage.removeItem("CEPFav"),localStorage.removeItem("TOTFavAVAIL"),E()};a.addCEPFavorited=function(e,t,r){var i={NUMBER:[0==e?a.cpecode.PRJID:t.PRJID]},s=JSON.stringify(i);e&&(r.preventDefault(),r.stopPropagation()),n.addCEPFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,s).then(function(r){if(e){t.fav=!0;var n=parseInt(t.ENGNO)>99?parseInt(t.ENGNO).toString():parseInt(t.ENGNO)>9?"0"+parseInt(t.ENGNO).toString():"00"+parseInt(t.ENGNO).toString(),i=parseInt(t.PRJNO)>99?parseInt(t.PRJNO).toString():parseInt(t.PRJNO)>9?"0"+parseInt(t.PRJNO).toString():"00"+parseInt(t.PRJNO).toString();t.CLIENO.toString()+"-"+n+"-"+i==a.findCepCode&&(angular.element(document.getElementById("cepfav")).val(t.fav),angular.element(document.getElementById("isChange")).val(!0))}else a.selectCEPFev=!0,a.selectCEPNonFev=!1;C()})},a.removeCEPFavorites=function(e,t,r){var i={NUMBER:[0==e?a.cpecode.PRJID:t.PRJID]},s=JSON.stringify(i);e&&(r.preventDefault(),r.stopPropagation()),n.removeCEPFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,s).then(function(r){if(e){t.fav=!1;var n=parseInt(t.ENGNO)>99?parseInt(t.ENGNO).toString():parseInt(t.ENGNO)>9?"0"+parseInt(t.ENGNO).toString():"00"+parseInt(t.ENGNO).toString(),i=parseInt(t.PRJNO)>99?parseInt(t.PRJNO).toString():parseInt(t.PRJNO)>9?"0"+parseInt(t.PRJNO).toString():"00"+parseInt(t.PRJNO).toString();t.CLIENO.toString()+"-"+n+"-"+i==a.findCepCode&&(angular.element(document.getElementById("cepfav")).val(t.fav),angular.element(document.getElementById("isChange")).val(!0))}else a.selectCEPFev=!1,a.selectCEPNonFev=!0;C()})}}]).controller("SearchCtrl",["$rootScope","$filter","$scope","$modal","cepService","projectComponetService","activityService","loadICRates","$state","$rootScope","$timeout","$window","loadRevenueMonthsServices","gridDataService","dateService","futureEntryService","commonUtilityService",function(e,t,a,r,n,i,s,o,l,e,c,d,p,u,E,C,D){var g=!1;a.isPartitionErr=!1,a.is24HourMsgShown=!1,a.isRoundingMsgShown=!1,a.isSearchClick=!1,a.wkHrsEntered=0,a.isEditMode=!1,a.isRegulated=!1,a.isRegulatedChkd=!1,a.isUpdPro=!1,a.isScopeReq=!1,a.favDesc=!1,a.AcivityFev=!1,a.ldingData="",a.noMoreData="",a.scopeObj={selected:null,scopeListData:[]},a.isSameCompany=!1;var v=function(){this.items=[],this.busy=!0,this.after="",this.pageNumber=1,this.loadMsg="Search Results . . .",this.TotalPages=1,this.DataPerPage=10};a.keyPress=function(e){13==e.keyCode&&e.preventDefault()};var m=function(){var e="",t=angular.element(document.getElementById("description")).val();try{t=t.replace("⛔",""),t=t.replace("☺️",""),t=t.replace("☹️",""),t=t.replace("✊",""),t=t.replace("✌️",""),t=t.replace("✋",""),t=t.replace("☝️","");var a=(t=t.replace(/✍️|❤️|✍|⛹|⚓️|⛪️|⛴|⛺️|✈️|☹/g,"")).split(/([\uD800-\uDBFF][\uDC00-\uDFFF])/);t="";for(var r=0;r<a.length;r++)if(""!==(e=a[r])){var n=e.split(/([\uD800-\uDBFF][\uDC00-\uDFFF])/);1==n.length&&(t+=n[0])}return(t=t.replace(/\n/g," ")).trim()}catch(e){return console.log(e.message),t}};a.descriptionBlur=function(){a.isDesValid=!1,a.isDesFocused=!1,null!=a.description&&(a.description=a.description.replace(/\n/g," "),a.description.length>0&&(a.description=m(),O()))},a.favChange=function(){"true"==angular.element(document.getElementById("cepfav")).val()?(a.selectCEPFev=!0,a.selectCEPNonFev=!1):(a.selectCEPFev=!1,a.selectCEPNonFev=!0)},a.setFav=function(e){void 0===e&&(e=angular.element(document.getElementById("description")).val(),a.description=e),0==e.trim().length&&(a.favDesc=!1),e.trim().length>0&&(O()||(a.favDesc=!1))};var O=function(){0==a.descFav.length&&Y(!1);for(var e=!1,t=0;t<a.descFav.length;t++)if(a.description.trim()==a.descFav[t]){a.favDesc=!0,e=!0;break}return e};a.startDate=null,a.selectCEPFev=!1,a.selectCEPNonFev=!1,a.startDate=null,v.prototype.nextPage=function(){return e.errorLogMethod("SearchCtrl.SearchRslt.prototype.nextPage"),!(a.searchRslObj.pageNumber>a.searchRslObj.TotalPages)&&(!this.busy&&(this.busy=!0,c(function(){a.$broadcast("update_find_result")},1e3),void(a.searchRslObj.loadMsg=a.ldingData)))},a.InitializeValidationMsg=function(){a.frmValidationParms.cepMsg=t("translate")("msg_ValidCep"),a.frmValidationParms.activityMsg=t("translate")("msg_activity"),a.frmValidationParms.invalidHrs=t("translate")("msg_InvalidHrs"),a.frmValidationParms.desMsg=t("translate")("msg_Description"),a.frmValidationParms.compoMsg=t("translate")("msg_Task"),a.frmValidationParms.projectMsg=t("translate")("msg_Component"),a.frmValidationParms.scopeMsg=t("translate")("msg_Scope")},a.frmValidationParms={maxHours:200,minHour:-200,isDesReq:!1,desMsg:"",cepMsg:"",exHour1:"",exHour2:"",invalidHrs:"",cnfrmSubmit:!0,compoMsg:"",projectMsg:"",activityMsg:"",isProjectSelected:!1,IsCepCodeSelected:!1,isActivitySel:!1,activityTitle:"",scopeMsg:"",isTaskSelected:!1,invalidCEPMsg:"",titleDes:""},a.findCepCode="",a.searchRslObj=new v,a.favCEPlObj=new v,a.revStartDate=null,a.revEndDate=null,a.cpecode={},a.cpeListData=[],a.cpeList=function(t){return e.errorLogMethod("SearchCtrl.$scope.cpeList"),a.cpecodeList},a.domainURL="",a.state={selected:null,stateprovlist:[]},a.stateprovlist=[],a.revenueCurrentMonth=null,a.cpeListData.selected=null;var T=function(){e.errorLogMethod("SearchCtrl.loadRevenueMonth"),a.revenueCurrentMonth=a.initialDetail.REVM_REC},f=function(){e.errorLogMethod("SearchCtrl.refreshPage"),null==e.$stateParams.startDate&&l.go("Main")};a.maskTest="",a.init=function(){a.desFromImportCal=e.$stateParams.Description,localStorage.setItem("enterPress","0"),a.frmValidationParms.exHour1=t("translate")("msg_ExHrs"),a.frmValidationParms.exHour2=t("translate")("msg_ExMinusHrs"),a.frmValidationParms.activityTitle=t("translate")("activity_Title"),a.frmValidationParms.invalidCEPMsg=t("translate")("msg_ValidCep"),a.frmValidationParms.titleDes=t("translate")("title_Description"),a.ldingData=t("translate")("msg_LdingData"),a.noMoreData=t("translate")("msg_NoMoreData"),P(),a.maskTest=String("?*?*?*?*?*?*?-?9?9?9?-?9?9?9"),e.errorLogMethod("SearchCtrl.$scope.init"),a.isPageLoad=!0,a.isPostback=!0,a.startDate=e.$stateParams.startDate,f(),a.loginDetail=e.GetLoginDetail(!1,!0),a.initialDetail=e.GetInitialDetail(!1,!0),"Y"===a.initialDetail.COMP_REC.RGLW&&(a.isRegulated=!0),"Y"===a.initialDetail.COMP_REC.UPST&&(a.isUpdPro=!0),R();for(var r=JSON.parse(localStorage.getItem("StateProv_Data")),n=0;n<r.length;n++){i={PTXCODE:r[n].PTXCODE,PTXNAME:r[n].PTXNAME,PRSTID:r[n].PRSTID,DEF:r[n].DEF};a.state.stateprovlist.push(i),"Y"==a.state.stateprovlist[n].DEF&&(a.state.selected=JSON.stringify(a.state.stateprovlist[n]))}if(a.isDailyMode=e.$stateParams.isDailyMode,e.$stateParams.IsSearch){var i=JSON.parse(localStorage.getItem("Search_Data"));a.cpeListData.push(JSON.parse(localStorage.getItem("Search_Data"))),a.cpeListData.selected=a.cpeListData[0];var s=parseInt(a.cpeListData.selected.ENGNO)>99?parseInt(a.cpeListData.selected.ENGNO).toString():parseInt(a.cpeListData.selected.ENGNO)>9?"0"+parseInt(a.cpeListData.selected.ENGNO).toString():"00"+parseInt(a.cpeListData.selected.ENGNO).toString(),o=parseInt(a.cpeListData.selected.PRJNO)>99?parseInt(a.cpeListData.selected.PRJNO).toString():parseInt(a.cpeListData.selected.PRJNO)>9?"0"+parseInt(a.cpeListData.selected.PRJNO).toString():"00"+parseInt(a.cpeListData.selected.PRJNO).toString();a.cepEnter=a.cpeListData.selected.CLIENO.toString()+"-"+s+"-"+o,a.cepEnterText=a.cpeListData.selected.CLIENO.toString()+s+o,14==(l=a.cepEnter.length)?a.loadCEPCode():_(),localStorage.removeItem("Search_Data")}if(e.$stateParams.IsEditMode&&(a.isPostback=!1,a.isEditMode=!0,a.timeEntry=JSON.parse(localStorage.getItem("Time_Entry")),void 0!==typeof a.timeEntry.CEP_REC&&!e.$stateParams.IsSearch)){a.updateHrsInEditMode(),a.cpeListData.push(a.timeEntry.CEP_REC),a.cpeListData.selected=a.cpeListData[0];var s=parseInt(a.cpeListData.selected.ENGNO)>99?parseInt(a.cpeListData.selected.ENGNO).toString():parseInt(a.cpeListData.selected.ENGNO)>9?"0"+parseInt(a.cpeListData.selected.ENGNO).toString():"00"+parseInt(a.cpeListData.selected.ENGNO).toString(),o=parseInt(a.cpeListData.selected.PRJNO)>99?parseInt(a.cpeListData.selected.PRJNO).toString():parseInt(a.cpeListData.selected.PRJNO)>9?"0"+parseInt(a.cpeListData.selected.PRJNO).toString():"00"+parseInt(a.cpeListData.selected.PRJNO).toString();a.cepEnter=a.cpeListData.selected.CLIENO.toString()+"-"+s+"-"+o,a.cepEnterText=a.cpeListData.selected.CLIENO.toString()+s+o,a.isSubmit="Y"==a.timeEntry.TIMSUB;var l=a.cepEnter.length;14==l?a.loadCEPCode():_()}if(e.$stateParams.IsSearch||e.$stateParams.isCalFlg||e.$stateParams.isCancelSearch){var c=1==e.$stateParams.IsSearch||1==e.$stateParams.isCancelSearch;a.updateHrsDesSearch(c)}T()},a.updateHrsDesSearch=function(t){if(e.errorLogMethod("SearchCtrl.$scope.updateHrsDesSearch"),e.$stateParams.isDailyMode){a.dailyHour=Number(parseFloat(e.$stateParams.Hours).toFixed(2));a.$watch("dailyHours",function(){A("dailyHours",a.dailyHour)})}else{var r=[null,null,null,null,null,null,null];if(1==t){r=e.$stateParams.Hours;for(i=0;i<7;i++)a.week[i]=r[i];if(1==e.$stateParams.IsEditMode)for(var n=JSON.parse(localStorage.getItem("weeklyhours")),i=0;i<7;i++)a.weeklyOld[i]=n[i]}else if(1==e.$stateParams.isCalFlg){var s=e.$stateParams.Hours.split("|"),o=s[1];r[o]=Number(parseFloat(s[0]).toFixed(2));for(i=0;i<7;i++)a.week[i]=r[i]}a.$watch("week",function(){for(var e=0;e<7;e++)null!=r[e]&&A("wkHrs"+(e+1),r[e])})}a.description=e.$stateParams.Description,y()};var y=function(){e.errorLogMethod("SearchCtrl.checkImportDesFavOnInit");var t=localStorage.getItem("DescFav");""==t||null==t?n.retrieveDescriptionFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID).then(function(e){if(0==e.RETDESCFAV_OUT_OBJ.RETCD){if("[object Array]"!=Object.prototype.toString.call(e.RETDESCFAV_OUT_OBJ.DESTXT_ARR)){var t=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR;e.RETDESCFAV_OUT_OBJ.DESTXT_ARR=[],null!=t&&void 0!=t.VARCHAR2&&e.RETDESCFAV_OUT_OBJ.DESTXT_ARR.push(t.VARCHAR2)}a.descFav=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR}localStorage.setItem("DescFav",JSON.stringify(a.descFav)),a.favDesc=S()}):(a.descFav=JSON.parse(t),a.favDesc=S())},S=function(){e.errorLogMethod("SearchCtrl.checkDiscriptionInFavList");for(var t=!1,r=0;r<a.descFav.length;r++)if(a.description==a.descFav[r]){a.favDesc=!0,t=!0;break}return t},R=function(){null==localStorage.getItem("CEPFav")&&n.getFavCEP(a.loginDetail.SESKEY,a.loginDetail.EMPLID,"",a.favCEPlObj.pageNumber,a.DataPerPage,"2").then(function(e){if(void 0!=e.RETCEPFAV_OUT_OBJ.CEP_ARR&&0!=e.RETCEPFAV_OUT_OBJ.CEP_ARR.length){if("[object Array]"!=Object.prototype.toString.call(e.RETCEPFAV_OUT_OBJ.CEP_ARR)){var t=e.RETCEPFAV_OUT_OBJ.CEP_ARR;e.RETCEPFAV_OUT_OBJ.CEP_ARR=[],e.RETCEPFAV_OUT_OBJ.CEP_ARR.push(t.CEP_DET_OBJ)}var a=e.RETCEPFAV_OUT_OBJ.CEP_ARR;a.length>0&&(localStorage.setItem("CEPFav",JSON.stringify(a)),localStorage.setItem("TOTFavAVAIL",e.RETCEPFAV_OUT_OBJ.TOTAVAIL))}})},P=function(){e.errorLogMethod("SearchCtrl.setRevenueDte");var t=JSON.parse(localStorage.getItem("Revenue_Months")),r=null;if(null!=t){var n=new Date;(n=new Date(n.getTime()-60*n.getTimezoneOffset()*1e3)).setHours(0,0,0,0),r=angular.fromJson(t).filter(function(e){if(null!=e&&n>=E.createDate(e.STRTDTE)&&n<=E.createDate(e.ENDDTE))return!0})}null!=r&&void 0!=r&&0!=r.length&&(a.revStartDate=r[0].STRTDTE,a.revEndDate=r[0].ENDDTE)};a.initSearch=function(){localStorage.setItem("enterPress","0"),a.ldingData=t("translate")("msg_LdingData"),a.noMoreData=t("translate")("msg_NoMoreData"),a.paceHolderVal=t("translate")("placeHolder_CEPSrch"),e.errorLogMethod("SearchCtrl.$scope.initSearch"),a.startDate=e.$stateParams.startDate,f(),a.loginDetail=e.GetLoginDetail(!1,!0),a.initialDetail=e.GetInitialDetail(!1,!0),a.findCepCode=null!=e.$stateParams.searchKeyword?e.$stateParams.searchKeyword:"",9==a.findCepCode.length&&(a.findCepCode=a.findCepCode.substring(0,6)+"-"+a.findCepCode.substring(6,9)),""!=a.findCepCode&&a.mFindCEPCode(),e.isRefresh=!0,a.isDailyMode=e.$stateParams.isDailyMode},a.entry={type:"select",name:"Entry",value:"Time",values:["Time","IC"]},a.component={selected:null,projectListData:[]},a.task={selected:null,taskListData:[]},a.activity={selected:{}},a.icListData=[],a.PageNumber=1,a.DataPerPage=10,a.TotalPages=0,a.IsSearchDropdown=!0,a.select="",a.IsActivity=!0,a.loginDetail="",a.initialDetail="",a.week=[null,null,null,null,null,null,null],a.isActivityActive=!0,a.cepEnter="",a.isSaving=!1,a.animationsEnabled=!0,a.descriptionText="",a.setFocusDescriptionPopUp=function(e){var t="#description";e||null==a.task.selected||("Y"==JSON.parse(a.task.selected).DESREQ&&!a.isScopeReq||null!=a.scopeObj.selected&&"Y"==JSON.parse(a.scopeObj.selected).DESREQ)&&(t=a.isDailyMode?"#dailyHours":"#wkHrs1"),"#description"==t?c(function(){$("#saveDailyCalFrm").find("textarea").focus()},0):$(t).focus()},a.open=function(t,n,i){e.errorLogMethod("SearchCtrl.$scope.open"),r.open({animation:a.animationsEnabled,templateUrl:t,controller:n,resolve:{selectedData:function(){return i}}}).result.then(function(t){switch(e.errorLogMethod("SearchCtrl.modalInstance.result"),a.openModalCtrl){case"FavSearchCtrl":JSON.parse(t);a.clear(),a.cpeListData.push(JSON.parse(t)),a.cpeListData.selected=a.cpeListData[0];var r=parseInt(a.cpeListData.selected.ENGNO)>99?parseInt(a.cpeListData.selected.ENGNO).toString():parseInt(a.cpeListData.selected.ENGNO)>9?"0"+parseInt(a.cpeListData.selected.ENGNO).toString():"00"+parseInt(a.cpeListData.selected.ENGNO).toString(),n=parseInt(a.cpeListData.selected.PRJNO)>99?parseInt(a.cpeListData.selected.PRJNO).toString():parseInt(a.cpeListData.selected.PRJNO)>9?"0"+parseInt(a.cpeListData.selected.PRJNO).toString():"00"+parseInt(a.cpeListData.selected.PRJNO).toString();a.cepEnter=a.cpeListData.selected.CLIENO.toString()+"-"+r+"-"+n,a.cepEnterText=a.cpeListData.selected.CLIENO.toString()+r+n,a.updateCEPOnSelectFavCEP(),a.isCepValdMsgOn=!1;break;case"ActivityCtrl":a.activity.selected={ACTICD:t.ACTICD,DES:t.DES,STAT:t.STAT,COMPID:t.COMPID},a.AcivityFev=t.fav,a.frmValidationParms.isActivitySel=!0,a.isActivityActive="Y"==a.activity.selected.STAT;break;case"DescriptionCtrl":a.descriptionText=t.data,a.favDesc=t.fav;var i=localStorage.getItem("DescFav");a.descFav=JSON.parse(i),""!=a.descriptionText&&null!=a.descriptionText&&(a.isDescDisable=!1,a.textAreaDescription()),a.setFocusDescriptionPopUp(!0);break;case"ErrorPopup":if(a.isPartitionErr)b();else{var s=a.noOfwarningPopup-1;a.noOfwarningPopup=s<0?0:s,(a.saveOn||a.enterPress||a.isFormValid)&&0==a.noOfwarningPopup&&!a.cancelFlag&&null!=a.json&&a.isFormValid&&(a.finalSaveCall=!0,$("#btnEntrySave").focus(),a.saveOn=!1,a.finalSave(a.json,a.deleteEntry)),0==s&&(a.saveOn=!1,a.enterPress=!1)}}},function(){switch(a.openModalCtrl){case"FavSearchCtrl":"true"==angular.element(document.getElementById("isChange")).val()&&a.favChange(),angular.element(document.getElementById("isChange")).val(!1);break;case"ActivityCtrl":"Select an activity....."==a.activity.selected.DES&&(a.activity.selected={}),a.ActivityFavList=[],null!=a.activity.selected&&(a.AcivityFev=V(a.activity.selected));break;case"DescriptionCtrl":a.descFav=[],a.setFav(),a.setFocusDescriptionPopUp(!1);break;case"ErrorPopup":if(a.isFormValid=!1,a.isPartitionErr)b();else{a.cancelFlag=!0;var e=a.noOfwarningPopup-1;a.noOfwarningPopup=e<0?0:e,a.is24HourMsgShown=!1,a.isRoundingMsgShown=!1,0==e&&(a.enterPress&&0==a.fucusedItemName.indexOf("wkHrs")&&$("#"+a.fucusedItemName).focus(),c(function(){a.saveOn=!1,a.enterPress=!1},100))}}})},a.cancelFlag=!1,a.toggleAnimation=function(){e.errorLogMethod("SearchCtrl.$scope.toggleAnimation"),a.animationsEnabled=!a.animationsEnabled},a.descCorssClick=function(){a.description="",a.favDesc=!1},a.refreshResults=function(t){e.errorLogMethod("SearchCtrl.$scope.refreshResults"),a.select=t,(t=t).length>0?(a.IsSearchDropdown&&(a.PageNumber=1),n.searchCEPCode(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t,a.PageNumber,a.DataPerPage,"2,5,8",a.initialDetail.COMP_REC.COMPID,a.domainURL).then(function(e){0==parseInt(e.LOOKCEP_OUT_OBJ.RETCD)&&void 0!==e.LOOKCEP_OUT_OBJ.CEP_ARR.length&&(a.cpeListData=e.LOOKCEP_OUT_OBJ.CEP_ARR,a.TotalPages=parseInt(parseInt(e.LOOKCEP_OUT_OBJ.TOTAVAIL)/a.DataPerPage),a.childDataTransfer())})):e.$stateParams.IsSearch||(a.cpeListData=[])},a.timeEntry={},a.mrefreshResults=function(t){e.errorLogMethod("SearchCtrl.$scope.mrefreshResults"),e.$stateParams.IsEditMode&&(a.timeEntry=JSON.parse(localStorage.getItem("Time_Entry")),void 0!==typeof a.timeEntry.CEP_REC&&(t.search=a.timeEntry.CEP_REC.CLIENO.toString()+"-"+a.timeEntry.CEP_REC.ENGNO.toString()+"-"+a.timeEntry.CEP_REC.PRJNO.toString())),a.select=t.search,a.component.projectListData=[],a.activity.activityListData=[];var r=t.search;r.length>0?(a.IsSearchDropdown&&(a.PageNumber=1),n.searchCEPCode(a.loginDetail.SESKEY,a.loginDetail.EMPLID,r,a.PageNumber,a.DataPerPage,"2,5,8",a.initialDetail.COMP_REC.COMPID,a.domainURL).then(function(r){if(0==parseInt(r.LOOKCEP_OUT_OBJ.RETCD)){var n=r.LOOKCEP_OUT_OBJ.CEP_ARR.length;r.LOOKCEP_OUT_OBJ.CEP_ARR.splice(n-1,1),void 0!==n&&(a.cpeListData=[],a.cpeListData=r.LOOKCEP_OUT_OBJ.CEP_ARR,a.TotalPages=parseInt(parseInt(r.LOOKCEP_OUT_OBJ.TOTAVAIL)/a.DataPerPage),t.items=a.cpeListData,e.$stateParams.IsEditMode&&a.EditMode())}})):e.$stateParams.IsSearch||(a.cpeListData=[],t.items=a.cpeListData)},a.warningPopup=!1,a.noOfwarningPopup=0,a.validateCEPCode=function(r,n){e.errorLogMethod("SearchCtrl.$scope.validateCEPCode");var i=a.initialDetail.COMP_REC.BCHB,s=!0;if(e.$stateParams.IsEditMode&&n&&a.timeEntry.CEP_REC.CLIEID==r.CLIEID&&a.timeEntry.CEP_REC.ENGID==r.ENGID&&a.timeEntry.CEP_REC.PRJID==r.PRJID&&(s=!1),s){if(null!=i&&""!=i)for(var o=0;o<i.length;o++)if(r.CHARBASIS==i.charAt(o))return a.loadErrorPopup(!0,t("translate")("msg_CEPChargeBasisErr",{values:i})),!1;if("Y"!=r.CLIEACTIVE)return a.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.ENGACTIVE)return a.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.ENGTIMFLAG)return a.loadErrorPopup(!0,t("translate")("msg_SelectAnotherEng")),!1;if("Y"!=r.PRJACTIVE)return a.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.PRJTIMFLAG)return a.loadErrorPopup(!0,t("translate")("msg_SelectAnotherPrj")),!1}if(null!=r.RENPRJNO&&" "!=r.RENPRJNO&&void 0!==r.RENPRJNO&&!a.isSubmit){var l=parseInt(r.RENPRJNO)>99?parseInt(r.RENPRJNO).toString():parseInt(r.RENPRJNO)>9?"0"+parseInt(r.RENPRJNO).toString():"00"+parseInt(r.RENPRJNO).toString(),c=r.CLIENO+"-"+r.ENGNO+"-"+r.PRJNO;return a.loadErrorPopup("z",t("translate")("msg_ProjectRenewedPaste",{pName:l,cepProject:c})),n||(a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1),!0}return!0};var I=function(t){return e.errorLogMethod("SearchCtrl.var.isInvalidFutureEntry"),C.futureEntry(t)};a.validateHours=function(r){if(e.errorLogMethod("SearchCtrl.$scope.validateHours"),null==r.ACTI_REC.ACTICD||""==r.ACTI_REC.ACTICD||void 0==r.ACTI_REC.ACTICD)return!1;if(parseFloat(r.HRS)>200)return a.loadErrorPopup(!0,a.frmValidationParms.exHour1),!1;if(parseFloat(r.HRS)<-200)return a.loadErrorPopup(!0,a.frmValidationParms.exHour2),!1;if("Y"!=r.ACTI_REC.STAT&&null!=r.ACTI_REC.ACTICD&&""!=r.ACTI_REC.ACTICD)return a.loadErrorPopup(!0,t("translate")("msg_InActiveActivity")),!1;var n=t("date")(a.initialDetail.EMPL_REC.BRSTDTE,"yyyy-MM-dd").split("-"),i=n[2].split(" "),s=new Date(n[0],n[1]-1,i[0]);if(E.createDate(r.DTE)<s){var o=s.toString().split(" "),l=o[2]+"-"+o[1]+"-"+o[3];return a.loadErrorPopup(!0,t("translate")("msg_TimePriorToBillingStartDate",{dateVal:l})),!1}if("222"==a.initialDetail.EMPL_REC.BRATE.toString())return a.loadErrorPopup(!0,t("translate")("msg_InvaildBillingRate")),!1;if(I(r))return a.loadErrorPopup(!0,t("translate")("msg_FutureTimeEntry")),!1;if(parseFloat(r.HRS)<0)switch(r.CEP_REC.CHARBASIS){case"N":if("Y"!=a.initialDetail.COMP_REC.NTIM)return a.loadErrorPopup(!0,t("translate")("msg_NegativeHrs")),!1;break;case"T":if("Y"!=a.initialDetail.COMP_REC.NBTM)return a.loadErrorPopup(!0,t("translate")("msg_BillingNegativeHrs")),!1;break;case"S":case"C":if("Y"!=a.initialDetail.COMP_REC.NBTM)return a.loadErrorPopup(!0,t("translate")("msg_NegativeHrs")),!1}return!0},a.loadCEPCode=function(){e.errorLogMethod("SearchCtrl.$scope.loadCEPCode");var r=a.cepEnter;r.length>0?n.searchCEPCode(a.loginDetail.SESKEY,a.loginDetail.EMPLID,r,a.PageNumber,a.DataPerPage,"2,5,8",a.initialDetail.COMP_REC.COMPID,a.domainURL).then(function(i){if(0==parseInt(i.LOOKCEP_OUT_OBJ.RETCD)){var s=i.LOOKCEP_OUT_OBJ.CEP_ARR.length;if("0"===i.LOOKCEP_OUT_OBJ.TOTAVAIL){if(!e.$stateParams.IsEditMode)return a.selectCEPFev=a.selectCEPNonFev=!1,a.loadErrorPopup(!0,a.frmValidationParms.invalidCEPMsg),a.frmValidationParms.cnfrmSubmit=!1,void(a.frmValidationParms.IsCepCodeSelected=!1);var o=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString(),l=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString(),c=a.timeEntry.CEP_REC.CLIENO.toString()+"-"+o+"-"+l;r.toUpperCase().trim()==c?a.EditMode():(a.selectCEPFev=a.selectCEPNonFev=!1,a.loadErrorPopup(!0,t("translate")("msg_ValidCep")),a.clearNoCEPDesc())}if(a.frmValidationParms.cnfrmSubmit=!0,"[object Array]"!=Object.prototype.toString.call(i.LOOKCEP_OUT_OBJ.CEP_ARR)){var d=i.LOOKCEP_OUT_OBJ.CEP_ARR;i.LOOKCEP_OUT_OBJ.CEP_ARR=[],i.LOOKCEP_OUT_OBJ.CEP_ARR.push(d.CEP_DET_OBJ)}for(var p=0;p<i.LOOKCEP_OUT_OBJ.CEP_ARR.length;p++)0==i.LOOKCEP_OUT_OBJ.CEP_ARR[p].CLIEID&&(i.LOOKCEP_OUT_OBJ.CEP_ARR.splice(p,1),p--);if(void 0!==s){var u=i.LOOKCEP_OUT_OBJ.CEP_ARR[0];n.loadCEPDetail(a.loginDetail.SESKEY,i.LOOKCEP_OUT_OBJ.CEP_ARR[0].CLIEID,i.LOOKCEP_OUT_OBJ.CEP_ARR[0].ENGID,i.LOOKCEP_OUT_OBJ.CEP_ARR[0].PRJID,a.domainURL).then(function(n){if(0==parseInt(n.LOADCEP_OUT_OBJ.RETCD))a.clear(),a.validateCEPCode(n.LOADCEP_OUT_OBJ.CEP_REC,!0)&&(a.cpeListData=[],a.cpeListData.push(n.LOADCEP_OUT_OBJ.CEP_REC),a.cpeListData.selected=a.cpeListData[0],e.$stateParams.IsEditMode?a.EditMode():a.onSelectCEPCode(a.cpeListData.selected),"Y"==u.CEPFAV?(a.selectCEPFev=!0,a.selectCEPNonFev=!1):(a.selectCEPFev=!1,a.selectCEPNonFev=!0));else if(e.$stateParams.IsEditMode){var i=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString(),s=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString(),o=a.timeEntry.CEP_REC.CLIENO.toString()+"-"+i+"-"+s;r.toUpperCase().trim()==o?a.EditMode():(a.selectCEPFev=a.selectCEPNonFev=!1,a.loadErrorPopup(!0,t("translate")("msg_ValidCep")),a.clearNoCEPDesc())}else a.selectCEPFev=a.selectCEPNonFev=!1,a.loadErrorPopup(!0,t("translate")("msg_ValidCep"))})}}}):e.$stateParams.IsSearch||(a.cpeListData=[],$select.items=a.cpeListData)},a.cepEnterText=null,a.clearCep=function(){a.isClear=!0,a.cepEnterText="",a.cepEnter="",a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.frmValidationParms.IsCepCodeSelected=!1,a.frmValidationParms.isProjectSelected=!1,a.clear(),a.frmValidationParms.IsCepCodeSelected=!1,a.frmValidationParms.isProjectSelected=!1,a.isClear=!0},a.updateCEPOnSelectFavCEP=function(){"undefined"!=a.cepEnter&&(14==a.cepEnter.length?(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.loadCEPCode()):_()||(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.clear(),a.frmValidationParms.IsCepCodeSelected=!1))},a.onCEPEnter=function(){if(e.errorLogMethod("SearchCtrl.$scope.loadCEPCode"),localStorage.setItem("cepFocus","0"),a.isSet=!1,a.oldCep!=a.cepEnterText&&!a.isClear)return void 0===a.cepEnterText||""==a.cepEnterText||null==a.cepEnterText?(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.frmValidationParms.IsCepCodeSelected=!1,a.frmValidationParms.isProjectSelected=!1,a.cepEnter="",a.isClear=!1,a.selectCEPFev=!1,void(a.selectCEPNonFev=!1)):(12==a.cepEnterText.length?a.cepEnter=a.cepEnterText.substring(0,6)+"-"+a.cepEnterText.substring(6,9)+"-"+a.cepEnterText.substring(9,12):a.cepEnter=a.cepEnterText,a.frmValidationParms.isDesReq=!1,void("undefined"!=a.cepEnter?14==a.cepEnter.length?a.loadCEPCode():_()||(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.clear(),a.frmValidationParms.IsCepCodeSelected=!1):(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.clear())));a.isClear=!1},a.cepdelete=function(e){0==a.cepEnterText.length?(a.maskTest="?*?*?*?*?*?*?-?9?9?9?-?9?9?9",a.selectCEPFev=a.selectCEPNonFev=!1):a.isClear=!1,13==e.keyCode&&$("#cepTextBox").blur()};var _=function(){return String(a.cepEnterText.substring(0,3)).toUpperCase().trim()!=String("MRT")||isNaN(a.cepEnterText.substring(3,a.cepEnterText.length))?String(a.cepEnterText.substring(0,5)).toUpperCase().trim()!=String("LEARN")||isNaN(a.cepEnterText.substring(5,a.cepEnterText.length))?String(a.cepEnterText.substring(0,5)).toUpperCase().trim()==String("MT000")&&!isNaN(a.cepEnterText.substring(5,a.cepEnterText.length))&&(a.maskTest="?*?*?*?*?*-?9?9?9?-?9?9?9",11==a.cepEnterText.length&&(a.cepEnter=a.cepEnterText.substring(0,5)+"-"+a.cepEnterText.substring(5,8)+"-"+a.cepEnterText.substring(8,11),a.loadCEPCode()),!0):(a.maskTest="?*?*?*?*?*-?9?9?9?-?9?9?9",11==a.cepEnterText.length&&(a.cepEnter=a.cepEnterText.substring(0,5)+"-"+a.cepEnterText.substring(5,8)+"-"+a.cepEnterText.substring(8,11),a.loadCEPCode()),!0):(a.maskTest=String("?*?*?*-?9?9?9?-?9?9?9"),9==a.cepEnterText.length&&(a.cepEnter=a.cepEnterText.substring(0,3)+"-"+a.cepEnterText.substring(3,6)+"-"+a.cepEnterText.substring(6,9),a.loadCEPCode()),!0)};a.clear=function(){e.errorLogMethod("SearchCtrl.$scope.clear"),a.cpeListData=[],a.component.projectListData=[],a.component.selected=null,a.activity.activityListData=[],a.activity.selected={},a.task.taskListData=[],a.task.selected=null,a.descriptionText="",a.scopeObj.selected=null,a.selectCEPFev=!1,a.selectCEPNonFev=!1,a.isSameCompany=!1},a.clearNoCEP=function(){e.errorLogMethod("SearchCtrl.$scope.clearNoCEP"),a.component.projectListData=[],a.component.selected=null,a.activity.activityListData=[],a.activity.selected={},a.task.taskListData=[],a.task.selected=null,a.descriptionText="",a.scopeObj.selected=null},a.clearNoCEPDesc=function(){e.errorLogMethod("SearchCtrl.$scope.clearNoCEP&Desc");var t=a.description;a.component.projectListData=[],a.component.selected=null,a.activity.activityListData=[],a.activity.selected={},a.task.taskListData=[],a.task.selected=null,a.scopeObj.selected=null,e.$stateParams.isCalFlg&&(a.description=t)},a.clearNoComponent=function(){e.errorLogMethod("SearchCtrl.$scope.clearNoComponent"),a.task.taskListData=[],a.task.selected=null,a.scopeObj.selected=null},a.weeklyOld=[null,null,null,null,null,null,null],a.isAnyChange=!0;var h=function(){e.errorLogMethod("SearchCtrl.validateForOldData"),a.isAnyChange=!0;var t=!1;if(e.$stateParams.IsEditMode){var r=a.cpeListData.selected;if(a.timeEntry.CEP_REC.CLIEID!=r.CLIEID||a.timeEntry.CEP_REC.ENGID!=r.ENGID||a.timeEntry.CEP_REC.PRJID!=r.PRJID)return void(t=!0);if(0==a.timeEntry.CEP_REC.CATID){if(a.timeEntry.ACTI_REC.ACTICD!=a.activity.selected.ACTICD)return void(t=!0)}else{if(a.timeEntry.CMPTID!=JSON.parse(a.component.selected).CMPTID||a.timeEntry.TSKID!=JSON.parse(a.task.selected).TSKID)return void(t=!0);if(!0===a.isScopeReq&&a.timeEntry.SCOID!=JSON.parse(a.scopeObj.selected).SCOPID)return void(t=!0)}if(e.$stateParams.isDailyMode){if(a.timeEntry.HRS!=parseFloat(a.dailyHour))return void(t=!0)}else for(var n=0;n<7;n++){if(null!=a.weeklyOld[n]&&null!=a.week[n]&&a.week[n]!=a.weeklyOld[n])return void(t=!0);if(null==a.weeklyOld[n]&&null!=a.week[n])return void(t=!0);if(null!=a.weeklyOld[n]&&null==a.week[n])return void(t=!0)}if(a.timeEntry.DES!=a.description)return void(t=!0);if(a.timeEntry.CTDESC!=a.descriptionText)return void(t=!0);var i=!0===a.isRegulatedChkd?"Y":"N";if(a.timeEntry.REGFLAG!=i)return void(t=!0);if(""==a.timeEntry.PRSTCD.toString().trim()){if(null!=a.state.selected)return void(t=!0)}else if(a.timeEntry.PRSTCD!=JSON.parse(a.state.selected).PTXCODE)return void(t=!0);a.isAnyChange=t,t||a.cancel()}},A=function(t,a){e.errorLogMethod("SearchCtrl.updateEleValOnEdit");var a=parseFloat(a).toFixed(2);angular.element(document.getElementById(t)).val(a).trigger("input")};a.EditMode=function(){if(e.errorLogMethod("SearchCtrl.$scope.EditMode"),a.cpeListData.selected.COMPID==a.initialDetail.COMP_REC.COMPID&&(a.isSameCompany=!0),void 0!==a.timeEntry){a.onSelectCEPCode(a.cpeListData.selected),a.isDesValMsgOn=!1,a.isValidHrs=!0,a.isSubmit="Y"==a.timeEntry.TIMSUB,a.isRegulatedChkd="Y"==a.timeEntry.REGFLAG;for(var t=!1,r=0;r<a.state.stateprovlist.length;r++)if(a.state.stateprovlist[r].PTXCODE==a.timeEntry.PRSTCD){var n={PTXCODE:a.state.stateprovlist[r].PTXCODE,PTXNAME:a.state.stateprovlist[r].PTXNAME,PRSTID:a.state.stateprovlist[r].PRSTID,DEF:a.state.stateprovlist[r].DEF};t=!0,a.state.selected=JSON.stringify(n)}t||(a.state.selected=null)}a.isPostback=!0},a.updateHrsInEditMode=function(){if(1!=e.$stateParams.isCancelSearch)if(a.description=a.timeEntry.DES,a.descriptionText=a.timeEntry.CTDESC,a.setFav(a.description),e.$stateParams.isDailyMode){a.dailyHour=Number(parseFloat(a.timeEntry.HRS).toFixed(2));a.$watch("dailyHours",function(){A("dailyHours",a.timeEntry.HRS)})}else{for(var t=JSON.parse(localStorage.getItem("weeklyhours")),r=0;r<7;r++)a.week[r]=t[r],a.weeklyOld[r]=t[r];a.$watch("week",function(){for(var e=0;e<7;e++)null!=t[e]&&A("wkHrs"+(e+1),t[e])})}},a.childDataTransfer=function(){e.errorLogMethod("SearchCtrl.$scope.childDataTransfer"),a.$broadcast("update_child_controller",a.TotalPages,a.PageNumber,a.DataPerPage)},a.$on("update_parent_controller",function(t,r){e.errorLogMethod("SearchCtrl.$scope.$on.update_parent_controller"),a.PageNumber=r,a.refreshResults(a.select)}),a.setCurrent=function(t){e.errorLogMethod("SearchCtrl.$scope.setCurrent"),a.PageNumber=t,a.IsSearchDropdown=!1,a.childDataTransfer(),a.refreshResults(a.select)},a.bindScope=function(r,n){e.errorLogMethod("SearchCtrl.$scope.bindScope");if("[object Array]"!=Object.prototype.toString.call(r.ARR_PSCOP)){l=r.ARR_PSCOP;r.ARR_PSCOP=[],r.ARR_PSCOP.push(l.PSCOP_OBJ)}a.scopeObj.scopeListData=r.ARR_PSCOP;for(var i=[],s=[],o=0;o<a.scopeObj.scopeListData.length;o++){var l={SCOPID:a.scopeObj.scopeListData[o].SCOPID,SCOPCD:a.scopeObj.scopeListData[o].SCOPCD,DES:a.scopeObj.scopeListData[o].DES,ACTIVE:a.scopeObj.scopeListData[o].ACTIVE,DESREQ:a.scopeObj.scopeListData[o].DESREQ};"Y"==a.scopeObj.scopeListData[o].ACTIVE?i.push(l):s.push(l)}a.scopeObj.scopeListData=i;var c=!1;if(n){for(o=0;o<a.scopeObj.scopeListData.length;o++)a.scopeObj.scopeListData[o].SCOPID==a.timeEntry.SCOID&&(c=!0,a.populateDefScope(a.timeEntry.SCOID));if(!c){var d=a.timeEntry.CEP_REC.CLIENO+"-"+(parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString())+"-"+(parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString());if(t("uppercase")(a.cepEnter)==t("uppercase")(d))for(o=0;o<s.length;o++)s[o].SCOPID==a.timeEntry.SCOID&&(a.scopeObj.scopeListData.push(s[o]),a.populateDefScope(a.timeEntry.SCOID))}}},a.populateDefScope=function(t){e.errorLogMethod("SearchCtrl.$scope.populateDefScope");var r=$.grep(a.scopeObj.scopeListData,function(e){return e.SCOPID==t});r.length>0?(a.scopeObj.selected=angular.toJson(r[0]),a.isEditMode&&a.isPageLoad?a.isPageLoad=!1:a.retrieveScopeDescription(),a.isScopeValdMsgOn=!1):a.scopeObj.selected=null},a.onSelectTaskCode=function(){if(e.errorLogMethod("SearchCtrl.$scope.onSelectTaskCode"),a.frmValidationParms.isTaskSelected=!1,null!=a.task.selected&&""!=a.task.selected){var t=JSON.parse(a.task.selected);a.populateDefScope(t.DEFSCOPID),a.frmValidationParms.isTaskSelected=!0}else a.scopeObj.selected=null},a.onSelectCEPCode=function(r){if(e.errorLogMethod("SearchCtrl.$scope.onSelectCEPCode"),a.isScopeReq=!1,a.frmValidationParms.IsCepCodeSelected=!0,a.cpecode=r,e.$stateParams.IsEditMode&&a.timeEntry.CEP_REC.CLIEID==r.CLIEID&&a.timeEntry.CEP_REC.ENGID==r.ENGID&&a.timeEntry.CEP_REC.PRJID==r.PRJID&&s.searchActivityCode(a.loginDetail.SESKEY,r.COMPID,a.domainURL).then(function(e){if(0==parseInt(e.LOADACTI_OUT_OBJ.RETCD))for(var t=0;t<e.LOADACTI_OUT_OBJ.ACTI_ARR.length;t++)e.LOADACTI_OUT_OBJ.ACTI_ARR[t].ACTICD==a.timeEntry.ACTI_REC.ACTICD&&(a.activity.selected=e.LOADACTI_OUT_OBJ.ACTI_ARR[t],a.frmValidationParms.isActivitySel=!0,a.isActValdMsgOn=!1,a.AcivityFev=V(a.activity.selected),a.isActivityActive="Y"==a.activity.selected.STAT)}),void 0!==r.CATID&&parseInt(r.CATID)>0?(a.IsActivity=!1,i.searchPRCCode(a.loginDetail.SESKEY,r.CATID,r.PRJID).then(function(r){if(0==parseInt(r.LOADPCOMTSK_OUT_OBJ.RETCD)){if("[object Array]"!=Object.prototype.toString.call(r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM)){o=r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM;r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM=[],r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM.push(o.PCOM_OBJ)}r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM.sort(function(e,t){return e.ORD-t.ORD});var n=[],i=[];a.component.projectListData=r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR;for(var s=0;s<a.component.projectListData.PCAT_OBJ.ARR_PCOM.length;s++){var o={CMPTID:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].CMPTID,CMPTCD:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].CMPTCD,DES:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].DES,ACTIVE:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].ACTIVE,DESREQ:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].DESREQ,DEFDES:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].DEFDES,ACTICD:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].ACTICD,ORD:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].ORD,ARR_PTSK:a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].ARR_PTSK};"Y"==a.component.projectListData.PCAT_OBJ.ARR_PCOM[s].ACTIVE?n.push(o):i.push(o)}if(a.component.projectListData.PCAT_OBJ.ARR_PCOM=n,e.$stateParams.IsEditMode){var l=a.timeEntry.CEP_REC.CLIENO,c=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString(),d=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString(),p=l+"-"+c+"-"+d;t("uppercase")(a.cepEnter)==t("uppercase")(p)&&(a.descriptionText=a.timeEntry.CTDESC);for(var u=!1,E=0;E<a.component.projectListData.PCAT_OBJ.ARR_PCOM.length;E++)if(a.component.projectListData.PCAT_OBJ.ARR_PCOM[E].CMPTID==a.timeEntry.CMPTID){u=!0,a.component.selected=JSON.stringify(a.component.projectListData.PCAT_OBJ.ARR_PCOM[E]),a.isCompoValMsgOn=!1;break}if(!u){p=(l=a.timeEntry.CEP_REC.CLIENO)+"-"+(c=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString())+"-"+(d=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString());if(t("uppercase")(a.cepEnter)==t("uppercase")(p))for(E=0;E<i.length;E++)if(i[E].CMPTID==a.timeEntry.CMPTID){u=!0,a.component.projectListData.PCAT_OBJ.ARR_PCOM.push(i[E]),a.component.selected=JSON.stringify(i[E]),a.isCompoValMsgOn=!1;break}}}else;a.component.projectListData.PCAT_OBJ.ARR_PCOM.sort(function(e,t){return e.ORD-t.ORD}),a.onSelectComponentCode(),"Y"===r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.SCOREQ&&(a.isScopeReq=!0,a.bindScope(r.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ,e.$stateParams.IsEditMode))}})):(a.IsActivity=!0,a.frmValidationParms.IsCepCodeSelected=!0),e.$stateParams.IsEditMode&&a.IsActivity){var n=a.timeEntry.CEP_REC.CLIENO+"-"+(parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString())+"-"+(parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString());t("uppercase")(a.cepEnter)==t("uppercase")(n)&&(a.descriptionText=a.timeEntry.CTDESC)}},a.onSelectComponentCode=function(){if(e.errorLogMethod("SearchCtrl.$scope.onSelectComponentCode"),a.frmValidationParms.isTaskSelected=!1,null!=a.component.selected&&void 0!=a.component.selected&&""!=a.component.selected?a.frmValidationParms.isProjectSelected=!0:a.frmValidationParms.isProjectSelected=!1,a.clearNoComponent(),null!=a.component.selected){var r=JSON.parse(a.component.selected);if("[object Array]"!=Object.prototype.toString.call(r.ARR_PTSK)){o=r.ARR_PTSK;r.ARR_PTSK=[],r.ARR_PTSK.push(o.PTSK_OBJ)}r.ARR_PTSK.length>0&&(r.ARR_PTSK.sort(function(e,t){return e.ORD-t.ORD}),a.task.taskListData=r.ARR_PTSK,e.$stateParams.IsEditMode)}for(var n=[],i=[],s=0;s<a.task.taskListData.length;s++){var o={TSKID:a.task.taskListData[s].TSKID,TSKCD:a.task.taskListData[s].TSKCD,DES:a.task.taskListData[s].DES,ACTIVE:a.task.taskListData[s].ACTIVE,DESREQ:a.task.taskListData[s].DESREQ,DEFDES:a.task.taskListData[s].DEFDES,DEFSCOPID:a.task.taskListData[s].DEFSCOPID,ACTICD:a.task.taskListData[s].ACTICD,ORD:a.task.taskListData[s].ORD};"Y"==a.task.taskListData[s].ACTIVE?n.push(o):i.push(o)}if(a.task.taskListData=n,e.$stateParams.IsEditMode){var l=a.timeEntry.CEP_REC.CLIENO,c=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString(),d=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString(),p=l+"-"+c+"-"+d;t("uppercase")(a.cepEnter)==t("uppercase")(p)&&(a.descriptionText=a.timeEntry.CTDESC);for(var u=!1,s=0;s<a.task.taskListData.length;s++)if(a.task.taskListData[s].TSKID==a.timeEntry.TSKID){u=!0,a.frmValidationParms.isTaskSelected=!0,a.task.selected=JSON.stringify(a.task.taskListData[s]),a.isTaskValdMsgOn=!1;break}if(!u){p=(l=a.timeEntry.CEP_REC.CLIENO)+"-"+(c=parseInt(a.timeEntry.CEP_REC.ENGNO)>99?parseInt(a.timeEntry.CEP_REC.ENGNO).toString():parseInt(a.timeEntry.CEP_REC.ENGNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.ENGNO).toString())+"-"+(d=parseInt(a.timeEntry.CEP_REC.PRJNO)>99?parseInt(a.timeEntry.CEP_REC.PRJNO).toString():parseInt(a.timeEntry.CEP_REC.PRJNO)>9?"0"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString():"00"+parseInt(a.timeEntry.CEP_REC.PRJNO).toString());if(t("uppercase")(a.cepEnter)==t("uppercase")(p))for(s=0;s<i.length;s++)if(i[s].TSKID==a.timeEntry.TSKID){u=!0,a.task.taskListData.push(i[s]),a.frmValidationParms.isTaskSelected=!0,a.task.selected=JSON.stringify(a.task.taskListData[s]),a.isTaskValdMsgOn=!1;break}}a.task.taskListData.length>0&&a.task.taskListData.sort(function(t,a){return e.errorLogMethod("SearchCtrl.$scope.task.taskListData.sort"),t.ORD-a.ORD}),a.frmValidationParms.isTaskSelected||(a.task.selected=null,a.scopeObj.selected=null)}},a.isDescDisable=!1,a.retrieveDescription=function(){e.errorLogMethod("SearchCtrl.$scope.retrieveDescription"),a.onSelectTaskCode(),null!=a.component.selected&&null!=a.task.selected&&("Y"!=JSON.parse(a.task.selected).DESREQ||a.isScopeReq?(a.isDescDisable=!1,a.isScopeReq||a.textAreaDescription()):(a.isDescDisable=!0,e.$stateParams.isCalFlg||(a.description=null),a.loadDescription()))},a.retrieveScopeDescription=function(){e.errorLogMethod("SearchCtrl.$scope.retrieveScopeDescription"),null!=a.component.selected&&null!=a.task.selected&&null!=a.scopeObj.selected&&("Y"==JSON.parse(a.scopeObj.selected).DESREQ?(a.isDescDisable=!0,e.$stateParams.isCalFlg||(a.description=null),a.loadDescription()):(a.isDescDisable=!1,a.textAreaDescription()))},a.textAreaDescription=function(){e.errorLogMethod("SearchCtrl.$scope.textAreaDescription");a.description;if(a.IsActivity)a.description=a.descriptionText;else{if(null==a.component.selected&&null==a.task.selected)return;if(a.isScopeReq&&null==a.scopeObj.selected)return;if(a.description=JSON.parse(a.component.selected).DES+" > "+JSON.parse(a.task.selected).DES,a.isScopeReq&&(a.description=a.description+" > "+JSON.parse(a.scopeObj.selected).DES),""!=a.descriptionText||e.$stateParams.isCalFlg)e.$stateParams.isCalFlg&&""==a.descriptionText?a.description=a.description+" : "+a.desFromImportCal:a.description=a.description+" : "+a.descriptionText,a.setFav(a.description);else{if(JSON.parse(a.task.selected).DEFDES.length>0)return void(a.description=a.description+" : "+JSON.parse(a.task.selected).DEFDES);JSON.parse(a.component.selected).DEFDES.length>0&&(a.description=a.description+" : "+JSON.parse(a.component.selected).DEFDES)}}},a.entryChange=function(){e.errorLogMethod("SearchCtrl.$scope.entryChange"),"IC"==a.entry.value?o.loadICRate(a.loginDetail.SESKEY,a.initialDetail.COMP_REC.COMPID,a.domainURL).then(function(e){0==parseInt(e.LOADICRT_OUT_OBJ.RETCD)&&(a.icListData=e.LOADICRT_OUT_OBJ.ICRATE_ARR)}):a.icListData=[]},a.dailyHour=null,a.description="",a.isCancelCall=!1,a.cancel=function(){if(!a.isCancelCall){a.finalSaveCall=!0;var t=e.GetLoginDetail(!1,!0);null!=t&&void 0!=t&&(a.isCancelCall=!0,e.errorLogMethod("SearchCtrl.$scope.cancel"),l.go("Main",{loadDate:e.$stateParams.startDate,isDailyMode:e.$stateParams.isDailyMode,currentDate:e.$stateParams.currentDate}))}},a.TimeId=1,a.revDisable=function(r){if(e.errorLogMethod("SearchCtrl.$scope.revDisable"),!a.isDailyMode){var n=!1,i=t("date")(a.revenueCurrentMonth.STRTDTE,"yyyy-MM-dd").split("-"),s=i[2].split(" "),o=new Date(i[0],i[1]-1,s[0]),l=new Date(e.$stateParams.startDate.valueOf()),c=l.setDate(l.getDate()+r);if(new Date(o.valueOf())>new Date(c.valueOf())&&(n=!0),!1===n){var d=t("date")(a.initialDetail.EMPL_REC.BRSTDTE,"yyyy-MM-dd");n=e.isDatePriorToBillingDate(d,c)}return n}},a.isSet=!1,a.isHourSet=!1,a.hourId="",a.hourNumber=0,a.setValue=function(){a.isSet=!0},a.setHourValue=function(e,t){a.isHourSet=!0,a.hourId=e,a.hourNumber=t,a.is24HourMsgShown=!1,a.isRoundingMsgShown=!1};a.onFocusCep=function(){a.isSet=!0,a.isCepValdMsgOn=!1,a.oldCep=a.cepEnterText,localStorage.setItem("cepFocus","1")},a.onFocusActivity=function(){(a.frmValidationParms.IsCepCodeSelected||null!=a.cepEnterText||a.cepEnterText.length>0)&&(a.isActValdMsgOn=!1)},a.onFocusComponent=function(){a.isCompoValMsgOn=!1},a.onFocusTask=function(){a.isTaskValdMsgOn=!1},a.onFocusScope=function(){a.isScopeValdMsgOn=!1},a.isDesValid=!1,a.onFocusDescrption=function(){"true"!=angular.element(document.getElementById("txthidden")).val()&&(a.isDesValMsgOn=!1,a.isDesFocused=!0,a.isDesValid=!0)},a.removeTabKey=function(e){c(function(){a.description=a.description.replace(/\n/g," "),a.description=a.description.replace(/\t/g," "),O()})};var M=function(){for(var e=!0,t=1;t<=7;t++)if(angular.element(document.getElementById("wkHrs"+t))[0].validity.badInput){e=!1;break}if(e){e=!1;for(t=0;t<=6;t++)if(null!=a.week[t]&&""!=a.week[t].toString()){e=!0;break}}return e};a.isCepValdMsgOn=!1,a.isActValdMsgOn=!1,a.isDesValMsgOn=!1,a.isCompoValMsgOn=!1,a.isTaskValdMsgOn=!1,a.isScopeValdMsgOn=!1;var N=function(){var e=!0;if(a.isValidHrs=!0,a.isScopeValdMsgOn=a.isTaskValdMsgOn=a.isCompoValMsgOn=a.isDesValMsgOn=a.isActValdMsgOn=a.isCepValdMsgOn=!1,null!=a.cepEnterText&&0!=a.cepEnterText.trim().length&&a.frmValidationParms.IsCepCodeSelected?a.frmValidationParms.IsCepCodeSelected&&(a.IsActivity?null!=a.activity.selected.DES&&0!=a.activity.selected.DES.trim().length||(a.isActValdMsgOn=!0,e=!1):(a.frmValidationParms.isProjectSelected||(a.isCompoValMsgOn=!0,e=!1),a.frmValidationParms.isTaskSelected||(a.isTaskValdMsgOn=!0,e=!1),!0!==a.isScopeReq||null!=a.scopeObj.selected&&""!=a.scopeObj.selected||(a.isScopeValdMsgOn=!0,e=!1))):(a.isCepValdMsgOn=!0,a.IsActivity?a.isActValdMsgOn=!0:(a.isCompoValMsgOn=!0,a.isTaskValdMsgOn=!0,a.isScopeValdMsgOn=a.isScopeReq),e=!1),null!=a.description&&0!=a.description.trim().length||(a.isDesValMsgOn=!0,e=!1),a.isDailyMode){var t=parseFloat(a.dailyHour);isNaN(t)&&(e=!1,a.isValidHrs=!1)}else a.isValidHrs=M(),0==a.isValidHrs&&(e=!1);return e||angular.element(document.getElementById("txthidden")).val(!0),e};a.setValue=function(){a.isValidHrs=!0,a.isSet=!0},a.saveOn=!1,a.enterPress=!1,a.save=function(){a.fucusedItemName=angular.element(window.document.activeElement).attr("id");var r=a.hourNumber;a.enterPress=localStorage.getItem("enterPress"),"1"==a.enterPress?a.enterPress=!0:a.enterPress=!1,a.isFormValid=N(),a.isFormProcess=a.isFormValid;var i=a.isValidHrs;if(a.isPartitionErr=!1,a.InitializeValidationMsg(),a.noOfwarningPopup=0,a.saveOn=!0,a.cancelFlag=!1,a.finalSaveCall=!1,a.is24HourMsgShown=!1,a.isRoundingMsgShown=!1,!a.isSet||a.enterPress){var s=!1;if(a.isHourSet&&a.isFormValid)if(""!=a.hourId)a.checkHours(a.hourId,a.hourNumber),i||(a.isValidHrs=!1),a.isHourSet=!0;else if(!a.enterPress)return;if(a.isDesValid&&a.descriptionBlur(),a.isFormValid){void 0==e.$stateParams.startDate&&(dateVal=new Date);t("date")(e.$stateParams.startDate,"yyyy-MM-dd");var o=JSON.parse(a.task.selected),l=JSON.parse(a.component.selected),c="0";if(!0===a.isScopeReq){var d=JSON.parse(a.scopeObj.selected);c=d.SCOPID}var p="";if(h(),!a.isAnyChange)return;n.loadCEPDetail(a.loginDetail.SESKEY,a.cpecode.CLIEID,a.cpecode.ENGID,a.cpecode.PRJID,a.domainURL).then(function(n){if(0==parseInt(n.LOADCEP_OUT_OBJ.RETCD)){var i=new Date,d=i.getTimezoneOffset();i.setMinutes(i.getMinutes()-d),i.setHours(0,0,0,0);var u=E.createDate(a.revEndDate.substring(0,10));if(u.setHours(0,0,0,0),i>u){var C=e.chekRevDateInLocalStorage(i,t("translate")("msg_invalidSession"),!0);a.newRevEndDate=E.createDate(C.STRTDTE),a.newRevStartDate=E.createDate(C.ENDDTE)}var D={};D=0!=n.LOADCEP_OUT_OBJ.CEP_REC.CATID?{ACTICD:l.ACTICD,DES:"",STAT:"Y",COMPID:0}:a.activity.selected;var g=1;a.isDailyMode||(g=7);var v=[],m=[];e.$stateParams.IsEditMode&&(m=JSON.parse(localStorage.getItem("teid_data")));for(var O=0;O<g;O++){var T,f=new Date(e.$stateParams.startDate.valueOf()),y=!0;a.isDailyMode?(T=parseFloat(a.dailyHour),isNaN(T)?y=!1:T>24&&T<200&&(s||!a.isHourSet&&"dailyHours"!=a.fucusedItemName||(B(0),s=!0))):null!=a.week[O]?T=parseFloat(a.week[O]):(y=!1,e.$stateParams.IsEditMode&&null!=a.weeklyOld[O]&&null==a.week[O]&&!0);var S=f.setDate(f.getDate()+O);S=t("date")(S,"yyyy-MM-dd");var R=e.$stateParams.IsEditMode?a.timeEntry.TEID:0;if(e.$stateParams.IsEditMode&&!e.$stateParams.isDailyMode){P=null;if((R=m[O]).toString().split(",").length>1)for(var P=(_=R.toString().split(","))[0].toString(),I=1;I<_.length;I++)P=P+","+_[I].toString();else if(1==R.toString().split(",").length)var _=R.toString().split(","),P=_[0].toString();null!=P&&(p=""==p?P:p+","+P,R=0)}if(y){var h={TEID:R,DTE:S,CEP_REC:n.LOADCEP_OUT_OBJ.CEP_REC,ACTI_REC:D,ICRTCD:"",ICDESC:"",ICCHRGE:0,HRS:T,DES:a.description,CTDESC:a.descriptionText,CMPTID:a.IsActivity?0:l.CMPTID,CATID:a.IsActivity?0:a.cpecode.CATID,TSKID:a.IsActivity?0:o.TSKID,SCOID:c,REGFLAG:!0===a.isRegulatedChkd?"Y":"N",PRSTCD:null==a.state.selected||""==a.state.selected?"":JSON.parse(a.state.selected).PTXCODE},I=JSON.stringify(h);v.push(I)}}a.isDailyMode||a.week[r]>24&&!s&&a.isHourSet&&B(0),0==v.length&&0==y&&(a.isValidHrs=!1),v.length>0&&F(l,a.IsActivity,n.LOADCEP_OUT_OBJ.CEP_REC,v)?a.callSave(v,p):(a.saveOn=!1,a.isFormProcess=!1)}}),localStorage.save=!0}else if(a.isHourSet)if(""!=a.hourId)a.checkHours(a.hourId,a.hourNumber),a.isFormProcess=!0,i||(a.isValidHrs=!1),a.isHourSet=!1,0==a.noOfwarningPopup&&(a.enterPress=!1,a.saveOn=!1);else if(!a.enterPress)return void(a.saveOn=!1);localStorage.setItem("enterPress","0")}};var L=function(){for(var e=a.initialDetail.COMP_REC.TINT,r=0;r<a.arrFlagRound.length;r++)if(1==a.arrFlagRound[r]){var n=t("translate")("msg_HoursRound",{TINT:e});a.isRoundingMsgShown=!0,a.loadErrorPopup(!1,n),a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1,a.noOfwarningPopup>1&&a.enterPress&&0==a.fucusedItemName.indexOf("wkHrs")&&$("#"+a.fucusedItemName).trigger("blur");break}a.isRoundingMsgShown=!0};a.callSave=function(t,r){e.$stateParams.isDailyMode||a.isRoundingMsgShown||L(),e.errorLogMethod("SearchCtrl.$scope.callSave"),0==a.noOfwarningPopup?(a.enterPress=!1,a.saveOn=!1,a.finalSave(t,r)):(a.json=t,a.deleteEntry=r)};var b=function(){e.errorLogMethod("SearchCtrl.loadHomePage"),l.go("Main",{loadDate:e.$stateParams.startDate,isDailyMode:e.$stateParams.isDailyMode,currentDate:e.$stateParams.currentDate})};a.finalSave=function(e,t){n.saveTimeSheet(a.loginDetail.SESKEY,a.loginDetail.EMPLID,e[0],a.domainURL).then(function(r){0==parseInt(r.SAVTIM_OUT_OBJ.RETCD)?(e.splice(0,1),e.length>0?a.finalSave(e,t):null!=t&&t.trim().length>0?u.deleteTimeEntries(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t).then(function(e){0==parseInt(e.DELTIM_OUT_OBJ.RETCD)?b():a.loadErrorPopup(!0,e.DELTIM_OUT_OBJ.ERRMSG)}):b()):k(r.SAVTIM_OUT_OBJ.ERRMSG,e,t)||a.loadErrorPopup(!0,r.SAVTIM_OUT_OBJ.ERRMSG)})};var k=function(r,n,i){if(e.errorLogMethod("SearchCtrl.chekForDBPartitionError"),null!=r&&""!=r&&(r=r.toLowerCase()).indexOf("database partition")>0){for(var s="",o=0;o<n.length;o++){var l=JSON.parse(n[o]),c=E.createDate(l.DTE);c=t("date")(c,"dd-MMM-yyyy"),s=""==s?c:s+","+c}if(""!=s){a.isPartitionErr=!0;var d=t("translate")("msg_DBParttionEr",{dateValue:s});e.$stateParams.isDailyMode,a.loadErrorPopup(!0,d),a.callDeleteAPI(i,!1,!1)}}return a.isPartitionErr};a.callDeleteAPI=function(t,r,n){e.errorLogMethod("SearchCtrl.$scope.callDeleteAPI"),null!=t&&t.trim().length>0&&u.deleteTimeEntries(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t).then(function(e){0==parseInt(e.DELTIM_OUT_OBJ.RETCD)?r&&b():n&&a.loadErrorPopup(!0,e.DELTIM_OUT_OBJ.ERRMSG)})},a.isValidHrs=!0,a.finalSaveCall=!1,a.checkHours=function(r,n){if(e.errorLogMethod("SearchCtrl.$scope.checkHours"),a.isHourSet&&!a.finalSaveCall){a.isHourSet=!1,a.hourId="",a.hourNumber=0;document.activeElement;if(a.isValidHrs=!0,a.isDailyMode){if((s=angular.element(document.getElementById(r))[0]).validity.badInput)return void(a.isValidHrs=!1)}else for(var i=1;i<=7;i++){var s=angular.element(document.getElementById("wkHrs"+i))[0];if(s.validity.badInput){a.isValidHrs=!1;break}}var o=angular.element(document.getElementById(r)).val();if(null!=o&&""!=o){Number(o);var l=a.initialDetail.COMP_REC.TINT;if(o=w(o,l,n),a.isDailyMode||(a.weekOldData[n]=o),angular.element(document.getElementById(r)).val(o).trigger("input"),e.$stateParams.IsEditMode&&a.isDailyMode&&a.isRoundingMsgShown&&0==a.noOfwarningPopup){if(a.saveOn&&(h(),!a.isAnyChange))return;var c=t("translate")("msg_HoursRound",{TINT:l});a.loadErrorPopup(!1,c),a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1}if(!a.saveOn&&!a.enterPress||!a.isFormProcess){if(!a.isDailyMode&&!a.saveOn&&!a.enterPress&&a.noOfwarningPopup>0)return;if(o>200)return void a.loadErrorPopup(!0,a.frmValidationParms.exHour1);if(o<-200)return void a.loadErrorPopup(!0,a.frmValidationParms.exHour2);o>24&&o<200&&B(n)}}else a.week[n]=null,$("#"+a.fucusedItemName).trigger("focus")}};var J=function(e,r){for(var n={bilingDteEr:"",inValidFutureTEEr:"",negHrsMsg:"",excHrsMsg:"",excNegHrsMsg:""},i=t("date")(a.initialDetail.EMPL_REC.BRSTDTE,"yyyy-MM-dd").split("-"),s=i[2].split(" "),o=new Date(i[0],i[1]-1,s[0]),l=0;l<e.length;l++){var c=JSON.parse(e[l]);if(parseFloat(c.HRS)>200&&""==n.excHrsMsg&&(n.excHrsMsg=a.frmValidationParms.exHour1),parseFloat(c.HRS)<-200&&""==n.excNegHrsMsg&&(n.excNegHrsMsg=a.frmValidationParms.exHour2),""==n.bilingDteEr&&E.createDate(c.DTE)<o){var d=o.toString().split(" "),p=d[2]+"-"+d[1]+"-"+d[3];n.bilingDteEr=t("translate")("msg_TimePriorToBillingStartDate",{dateVal:p})}""==n.inValidFutureTEEr&&I(c)&&(n.inValidFutureTEEr=t("translate")("msg_FutureTimeEntry")),""===n.negHrsMsg&&parseFloat(c.HRS)<0&&(n.negHrsMsg=D.validateTENegValue(c,a.initialDetail,!0))}return""!=n.bilingDteEr&&r.push(n.bilingDteEr),""!==n.inValidFutureTEEr&&r.push(n.inValidFutureTEEr),""!==n.negHrsMsg&&r.push(n.negHrsMsg),""!==n.excHrsMsg&&r.push(n.excHrsMsg),""!==n.excNegHrsMsg&&r.push(n.excNegHrsMsg),n},F=function(r,n,i,s){e.errorLogMethod("SearchCtrl.validateTimeEntry");var o=JSON.parse(s[0]),l=[],c=a.initialDetail.COMP_REC.BCHB,r=JSON.parse(a.component.selected),d=JSON.parse(a.task.selected),p=JSON.parse(a.scopeObj.selected);if("Y"!=i.CLIEACTIVE||"Y"!=i.ENGACTIVE||"Y"!=i.PRJACTIVE)return a.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=i.ENGTIMFLAG&&l.push(t("translate")("msg_SelectAnotherEng")),"Y"!=i.PRJTIMFLAG&&l.push(t("translate")("msg_SelectAnotherPrj")),null!=c&&""!=c)for(var u=0;u<c.length;u++)i.CHARBASIS==c.charAt(u)&&l.push(t("translate")("msg_CEPChargeBasisErr"));if("Y"!=o.ACTI_REC.STAT&&null!=o.ACTI_REC.ACTICD&&""!=o.ACTI_REC.ACTICD&&l.push(t("translate")("msg_InActiveActivity")),null==o.ACTI_REC.ACTICD||""==o.ACTI_REC.ACTICD||void 0==o.ACTI_REC.ACTICD)return!1;if(J(s,l),null!=r&&""!=r&&null!=d&&""!=d&&("Y"==r.ACTIVE&&"Y"==d.ACTIVE||l.push(t("translate")("msg_invalidProjectComponent"))),null!=p&&""!=p&&"Y"!=p.ACTIVE&&l.push(t("translate")("msg_PrjScopNotValid")),a.frmValidationParms.isDesReq=!0,a.saveDailyCalFrm.cepDes.$touched=!0,""==a.description||null==a.description)return!1;if(l.length>0)return l.length>2&&((l=l.slice(0,2))[2]=t("translate")("msg_TEMultipleErr")),l.length>1&&(l[0]="- "+l[0],l[1]="- "+l[1]),a.loadErrorPopup(!0,l),!1;if(null!=i.RENPRJNO&&" "!=i.RENPRJNO&&void 0!==i.RENPRJNO&&!a.isSubmit){var E=parseInt(i.RENPRJNO)>99?parseInt(i.RENPRJNO).toString():parseInt(i.RENPRJNO)>9?"0"+parseInt(i.RENPRJNO).toString():"00"+parseInt(i.RENPRJNO).toString(),C=i.CLIENO+"-"+i.ENGNO+"-"+i.PRJNO;return a.loadErrorPopup("z",t("translate")("msg_ProjectRenewedPaste",{pName:E,cepProject:C})),a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1,!0}return!0};a.weekOldData=[null,null,null,null,null,null,null],a.arrFlagRound=[!1,!1,!1,!1,!1,!1,!1];var w=function(r,n,i){e.errorLogMethod("SearchCtrl.getNearestMultple");if("0"==n)return parseFloat(r).toFixed(2);if(0!=r%n)if(a.isDailyMode){if(a.isRoundingMsgShown=!0,!e.$stateParams.IsEditMode){var s=t("translate")("msg_HoursRound",{TINT:n});a.loadErrorPopup(!1,s),a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1}}else a.arrFlagRound[i]=!0;else a.isDailyMode||(null==a.weekOldData[i]?a.arrFlagRound[i]=!1:a.weekOldData[i]!=r&&(a.arrFlagRound[i]=!1));return r>0?(Math.ceil(r/n)*n).toFixed(2):r<0?(Math.floor(r/n)*n).toFixed(2):parseFloat(r).toFixed(2)},B=function(r){e.errorLogMethod("SearchCtrl.consfirmSave");var n=new Date(e.$stateParams.startDate),i=t("date")(n,"dd-MMM-yyyy");i=a.isDailyMode?t("translate")("msg_24HrsDay",{dateVal:i}):t("translate")("msg_24HrsWeek",{dateVal:i}),a.loadErrorPopup(!1,i),a.warningPopup=!0,a.noOfwarningPopup=a.noOfwarningPopup+1,a.is24HourMsgShown=!0};a.sortCEP=function(t){return e.errorLogMethod("SearchCtrl.$scope.sortCEP"),t.sort(function(e,t){return e.ENGNO-t.ENGNO})},a.sortCEPSrch=function(t){e.errorLogMethod("SearchCtrl.$scope.sortCEP");for(var a=0;a<t.length;a++)1==t[a].ENGNO.length&&(t[a].ENGNO="00"+t[a].ENGNO),2==t[a].ENGNO.length&&(t[a].ENGNO="0"+t[a].ENGNO),1==t[a].PRJNO.length&&(t[a].PRJNO="00"+t[a].PRJNO),2==t[a].PRJNO.length&&(t[a].PRJNO="0"+t[a].PRJNO);return t},a.Search=function(){if(e.errorLogMethod("SearchCtrl.$scope.Search"),!a.isSet){var t="",r="",n=e.$stateParams.isCalFlg;t=e.$stateParams.isDailyMode?a.dailyHour:a.week,r=a.description,l.go("mSearch",{startDate:e.$stateParams.startDate,searchKeyword:a.cepEnter,isDailyMode:e.$stateParams.isDailyMode,IsEditMode:e.$stateParams.IsEditMode,currentDate:e.$stateParams.currentDate,Hours:t,Description:r,isCalFlg:n})}},a.isNoMoreData=!1,a.mFindCEPCode=function(){var t=angular.element(document.getElementById("txtSrch")).val();t!=a.findCepCode&&null!=t&&""!=t&&(a.findCepCode=t),a.isNoMoreData=!1,e.errorLogMethod("SearchCtrl.$scope.mFindCEPCode"),a.searchRslObj.pageNumber=1,a.searchRslObj.items.splice(0),a.$broadcast("update_find_result"),angular.element(document.getElementById("btnSearch")).focus()},a.$on("update_find_result",function(){e.errorLogMethod("SearchCtrl.$scope.$on.update_find_result");a.findCepCodeList=[];var t=a.searchRslObj.DataPerPage,r=a.searchRslObj.pageNumber;g&&(t=a.searchRslObj.pageNumber*t,r=1),n.searchCEPCode(a.loginDetail.SESKEY,a.loginDetail.EMPLID,a.findCepCode,r,t,"38 DESC,2,5,8",a.initialDetail.COMP_REC.COMPID,a.domainURL).then(function(e){if(void 0==e.LOOKCEP_OUT_OBJ.CEP_ARR||0==e.LOOKCEP_OUT_OBJ.CEP_ARR.length||void 0==e.LOOKCEP_OUT_OBJ.CEP_ARR.length)return a.searchRslObj.busy=!0,a.searchRslObj.loadMsg=a.noMoreData,void(a.isNoMoreData=!0);if(a.isSearchClick=!0,"[object Array]"!=Object.prototype.toString.call(e.LOOKCEP_OUT_OBJ.CEP_ARR)){var t=e.LOOKCEP_OUT_OBJ.CEP_ARR;e.LOOKCEP_OUT_OBJ.CEP_ARR=[],e.LOOKCEP_OUT_OBJ.CEP_ARR.push(t.CEP_DET_OBJ)}var r=a.sortCEPSrch(e.LOOKCEP_OUT_OBJ.CEP_ARR);g&&(a.searchRslObj.items=[],g=!1);for(var n=a.searchRslObj.items.length,i=0;i<r.length;i++)"000000"!==r[i].CLIENO&&(r[i].index=n,r[i].fav="Y"==r[i].CEPFAV,a.searchRslObj.items.push(r[i]),n++);var s=parseInt(parseInt(e.LOOKCEP_OUT_OBJ.TOTAVAIL));s>0?a.searchRslObj.TotalPages=Math.ceil(s/a.DataPerPage):a.TotalPages=0,a.searchRslObj.pageNumber=a.searchRslObj.pageNumber+1,a.TotalPages=parseInt(parseInt(e.LOOKCEP_OUT_OBJ.TOTAVAIL)),a.searchRslObj.busy=!1})}),a.cancelSearch=function(){e.errorLogMethod("SearchCtrl.$scope.cancelSearch"),e.isRefresh=!1;var t="",a="",r=e.$stateParams.isCalFlg;t=e.$stateParams.Hours,a=e.$stateParams.Description,l.go("mNewEntry",{startDate:e.$stateParams.startDate,IsSearch:!1,isDailyMode:e.$stateParams.isDailyMode,IsEditMode:e.$stateParams.IsEditMode,currentDate:e.$stateParams.currentDate,Hours:t,Description:a,isCalFlg:r,isCancelSearch:!0})},a.sendDataBack=function(t){e.errorLogMethod("SearchCtrl.$scope.sendDataBack"),localStorage.setItem("Search_Data",JSON.stringify(a.searchRslObj.items[t])),e.isRefresh=!1;var r="",n="",i=e.$stateParams.isCalFlg;r=e.$stateParams.Hours,n=e.$stateParams.Description,l.go("mNewEntry",{startDate:e.$stateParams.startDate,IsSearch:!0,isDailyMode:e.$stateParams.isDailyMode,IsEditMode:e.$stateParams.IsEditMode,currentDate:e.$stateParams.currentDate,Hours:r,Description:n,isCalFlg:i})},a.loadErrorPopup=function(t,r){e.errorLogMethod("SearchCtrl.$scope.loadErrorPopup");var n={isError:t,message:r};a.openModalCtrl="ErrorPopup",a.open("templates/ErrorPopup.html","ErrorPopup",n)},a.loadFavCEP=function(){if(e.errorLogMethod("SearchCtrl.$scope.loadFavCEP"),!a.isSet){var t={cepCode:a.cepEnter};a.openModalCtrl="FavSearchCtrl",a.open("templates/FavCEP.html","FavSearchCtrl",t)}},a.loadActivity=function(){if(e.errorLogMethod("SearchCtrl.$scope.loadActivity"),!a.isSubmit&&a.frmValidationParms.IsCepCodeSelected){a.isActValdMsgOn=!1,!1===a.frmValidationParms.isActivitySel&&(a.activity.selected={DES:a.frmValidationParms.activityTitle});var t={compId:a.cpecode.COMPID};a.cpecode.COMPID==a.initialDetail.COMP_REC.COMPID&&(a.isSameCompany=!0),a.openModalCtrl="ActivityCtrl",a.open("templates/Activity.html","ActivityCtrl",t)}},a.ActivityFavList=[];var x=function(){if(a.cpecode.COMPID==a.initialDetail.COMP_REC.COMPID){if(a.isSameCompany=!0,a.ActivityFavList=JSON.parse(localStorage.getItem("ActivityFav")),null!=a.ActivityFavList&&a.ActivityFavList.length>0)return;s.retrieveActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID).then(function(e){if(0==e.RETACTIFAV_OUT_OBJ.RETCD){if(a.activityList=e.RETACTIFAV_OUT_OBJ.ACTI_ARR,"[object Array]"!=Object.prototype.toString.call(e.RETACTIFAV_OUT_OBJ.ACTI_ARR)){var t=e.RETACTIFAV_OUT_OBJ.ACTI_ARR;e.RETACTIFAV_OUT_OBJ.ACTI_ARR=[],null!=t&&null!=t.ACTI_OBJ&&void 0!=t.ACTI_OBJ&&e.RETACTIFAV_OUT_OBJ.ACTI_ARR.push(t.ACTI_OBJ)}var r=e.RETACTIFAV_OUT_OBJ.ACTI_ARR,n=0;if(a.ActivityFavList=[],null!=r)for(var i=0;i<r.length;i++)"Y"==r[i].STAT&&(r[i].index=n,r[i].fav=!0,a.ActivityFavList.push(r[i]),n++);localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList))}})}else a.ActivityFavList=[]};a.addActivityFavorited=function(){if(null!=a.activity.selected.ACTICD){var e={VARCHAR2:[a.activity.selected.ACTICD.toString()]},r=JSON.stringify(e);!V(a.activity.selected)&&a.isSameCompany?s.addActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,r).then(function(e){0==e.ADDACTIFAV_OUT_OBJ.RETCD&&(a.AcivityFev=!0,localStorage.removeItem("ActivityFav"),a.ActivityFavList.push(a.activity.selected),localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList)))}):(a.AcivityFev=!1,a.loadErrorPopup(!1,t("translate")("msg_ActivityExistAsFav")))}},a.removeActivityFavorites=function(){if(null!=a.activity.selected){var e={VARCHAR2:[a.activity.selected.ACTICD.toString()]},t=JSON.stringify(e);V(a.activity.selected)&&a.isSameCompany?s.removeActivityFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t).then(function(e){if(0==e.REMACTIFAV_OUT_OBJ.RETCD){a.AcivityFev=!1,localStorage.removeItem("ActivityFav");for(var t=0;t<a.ActivityFavList.length;t++)a.ActivityFavList[t].ACTICD==a.activity.selected.ACTICD&&a.ActivityFavList.splice(t,1);localStorage.setItem("ActivityFav",JSON.stringify(a.ActivityFavList))}}):a.AcivityFev=!0}};var V=function(e){var t=!1;if(0==a.ActivityFavList.length&&x(),a.isSameCompany)for(var r=0;r<a.ActivityFavList.length;r++)if(a.ActivityFavList[r].ACTICD==e.ACTICD){t=!0;break}return t},H=function(t){e.errorLogMethod("SearchCtrl.validateHrsBeforeLdingDes");var r=angular.element(document.getElementById(t)).val();if(null!=r&&""!=r){Number(r);var n=a.initialDetail.COMP_REC.TINT,i=U(r,n);if(i<-200||i>200)return!1;if(i>24&&i<200)return!1;if(a.isDailyMode&&i!=parseFloat(r).toFixed(2))return!1}return!0},U=function(t,a){e.errorLogMethod("SearchCtrl.findNearestMultiple");return"0"==a?parseFloat(t).toFixed(2):t>0?(Math.ceil(t/a)*a).toFixed(2):t<0?(Math.floor(t/a)*a).toFixed(2):parseFloat(t).toFixed(2)};a.loadDescription=function(){if(!(a.isHourSet&&""!=a.hourId&&0==H(a.hourId)||(e.errorLogMethod("SearchCtrl.$scope.loadDescription"),a.isSubmit))){var t=null;a.IsActivity||(e.$stateParams.isCalFlg?(null!=a.descriptionText&&""!=a.descriptionText||(a.descriptionText=a.desFromImportCal),t=a.descriptionText):(null!=a.task.selected&&JSON.parse(a.task.selected).DEFDES.trim().length>0?t=(t=(t=JSON.parse(a.task.selected).DEFDES).replace(/\n/g," ")).replace(/\t/g," "):null!=a.component.selected&&JSON.parse(a.component.selected).DEFDES.trim().length>0&&(t=(t=(t=JSON.parse(a.component.selected).DEFDES).replace(/\n/g," ")).replace(/\t/g," ")),e.$stateParams.IsEditMode?t=a.descriptionText:null!=a.descriptionText&&""!=a.descriptionText&&(t=a.descriptionText)));var r={IsActivity:a.IsActivity,desc:t};a.openModalCtrl="DescriptionCtrl",a.open("templates/Description.html","DescriptionCtrl",r)}};var G=function(){localStorage.removeItem("CEPFav"),localStorage.removeItem("TOTFavAVAIL"),R()};a.addCEPFavorited=function(e,t,r){var i={NUMBER:[0==e?a.cpecode.PRJID:t.PRJID]},s=JSON.stringify(i);e&&(r.preventDefault(),r.stopPropagation()),n.addCEPFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,s).then(function(r){0==parseInt(r.ADDCEPFAV_OUT_OBJ.RETCD)&&(g=!0,e?t.fav=!0:(a.selectCEPFev=!0,a.selectCEPNonFev=!1),G())})},a.removeCEPFavorites=function(e,t,r){var i={NUMBER:[0==e?a.cpecode.PRJID:t.PRJID]},s=JSON.stringify(i);e&&(r.preventDefault(),r.stopPropagation()),n.removeCEPFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,s).then(function(r){g=!0,0==parseInt(r.REMCEPFAV_OUT_OBJ.RETCD)&&(e?t.fav=!1:(a.selectCEPFev=!1,a.selectCEPNonFev=!0),G())})},a.descFav=[];var Y=function(t){e.errorLogMethod("SearchCtrl.getFavDescription"),t&&localStorage.removeItem("DescFav");var r=localStorage.getItem("DescFav");""==r||null==r?n.retrieveDescriptionFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID).then(function(e){if(0==e.RETDESCFAV_OUT_OBJ.RETCD){if("[object Array]"!=Object.prototype.toString.call(e.RETDESCFAV_OUT_OBJ.DESTXT_ARR)){var t=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR;e.RETDESCFAV_OUT_OBJ.DESTXT_ARR=[],null!=t&&void 0!=t.VARCHAR2&&e.RETDESCFAV_OUT_OBJ.DESTXT_ARR.push(t.VARCHAR2)}a.descFav=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR}localStorage.setItem("DescFav",JSON.stringify(a.descFav))}):a.descFav=JSON.parse(r)};a.addDescriptionFavorite=function(){if(a.description=a.description.trim(),0!=a.description.length)if(O()){var e=t("translate")("msg_DuplicateDescription");a.loadErrorPopup(!1,e)}else n.addDescriptionFavorite(a.loginDetail.SESKEY,a.loginDetail.EMPLID,JSON.stringify(a.description)).then(function(e){0==e.ADDDESCFAV_OUT_OBJ.RETCD&&(Y(!0),a.favDesc=!0)})},a.removeDescriptionFavorites=function(){if(0!=a.description.length){var e={VARCHAR2:[a.description]},t=JSON.stringify(e);O()?n.removeDescriptionFavorites(a.loginDetail.SESKEY,a.loginDetail.EMPLID,t).then(function(e){0==e.REMDESCFAV_OUT_OBJ.RETCD&&(Y(!0),a.favDesc=!1)}):a.favDesc=!1}}}]).controller("HomeCtrl","$rootScope",["$scope",function(e,t){e.TotalPages=0,e.PageNumber=0,e.DataPerPage=0,e.$on("update_child_controller",function(a,r,n,i){t.errorLogMethod("HomeCtrl.$scope.$on.update_child_controller"),e.TotalPages=r,e.PageNumber=n,e.DataPerPage=i})}]).controller("DailyTimeGridCtrl",["$scope","$filter","uiGridConstants","$http","gridDataService","cepService","projectComponetService","$timeout","loadRevenueMonthsServices","broadcastService","loginService","preferencesService","$rootScope","$state","$modal","$q","$window","dateService","constantService","$locale","$translate","$interval","broadcastMessageServices","activityService","futureEntryService","timeEntryNextRevenueService","commonUtilityService","retrieveSharedService",function(e,t,a,r,n,s,o,l,c,d,p,u,E,C,D,g,v,m,O,T,f,y,S,R,P,I,_,h){function A(){var t=E.GetLoginDetail(!1,!0);S.getBroadcastMessage(t.SESKEY,O.CURRENTLANGUAGE).then(function(t){if(0==parseInt(t.RETBROAD_OUT_OBJ.RETCD)&&(void 0!=t.RETBROAD_OUT_OBJ.MSG_ARR||0!=t.RETBROAD_OUT_OBJ.MSG_ARR.length)){var a=t.RETBROAD_OUT_OBJ.MSG_ARR;if(a.length>0)for(var r=0;r<a.length;r++){var n=a[r].MSGID,i={message:s=a[r].MSG,issubmit:!1,isCancelBtnOn:!0,messageid:n};e.openmodalctrl="ConfirmBroadcastMessage",e.open("templates/ConfirmBroadcastMessage.html","ConfirmBroadcastMessage",i)}else if("object"==typeof t.RETBROAD_OUT_OBJ.MSG_ARR&&0!=t.RETBROAD_OUT_OBJ.MSG_ARR.MSG_OBJ.MSGID){var n=t.RETBROAD_OUT_OBJ.MSG_ARR.MSG_OBJ.MSGID,s=t.RETBROAD_OUT_OBJ.MSG_ARR.MSG_OBJ.MSG,i={message:s,issubmit:!1,isCancelBtnOn:!0,messageid:n};e.openmodalctrl="ConfirmBroadcastMessage",e.open("templates/ConfirmBroadcastMessage.html","ConfirmBroadcastMessage",i)}}})}function M(e){var t=new Date(h.getMonthName(e)+" 1, 2000").getMonth();return isNaN(t)?0:t+1}function N(e,t){E.errorLogMethod("DailyTimeGridCtrl.fn.datedifference");var a=parseInt((e-t)/864e5),r=parseInt(Math.abs(e.getTime()-t.getTime())/6e4%60),n=parseInt(Math.abs(e-t)/36e5%24),i=e.getTime()-t.getTime(),s={};return s.day=a,s.hours=n,s.minutes=r,s.milliSec=i,s}function L(){E.errorLogMethod("DailyTimeGridCtrl.fn.callMonthEndAtIntervalMobile");e.loginDetail=E.GetLoginDetail(!1,!0);var a=JSON.parse(localStorage.getItem("MonthEndCountdownRevenueMonth")),r=null;if(null!=a&&0!=a.length){var n=t("date")(new Date,"yyyy-MM-dd");(new Date).getTimezoneOffset()>0&&(n=t("date")(new Date("sessiontimeout"),"yyyy-MM-dd"));for(var i=0;i<a.length;i++)if(null!=a[i]&&void 0!=a[i]&&void 0!=a[i].STRTDTE&&V(n)>=V(a[i].STRTDTE)&&V(n)<=V(a[i].ENDDTE)){r=a[i];break}}var s=E.GetInitialDetail(!1,!1),o=s.REVM_REC.TECUTTOFF;if(void 0!=r&&null!=r&&0!=r.length){o=r.TECUTTOFF,o=H(o);var l=H(r.STRTDTE),c=H(r.ENDDTE),d=H(s.REVM_REC.ENDDTE),u=ee(d,1),C=new Date,D=new Date;if("1"!=localStorage.getItem("CutOff_Occured")&&(e.closedmonth=""),l.getFullYear()+"-"+l.getMonth()+"-"+l.getDate()==D.getFullYear()+"-"+D.getMonth()+"-"+D.getDate())e.closedmonth=u.monthname+" "+u.year+t("translate")("msg_nwClosed");else if(o.getTime()+1e4>C.getTime()){var g=[];if((g=N(o,C)).milliSec<0){var v=ee(d,0);if(y.cancel(E.callMonthEndAtIntervalMobile),E.callMonthEndAtIntervalMobile=y(L,6e4),o.getFullYear()+"-"+o.getMonth()+"-"+o.getDate()==C.getFullYear()+"-"+C.getMonth()+"-"+C.getDate()){"1"!=localStorage.getItem("CutOff_Occured")&&(e.closedmonth=v.monthname+" "+v.year+t("translate")("msg_nwClosed"));var m=new Date,O=m.getTimezoneOffset();m.setMinutes(m.getMinutes()-O);var T=angular.copy(e.currentDate);T.setHours(0,0,0,0),T>=l&&T<=c&&(e.monthendcheck||(p.retrieveInitialData(e.loginDetail.SESKEY,e.loginDetail.EMPLID).then(function(e){0==parseInt(e.RETINIT_OUT_OBJ.RETCD)&&(localStorage.setItem("CutOff_Occured","1"),localStorage.setItem("InitialMobile_Data",JSON.stringify(e.RETINIT_OUT_OBJ)),localStorage.setItem("Initial_Data",JSON.stringify(e.RETINIT_OUT_OBJ)))}),e.monthendcheck=!0))}y.cancel(E.callMonthEndAtIntervalMobile),"1"!=localStorage.getItem("CutOff_Occured")&&(e.closedmonth=v.monthname+" "+v.year+t("translate")("msg_nwClosed")),e.checkRevMonthFlag=!1,e.isSbmtOpen=!1}else 0==g.day&&g.hours<2&&(y.cancel(E.callMonthEndAtIntervalMobile),E.callMonthEndAtIntervalMobile=y(L,6e4),g.milliSec<6e4?(y.cancel(E.callMonthEndAtIntervalMobile),E.callMonthEndAtIntervalMobile=y(L,5e3)):g.milliSec<12e4&&(y.cancel(E.callMonthEndAtIntervalMobile),E.callMonthEndAtIntervalMobile=y(L,1e4)))}else o.getTime()<C.getTime()&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1,e.closedmonth=u.monthname+" "+u.year+t("translate")("msg_nwClosed"))}}e.monthlyTtlHrs=0,E.isNonADLogin=!1,void 0==E.isCalOpen&&(E.isCalOpen=!1),e.getWeeklyDayDate=function(e,t){var a=new Date(e.valueOf());return a.setDate(a.getDate()+t),a},e.expandEntry=function(t,a){var r="fa fa-plus",n=!1;2==E.cntrExpandCollapse&&(E.cntrExpandCollapse=1),"none"==$("."+t).css("display")?($("."+t).css("display","block"),$(".weekly-details.task-container."+t.replace("exp","")).css("padding-bottom","28px"),e.autoToggleExpandAllButton(-1,1),e.expandEntryToggle(t)&&(r="fa fa-minus",n=!0)):($("."+t).css("display","none"),$(".weekly-details.task-container."+t.replace("exp","")).css("padding-bottom","11px"),e.autoToggleExpandAllButton(1,-1),e.expandEntryToggle(t)&&(r="fa fa-minus",n=!0)),e.isDailyMode?(e.gridData[a].class=r,e.gridData[a].isOpen=n):(e.itemsDataFinal1[a].data.class=r,e.itemsDataFinal1[a].data.isOpen=n)},e.autoToggleExpandAllButton=function(t,a){var r=".tab1 ul li i";0==e.isDailyMode&&(r=".tab2 ul li i");var n=$(r).filter(".fa-minus").length+a;$(r).filter(".fa-plus").length+t<=0&&(console.log("all item expanded"),e.expandClass="fa fa-minus",e.expandAllText="Collapse All"),n<=0&&(console.log("all item collapsed"),e.expandClass="fa fa-plus",e.expandAllText="Expand All")},e.expandEntryWeekBlock=function(e,t){return"block"==e?$("#week"+t).css("padding-bottom","28px"):$("#week"+t).css("padding-bottom","11px"),e},null!=E.cntrExpandCollapse&&void 0!=E.cntrExpandCollapse||(E.cntrExpandCollapse=0),e.expandEntryToggle=function(t){var a=!1;if(void 0!=E.expandedEntries.length)for(var r=0;r<E.expandedEntries.length;r++)if(E.expandedEntries.indexOf(t)>-1){a=!0;break}return void 0!=$("."+t).css("display")||a?"none"==$("."+t).css("display")?(E.expandedEntries.indexOf(t)>-1&&E.expandedEntries.splice(E.expandedEntries.indexOf(t),1),E.collapsedEntries.indexOf(t)<0&&E.collapsedEntries.push(t),a=!1):(-1==E.expandedEntries.indexOf(t)&&2!=E.cntrExpandCollapse&&(E.expandedEntries.push(t),E.collapsedEntries.splice(E.collapsedEntries.indexOf(t),1)),a=!0):e.isDefaultExpanded&&-1==E.expandedEntries.indexOf(t)&&2!=E.cntrExpandCollapse&&(E.expandedEntries.push(t),E.collapsedEntries.splice(E.collapsedEntries.indexOf(t),1),a=!0),0==E.cntrExpandCollapse?(e.isDefaultExpanded?(e.expandAllText="Collapse All",e.expandClass="fa fa-minus",$(".weekly-details.task-container").css("padding-bottom","28px")):(e.expandAllText="Expand All",e.expandClass="fa fa-plus",$(".weekly-details.task-container").css("padding-bottom","11px")),2==E.cntrExpandCollapse?E.cntrExpandCollapse=2:E.cntrExpandCollapse=1):2==E.cntrExpandCollapse&&(E.expandedEntries.indexOf(t)<0&&E.collapsedEntries.indexOf(t)<0&&(a=!1,"fa fa-minus"==E.lastExpandClass&&(a=!0)),e.expandAllText=E.lastExpandAllText,e.expandClass=E.lastExpandClass),a},void 0!=E.isCallAtInterval&&E.isCallAtInterval||(A(),E.isCallAtInterval=!0),e.isSbmtOpen=!0,e.prjScopeNoValidMsg="Project Scope is no longer valid.",e.isPasteClickedExists=!1,void 0!=E.isPasteClicked&&null!=E.isPasteClicked?e.isPasteClickedExists=!0:E.isPasteClicked=!1,e.weeklyMaxTEIDCommon=0,e.isWeeklyMaxTEIDExists=!1,void 0!=E.weeklyMaxTEID&&null!=E.weeklyMaxTEID?e.isWeeklyMaxTEIDExists=!0:E.weeklyMaxTEID=[],localStorage.SelectedCalendardate=null;var b=function(){E.errorLogMethod("DailyTimeGridCtrl.usrPreference"),this.viewPref={isDailymode:!0,isFetch:!1,detail:null}};e.objUsrPreference=new b,e.onSubmitMsg="Submitted {xyz} time entries between {sdate} and {edate}.",window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)});var k=$(document).height(),J=$(window).height(),F=$(".container-fluid").width();$(".navigation").height(J),$(".overlay").height(k),$(".overlay").width(F);var w=$(".navigation").width();$(".navigation").css("left",-w),$(".page_header .menu").click(function(){$(".navigation").animate({left:"0"},500),$(".overlay").fadeIn(500);var e=$(document).height(),t=$(window).height(),a=$(".container-fluid").width();$(".navigation").height(t),$(".overlay").height(e),$(".overlay").width(a);var r=$(".navigation").width();$(".navigation").css("left",-r)}),$(".overlay").click(function(){$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500)});var B=$(window).width();parseInt(B);$(".nav-back").click(function(){$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500)}),$(".import-cal").click(function(){$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500)}),$(".cal-icon").click(function(){}),$(".well-sm").click(function(){$(".calender-container").css("display","none"),$(".overlay").css("display","none")}),$(".overlay").click(function(){$(".calender-container").css("display","none"),$(".overlay").css("display","none")}),$(".bottom-footer .submit").click(function(){$(".sub_popup").css("display","block"),$(".overlay").css("display","block")}),$(".bottom-footer ul li a").click(function(){$(".bottom-footer ul li a").removeClass("btn-grd2"),$(this).addClass("btn-grd2")}),$(".bottom-footer ul li a").click(function(){$(".bottom-footer ul li a").removeClass("btn-grd2"),$(this).addClass("btn-grd2")}),$(".overlay").click(function(){$(".sub_popup").css("display","none"),$(".overlay").css("display","none"),$(".bottom-footer ul li a").removeClass("btn-grd2")}),$(".okay").click(function(){$(".sub_popup").css("display","none"),$(".overlay").css("display","none"),$(".bottom-footer ul li a").removeClass("btn-grd2")}),$(".cancel_").click(function(){$(".sub_popup").css("display","none"),$(".overlay").css("display","none"),$(".bottom-footer ul li a").removeClass("btn-grd2")}),e.expandCollapseAllClick=function(){$(".expandCollapseAll > .expandCollapse > .fa").attr("class").indexOf("fa-plus")>-1?($(".task-details").css("display","block"),$(".weekly-hours").css("display","block"),$(".top-show-hrs.weekly-hours").css("display","block"),$(".weekly-details.task-container").css("padding-bottom","28px"),e.expandClass="fa fa-minus",E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=1,e.expandAllText="Collapse All",e.resetArrayOnExpandAllClick(e.isDailyMode,!0)):(E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=1,$(".task-details").css("display","none"),$(".weekly-hours").css("display","none"),$(".weekly-details.task-container").css("padding-bottom","11px"),$(".top-show-hrs.weekly-hours").css("display","block"),e.expandClass="fa fa-plus",e.expandAllText="Expand All",e.resetArrayOnExpandAllClick(e.isDailyMode,!1))},e.resetArrayOnExpandAllClick=function(t,a){var r="exp",n="";if(t)for(i=0;i<e.gridData.length;i++)n=r+e.gridData[i].TEID,a?(E.expandedEntries.push(n),e.gridData[i].class="fa fa-minus",e.gridData[i].isOpen=!0):(E.collapsedEntries.push(n),e.gridData[i].class="fa fa-plus",e.gridData[i].isOpen=!1);else{r="expw";for(var i=0;i<e.itemsDataFinal1.length;i++)n=r+e.itemsDataFinal1[i].data.TEID,a?(E.expandedEntries.push(n),e.itemsDataFinal1[i].data.class="fa fa-minus",e.itemsDataFinal1[i].data.isOpen=!0):(E.collapsedEntries.push(n),e.itemsDataFinal1[i].data.class="fa fa-plus",e.itemsDataFinal1[i].data.isOpen=!1)}},$(".sub_popup-action .dots").click(function(){E.isPanelOpen=!0,$(".show-dayWeek").css("display","block"),$(".dots").css("display","none"),$(".cancel-cross").css("display","block"),$(".sub_popup-action").removeClass("isCancel")}),$(".sub_popup-action .cancel-cross").click(function(){$(".sub_popup-action").addClass("isCancel"),E.isPanelOpen=!1,$(".show-dayWeek").css("display","none"),$(".dots").css("display","block"),$(".cancel-cross").css("display","none"),e.IsSelectedForAll=!1,e.selectedForDelete=!1,e.$apply()}),$(".sub_popup-action .more").click(function(){checkAfterCuttOff(),$(".show-dayWeek").css("display","none"),$(".expand-footer").css("display","block"),$(".cancel-cross").css("display","none"),$(".sub_popup-action .cancel-cross-left").css("display","block")}),$(".sub_popup-action .cancel-cross-left").click(function(){$(".show-dayWeek").css("display","block"),$(".expand-footer").css("display","none"),$(".cancel-cross").css("display","block"),$(".sub_popup-action .cancel-cross-left").css("display","none")}),E.isPanelOpen&&($(".show-dayWeek").css("display","block"),$(".dots").css("display","none"),$(".cancel-cross").css("display","block")),1!=E.isCallBroadcastAtInterval&&(E.callBroadcastAtInterval=y(A,18e5),E.callMonthEndAtIntervalMobile=y(L,36e5),E.isCallBroadcastAtInterval=!0),e.checkRevMonthFlag=!0;V=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null};e.loadCalender=function(){E.errorLogMethod("DailyTimeGridCtrl.$scope.loadCalender"),E.lastCurrentDate=t("date")(e.currentDate,"yyyy-MM-dd");var a={currentDateValue:e.currentDate};e.open("templates/Calendar.html","calController",a)},calHeaderBtnClick=function(){$("#calender-container .calendarOver.mobileCalOver .yearContainerinner #firstColYear li").remove();var a=parseInt(new Date("sessiontimeout").getFullYear()-1);!function(){for(i=0;i<=2;i++)$("#calender-container .calendarOver.mobileCalOver .yearContainerinner #firstColYear").append("<li><a href='javascript:void(0)'>"+a+"</a></li>"),a+=1}(),$(".calendarOver.mobileCalOver").fadeIn(),$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer ul li a").removeClass("liActive"),$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner ul li a").removeClass("liActive"),function(e){var a=_.getRevStartEndDateBySelDate(t("date")(e,"yyyy-MM-dd"));if(null!=a){V(a.revStartDate);var r=V(a.revEndDate);currentMonth=parseInt(r.getMonth())+1,currentYear=r.getFullYear()}$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner").each(function(){$(this).find("li").each(function(){$(this).text()==currentYear&&$(this).children().addClass("liActive")})}),$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer").each(function(){$(this).find("li").each(function(){M($(this).text())==currentMonth&&$(this).children().addClass("liActive")})})}(e.currentDate),$(".calendarOver.mobileCalOver .selectOC ul li .cancelCalPopup").click(function(){$(".calendarOver.mobileCalOver").fadeOut()}),$(".calendarOver.mobileCalOver .selectOC ul li .selectCalDate").click(function(){$(".calendarOver.mobileCalOver").fadeOut()}),$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer ul li a").click(function(){$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer ul li a").removeClass("liActive"),$(this).addClass("liActive")}),$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner ul li a").click(function(){$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner ul li a").removeClass("liActive"),$(this).addClass("liActive")})},e.$on("calHeaderButtonClick",function(e,t){E.errorLogMethod("DatepickerController.$scope.$on.calHeaderButtonClick"),calHeaderBtnClick()});var x=function(){var a=new Date,r=null,r=E.chekRevDateInLocalStorage(a,t("translate")("msg_invalidSession"),!0),n=V(r.STRTDTE);if(e.weeklyStartDate.setHours(0,0,0,0)<n.setHours(0,0,0,0)){var i=n.getTimezoneOffset();return n.setMinutes(n.getMinutes()-i),n}return e.weeklyStartDate};e.loadImportCalEntriesRev=function(){if(re()){E.importViewed=!1;var a=new Date(e.currentDate.valueOf());a=t("date")(a,"yyyy-MM-dd");var r=JSON.parse(localStorage.getItem("Revenue_Months")),n=null;if(null!=r){var i=new Date(a);i=new Date(i.getTime()+60*i.getTimezoneOffset()*1e3),n=angular.fromJson(r).filter(function(e){if(null!=e&&i>=V(e.STRTDTE)&&i<=V(e.ENDDTE))return!0})}if(null!=n&&void 0!=n&&0!=n.length)e.revStartDate=n[0].STRTDTE,e.revEndDate=n[0].ENDDTE,localStorage.setItem("Revenue_Months_ImportCal",JSON.stringify(r)),e.loadImportCalEntries();else{var s=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(s.SESKEY,a,function(t){var a=t.LOADREVM_OUT_OBJ.REVM_ARR;localStorage.setItem("Revenue_Months_ImportCal",JSON.stringify(a)),e.loadImportCalEntries()})}}},e.loadImportCalEntries=function(){E.isCalOpen=!0,E.errorLogMethod("DailyTimeGridCtrl.$scope.loadImportCalEntries"),$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500);var a=JSON.parse(localStorage.getItem("Login_Detail")),r=null;if(e.isDailyMode||(r=x()),"Y"==a.ISNONAD&&null==localStorage.getItem("nonADLogin")){l={domain:"mercer",currentDate:e.currentDate,isDailyMode:e.isDailyMode,weekCurrentDate:r,weekStartDate:e.weeklyStartDate,lastExpandAllText:e.expandAllText,lastExpandClass:e.expandClass};e.openModalCtrl="importCalLoginCtrl",e.open("templates/ImportCalLogin.html","importCalLoginCtrl",l)}else{r=null;e.isDailyMode||(r=x());var n=new Date(e.currentDate.valueOf());n=t("date")(n,"yyyy-MM-dd");var i=JSON.parse(localStorage.getItem("Revenue_Months_ImportCal")),s=null;if(null!=i){var o=new Date(n);o=new Date(o.getTime()+60*o.getTimezoneOffset()*1e3),s=angular.fromJson(i).filter(function(e){if(null!=e&&o>=V(e.STRTDTE)&&o<=V(e.ENDDTE))return!0})}null!=s&&void 0!=s&&0!=s.length&&(e.revStartDate=s[0].STRTDTE,e.revEndDate=s[0].ENDDTE);var l={currentDate:e.currentDate,isDailyMode:e.isDailyMode,weekCurrentDate:r,weekStartDate:e.weeklyStartDate,flag:"Y"==a.ISNONAD?"Y":"N",encKey:null,revStartDate:e.revStartDate,revEndDate:e.revEndDate,lastExpandAllText:e.expandAllText,lastExpandClass:e.expandClass};e.openModalCtrl="importCalCtrl",e.open("templates/ImportCalEntries.html","importCalCtrl",l)}};var V=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null},H=function(e){if(void 0!=e&&null!=e){var t=(e=e.trim()).split("-"),a=t[2].split(" "),r=a[1].split(":");return new Date(t[0],t[1]-1,a[0],r[0],r[1],r[2])}return new Date},U=function(){var a=null,r=e.currentDate;r=V(t("date")(r,"yyyy-MM-dd"));var n=new Date,i={sDte:null,eDte:null};n.setHours(0,0,0,0),n=t("date")(new Date(n.getFullYear(),n.getMonth(),n.getDate()),"yyyy-MM-dd");var s=new Date(n);s=new Date(s.getTime()+60*s.getTimezoneOffset()*1e3),null!=(a=E.chekRevDateInLocalStorage(s,t("translate")("msg_invalidSession"),!1))&&(null!=a&&void 0!=a&&(i.sDte=V(a.STRTDTE),i.eDte=V(a.ENDDTE)),i.sDte>r?e.isSbmtOpen=!1:e.isSbmtOpen=!0)};e.animationsEnabled=!0;var G=function(e){E.errorLogMethod("DailyTimeGridCtrl.loadHomePage"),e&&C.go("Main",{loadDate:E.$stateParams.startDate,isDailyMode:E.$stateParams.isDailyMode,currentDate:E.$stateParams.currentDate})};e.open=function(a,r,n){E.errorLogMethod("DailyTimeGridCtrl.$scope.open"),D.open({animation:e.animationsEnabled,templateUrl:a,controller:r,resolve:{selectedData:function(){return n}}}).result.then(function(a){switch(E.errorLogMethod("DailyTimeGridCtrl.modalInstance.result"),e.openModalCtrl){case"ErrorPopup":$(".overlay").css("display","none"),void 0!=n&&void 0!=n.isReloadPage&&null!=n.isReloadPage&&G(n.isReloadPage),$(".bottom-footer ul li a").removeClass("btn-grd2");break;case"submitConfirm":Q(n.sesKey,n.empId,n.selDte,n.ttlRcd,n.revSDteOriginal,n.selDteOriginal);break;case"Preference":l(function(){e.loadErrorPopup(!1,t("translate")("msg_PrefSave"))},400);break;case"deleteConfirm":e.deleteTimeEntriesClicked(n.isDailyModeOption);break;case"pasteAdvanced":e.pasteMultiple(a)}},function(){$(".overlay").css("display","none"),$(".bottom-footer ul li a").removeClass("btn-grd2"),e.openModalCtrl="",void 0==E.importViewed&&(E.importViewed=!1),"importCalCtrl"!=e.openModalCtrl||E.importViewed||(E.isCalOpen=!1)})},e.toggleAnimation=function(){E.errorLogMethod("DailyTimeGridCtrl.$scope.toggleAnimation"),e.animationsEnabled=!e.animationsEnabled},e.checkRevMonthTime=function(t){E.errorLogMethod("DailyTimeGridCtrl.$scope.checkRevMonthTime");var a=E.GetInitialDetail(!1,!1);if(void 0!=a&&null!=a){var r=a.REVM_REC.STRTDTE.split("-"),n=a.REVM_REC.ENDDTE.valueOf().split("-"),i=null;if(void 0!=r&&void 0!=n){i=new Date(r[0],r[1]-1,r[2].split(" ")[0]);new Date(n[0],n[1]-1,n[2].split(" ")[0])}var s=new Date(t.valueOf());s.setHours(0,0,0,0),e.checkRevMonthFlag=!(s<i)}},$(".edit-delete").click(function(){$(".sub-overlay").css("display","block")}),$(".sub-overlay").click(function(){$(".sub-overlay").css("display","none")}),e.gridNoEntryMessage=0,e.ttlHrs=0,e.icChrge=0,e.loginDetail="",e.initialDetail="",e.domainURL="",e.stateProv=[];var Y=function(e,t){E.errorLogMethod("DailyTimeGridCtrl.getUsrPrefObjFrmArray");for(var a=[],r=0;r<t.length;r++){var n=$.grep(e,function(e){return e.KEY==t[r]});a.push(n)}return a},K=function(t){var a=Y(t,["INITIAL_TAB","LANG","INITIAL_DETAIL"]);if(a.length>0){for(var r=!0,n=0;n<a.length;n++)if(null!=a[n]&&a[n].length>0){r=!1;var i=a[n];switch(n){case 0:e.objUsrPreference.viewPref.isFetch=!0,"DAILY"==angular.uppercase(i[0].VAL)?e.objUsrPreference.viewPref.isDailymode=!0:e.objUsrPreference.viewPref.isDailymode=!1;break;case 1:e.objUsrPreference.viewPref.language=i[0].VAL;break;case 2:O.ISCOLLPSED=!0,e.expandAllText="Collapse All",e.objUsrPreference.viewPref.detail=i[0].VAL,(void 0!=e.objUsrPreference.viewPref.detail.KEYVAL&&"EXPANDED"==angular.uppercase(e.objUsrPreference.viewPref.detail.KEYVAL)||void 0!=e.objUsrPreference.viewPref.detail&&"EXPANDED"==angular.uppercase(e.objUsrPreference.viewPref.detail))&&(O.ISCOLLPSED=!1,e.expandAllText="Expand All"),e.isDefaultExpanded=!O.ISCOLLPSED,e.isDefaultExpanded?(e.expandAllText="Collapse All",e.expandClass="fa fa-minus"):(e.expandAllText="Expand All",e.expandClass="fa fa-plus")}}else r=!0;r&&e.loadGlobalPreferences(a)}else e.loadGlobalPreferences(null)},j=function(e){O.CURRENTLANGUAGE=O.ENGLISHLANGUAGEKEY,f.use(O.ENGLISHLANGUAGEKEY)},W=function(){O.CURRENTLANGUAGE==O.FRENCHLANGUAGEKEY?angular.copy(locales.fr,T):angular.copy(locales.en,T)};e.getFavActivities=function(t){var a=localStorage.getItem("ActivityFav");""!=a&&null!=a||R.retrieveActivityFavorites(t.SESKEY,t.EMPLID).then(function(t){if(0==t.RETACTIFAV_OUT_OBJ.RETCD){if("[object Array]"!=Object.prototype.toString.call(t.RETACTIFAV_OUT_OBJ.ACTI_ARR)){var a=t.RETACTIFAV_OUT_OBJ.ACTI_ARR;t.RETACTIFAV_OUT_OBJ.ACTI_ARR=[],null!=a&&null!=a.ACTI_OBJ&&void 0!=a.ACTI_OBJ&&t.RETACTIFAV_OUT_OBJ.ACTI_ARR.push(a.ACTI_OBJ)}var r=t.RETACTIFAV_OUT_OBJ.ACTI_ARR,n=0;if(e.ActivityFavList=[],null!=r)for(var i=0;i<r.length;i++)"Y"==r[i].STAT&&(r[i].index=n,r[i].fav=!0,e.ActivityFavList.push(r[i]),n++);localStorage.setItem("ActivityFav",JSON.stringify(e.ActivityFavList))}})},e.getFavDescription=function(e){var t=localStorage.getItem("DescFav");""!=t&&null!=t||s.retrieveDescriptionFavorites(e.SESKEY,e.EMPLID).then(function(e){if(0==e.RETDESCFAV_OUT_OBJ.RETCD){if("[object Array]"!=Object.prototype.toString.call(e.RETDESCFAV_OUT_OBJ.DESTXT_ARR)){var t=e.RETDESCFAV_OUT_OBJ.DESTXT_ARR;e.RETDESCFAV_OUT_OBJ.DESTXT_ARR=[],null!=t&&void 0!=t.VARCHAR2&&e.RETDESCFAV_OUT_OBJ.DESTXT_ARR.push(t.VARCHAR2)}localStorage.setItem("DescFav",JSON.stringify(e.RETDESCFAV_OUT_OBJ.DESTXT_ARR))}})},e.init=function(){try{E.errorLogMethod("DailyTimeGridCtrl.$scope.init"),e.renewalMessage=[],e.expandAllText="Collapse All",e.isDefaultExpanded=!0,e.prjScopeNoValidMsg=t("translate")("msg_PrjScopNotValid"),e.loginDetail=E.GetLoginDetail(!1,!0),e.getFavDescription(e.loginDetail),e.getFavActivities(e.loginDetail);var a=E.GetInitialDetail(!1,!0);null!=a.PREF_ARR&&a.PREF_ARR.length>0?(K(a.PREF_ARR),j(e.objUsrPreference.viewPref.language)):e.loadGlobalPreferences(null),p.loadStateProv(e.loginDetail.SESKEY,e.loginDetail.EMPLID,e.domainURL).then(function(a){if(0==parseInt(a.LOADSTATPROV_OUT_OBJ.RETCD)){if("[object Array]"!=Object.prototype.toString.call(a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR)){var r=a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR;a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR=[],a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR.push(r.STATPROV_OBJ)}for(var n=0;n<a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR.length;n++)e.stateProv.push(a.LOADSTATPROV_OUT_OBJ.STATPROV_ARR[n]);localStorage.setItem("StateProv_Data",JSON.stringify(e.stateProv))}if(null!=E.$stateParams.currentDate&&""!=E.$stateParams.currentDate){var i=parseInt(t("date")(E.$stateParams.currentDate,"yyyy")),s=parseInt(t("date")(E.$stateParams.currentDate,"MM")),o=parseInt(t("date")(E.$stateParams.currentDate,"dd")),l=new Date(i,s-1,o);e.currentDate=new Date(l.valueOf()),localStorage.removeItem("currentDate"),localStorage.removeItem("startDate"),localStorage.removeItem("isDailyMode")}else if(null!=(r=localStorage.currentDate)){E.$stateParams.currentDate=r,E.$stateParams.loadDate=localStorage.startDate,E.$stateParams.isDailyMode="true"==localStorage.isDailyMode,localStorage.removeItem("currentDate"),localStorage.removeItem("startDate"),localStorage.removeItem("isDailyMode");l=new Date(E.$stateParams.currentDate);e.currentDate=new Date(l.valueOf())}else{W();var d=JSON.parse(localStorage.getItem("InitialRev_Month")),p=H(d.REVM_REC.STRTDTE),u=H(d.REVM_REC.ENDDTE),C=new Date;if(C.getTimezoneOffset()>0&&(C=new Date("sessiontimeout")),C.setHours(0,0,0,0),C>=p&&C<=u){var D=new Date,g=D.getTimezoneOffset();D.setMinutes(D.getMinutes()-g),e.currentDate=D}else e.currentDate=p}E.lastCurrentDate!=t("date")(e.currentDate,"yyyy-MM-dd")&&(E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=0),null!=E.$stateParams.isDailyMode?e.isDailyMode=E.$stateParams.isDailyMode:e.isDailyMode=e.objUsrPreference.viewPref.isDailymode,e.weekDayToggle(e.isDailyMode,"N"),e.WeeklyDataCopied=!1,e.DailyDataCopied=!1,void 0!=localStorage.getItem("DailyDataCopied")&&null!==localStorage.getItem("DailyDataCopied")&&(e.DailyDataCopied=!0),void 0!=localStorage.getItem("WeeklyDataCopied")&&null!==localStorage.getItem("WeeklyDataCopied")&&(e.WeeklyDataCopied=!0),e.selectedForDelete=!1,e.IsSelectedForAll=!1,e.IsTodayCopied=!1,e.IsWeekCopied=!1,e.IsClone=!1,e.IspasteAdvance=!1;try{e.isDailyMode?e.isDailyMode:$(".week_").click(),$(".day_").click()}catch(e){}var v=void 0,m=new Date,O=new Date(e.currentDate.valueOf());O=t("date")(new Date(O.getFullYear(),O.getMonth(),O.getDate()),"yyyy-MM-dd");var T=["January","February","March","April","May","June","July","August","September","October","November","December"],f=null,y=t("date")(e.currentDate.valueOf(),"yyyy-MM-dd"),S=new Date(e.currentDate.valueOf());if(y=V(y),null!=(f=E.chekRevDateInLocalStorage(y,t("translate")("msg_invalidSession"),!0)))te(f,m,T,S);else{var R=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(R.SESKEY,O,function(e){if(void 0!=(v=e.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=v)for(var t=0;t<v.length;t++)if(null!=v[t]&&void 0!=v[t]&&void 0!=v[t].STRTDTE&&y>=V(v[t].STRTDTE)&&y<=V(v[t].ENDDTE)){f=v[t];break}null!=f&&te(f,m,T,S)})}E.isCalOpen&&E.importViewed&&e.loadImportCalEntriesRev()})}catch(e){$(".my-cloak").removeClass("my-cloak"),console.log("init"+e),console.log(e.message)}l(function(){L()},500),l(function(){L()},1e3)},e.loadGlobalPreferences=function(t){E.errorLogMethod("DailyTimeGridCtrl.$scope.loadGlobalPreferences"),u.loadGlobalPreferences(e.loginDetail.SESKEY).then(function(a){if(0==parseInt(a.GLBPREF_OUT_OBJ.RETCD)){var r=Y(a.GLBPREF_OUT_OBJ.GLBPREF,["INITIAL_TAB","LANG","INITIAL_DETAIL"]),n={};if(r.length>0)for(var i=0;i<r.length;i++)if(r[i].length>0){var s=r[i],o=null==t;if(o||(o=!(null!=t[i]&&t[i].length>0)),o)switch(i){case 0:for(l=0;l<s[0].KEYVAL_ARR.length;l++){angular.uppercase(s[0].KEYVAL_ARR[l].DEF),n=s[0].KEYVAL_ARR[l];break}"DAILY"==angular.uppercase(n.KEYVAL)?e.objUsrPreference.viewPref.isDailymode=!0:e.objUsrPreference.viewPref.isDailymode=!1;break;case 1:for(l=0;l<s[0].KEYVAL_ARR.length;l++){angular.uppercase(s[0].KEYVAL_ARR[l].DEF),e.objUsrPreference.viewPref.language=s[0].KEYVAL_ARR[l].KEYVAL,j(e.objUsrPreference.viewPref.language);break}break;case 2:O.ISCOLLPSED=!0,e.expandAllText="Collapse All";for(var l=0;l<s[0].KEYVAL_ARR.length;l++)if("Y"==angular.uppercase(s[0].KEYVAL_ARR[l].DEF)){e.objUsrPreference.viewPref.detail=s[0].KEYVAL_ARR[l].KEYVAL,"EXPANDED"==angular.uppercase(e.objUsrPreference.viewPref.detail)&&(O.ISCOLLPSED=!1,e.expandAllText="Expand All");break}e.isDefaultExpanded=!O.ISCOLLPSED,e.isDefaultExpanded?(e.expandAllText="Collapse All",e.expandClass="fa fa-minus"):(e.expandAllText="Expand All",e.expandClass="fa fa-plus")}}}})},e.$on("updateUiGrid",function(t,a){E.errorLogMethod("DailyTimeGridCtrl.$scope.$on.updateUiGrid"),e.currentDate=new Date(a.value.valueOf());var r=new Date(a.value.valueOf());r.setDate(r.getDate()+1),r.setDate(r.getDate()-7);for(var n=0;n<7&&0!=r.getDay();n++)r.setDate(r.getDate()+1);e.weeklyStartDate=new Date(r.valueOf()),e.isDailyMode?e.GetData(e.isDailyMode,a.value.valueOf()):e.GetData(e.isDailyMode,r.valueOf())}),e.isDailyMode=!0;var z=function(e){e?($(".tab1").css("display","block"),$(".tab2").css("display","none")):($(".tab2").css("display","block"),$(".tab1").css("display","none"))};e.weekDayToggle=function(t,a){if(E.errorLogMethod("DailyTimeGridCtrl.$scope.weekDayToggle"),"Y"==a&&(E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=0),e.gridData=[],e.itemsDataFinal1=[],z(t),e.isDailyMode=t,localStorage.isDailyMode=e.isDailyMode,t)e.GetData(e.isDailyMode,e.currentDate),$(".showInDay").css("display","inline-block"),$(".showInWeek").css("display","none"),$(".week_.ui-gradient").css("display","block"),$(".day_.ui-gradient").css("display","none");else{var r=new Date(e.currentDate.valueOf());r.setDate(r.getDate()+1),r.setDate(r.getDate()-7);for(var n=0;n<7&&0!=r.getDay();n++)r.setDate(r.getDate()+1);e.weeklyStartDate=new Date(r.valueOf()),e.GetData(e.isDailyMode,e.weeklyStartDate),$(".showInDay").css("display","none"),$(".showInWeek").css("display","inline-block"),"block"==$(".expand-footer").css("display")&&($(".expand-footer").css("display","none"),$(".show-dayWeek").css("display","block"),$(".sub_popup-action .cancel-cross-left").css("display","none"),$(".sub_popup-action .cancel-cross").css("display","block")),$(".week_.ui-gradient").css("display","none"),$(".day_.ui-gradient").css("display","block")}},e.addPropertyForExpandCollapse=function(t){var a=0,r=0;if(t){r=e.gridData.length;for(n=0;n<e.gridData.length;n++)e.gridData[n].rowIndex=n,(i=e.expandEntryToggle("exp"+e.gridData[n].TEID))?(a+=1,e.gridData[n].class="fa fa-minus",e.gridData[n].isOpen=!0):(e.gridData[n].class="fa fa-plus",e.gridData[n].isOpen=!1)}else{r=e.itemsDataFinal1.length;for(var n=0;n<e.itemsDataFinal1.length;n++){e.itemsDataFinal1[n].data.rowIndex=n;var i=e.expandEntryToggle("expw"+e.itemsDataFinal1[n].data.TEID);i?(a+=1,e.itemsDataFinal1[n].data.class="fa fa-minus",e.itemsDataFinal1[n].data.isOpen=!0):(e.itemsDataFinal1[n].data.class="fa fa-plus",e.itemsDataFinal1[n].data.isOpen=!1)}}0==a?(e.expandClass="fa fa-plus",e.expandAllText="Expand All"):a==r&&(e.expandClass="fa fa-minus",e.expandAllText="Collapse All")},e.GetData=function(a,r){void 0==E.expandedEntries&&(E.expandedEntries=[]),void 0==E.collapsedEntries&&(E.collapsedEntries=[]),(E.weekStateCurrentDate!=t("date")(e.currentDate,"yyyy-MM-dd")||a)&&(1==E.isPasteClicked&&(E.isPasteClicked=!1),E.weeklyMaxTEID.length>0&&(E.weeklyMaxTEID=[])),void 0!=E.lastCurrentDate&&E.lastCurrentDate!=t("date")(e.currentDate,"yyyy-MM-dd")&&(E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=0);try{U()}catch(e){}E.errorLogMethod("DailyTimeGridCtrl.$scope.GetData"),e.selectedForDelete=!1,e.IsSelectedForAll=!1,e.IsTodayCopied=!1,e.IsWeekCopied=!1,e.IsClone=!1,e.IspasteAdvance=!1,e.gridNoEntryMessage=0,void 0==r&&(r=new Date);var i=t("date")(new Date(r.valueOf()),"yyyy-MM-dd HH:mm:ss"),s=new Date(r.valueOf());if(a)s=s.setDate(s.getDate());else{s.setDate(s.getDate()+7);for(var o=0;o<7&&6!=s.getDay();o++)s.setDate(s.getDate()-1)}e.checkRevMonthTime(e.currentDate),e.afterTecuttOff=!1,checkAfterCuttOff(),s=t("date")(s,"yyyy-MM-dd HH:mm:ss");var l=E.GetLoginDetail(!1,!0),d=[],p=[],u=[];e.itemsDataFinal1="",e.itemsDataTotal="",l&&n.getData(l.SESKEY,l.EMPLID,i,s,t("date")(e.currentDate,"yyyy-MM-dd HH:mm:ss")).then(function(r){if(0!=r.RETTIM_OUT_OBJ.RETCD||null!=r.RETTIM_OUT_OBJ.TIME_ARR&&0!=r.RETTIM_OUT_OBJ.TIME_ARR.length)if(2==r.RETTIM_OUT_OBJ.RETCD){e.gridNoEntryMessage=2,e.errorMessage="",e.monthlyTtlHrs=0;var r={RETCD:2,ERRMSG:t("translate")("msg_invalidSession")};E.sessionInvalid(r)}else{if(e.monthlyTtlHrs=parseFloat(r.RETTIM_OUT_OBJ.TIME_SUMM.MTOTTIME),e.monthlyTtlHrs=e.monthlyTtlHrs.toFixed(2),e.nonSubmittedEntries=r.RETTIM_OUT_OBJ.TIME_SUMM.NONSUBMITTED,a||(r.RETTIM_OUT_OBJ.TIME_ARR.sort(function(e,t){var a=parseFloat(e.TEID),r=parseFloat(t.TEID);return a>r?1:a<r?-1:0}),e.weeklyMaxTEIDCommon=r.RETTIM_OUT_OBJ.TIME_ARR[r.RETTIM_OUT_OBJ.TIME_ARR.length-1].TEID,E.isPasteClicked?E.weeklyMaxTEID[E.weeklyMaxTEID.length]=e.weeklyMaxTEIDCommon:(E.weeklyMaxTEID=[],E.weeklyMaxTEID[0]=e.weeklyMaxTEIDCommon)),a)p=[],r.RETTIM_OUT_OBJ.TIME_ARR.sort(function(e,t){var a=e.CEP_REC.CLIENO.toLowerCase(),r=t.CEP_REC.CLIENO.toLowerCase();if(a<r)return-1;if(a>r)return 1;if(a=r){if(e.CEP_REC.ENGNO<t.CEP_REC.ENGNO)return-1;if(e.CEP_REC.ENGNO>t.CEP_REC.ENGNO)return 1;if(e.CEP_REC.ENGNO=t.CEP_REC.ENGNO){if(e.CEP_REC.PRJNO<t.CEP_REC.PRJNO)return-1;if(e.CEP_REC.PRJNO>t.CEP_REC.PRJNO)return 1}}return 0}),e.gridData=JSON.parse(JSON.stringify(r.RETTIM_OUT_OBJ.TIME_ARR)),e.addPropertyForExpandCollapse(!0);else{e.gridData=[];for(var n=r.RETTIM_OUT_OBJ.TIME_ARR,i=[],s=0;s<n.length;s++){var o,l=0,C=new Date(n[s].DTE.substring(0,n[s].DTE.indexOf(" "))),D=(C=new Date(C.getTime()+60*C.getTimezoneOffset()*1e3)).getDay()+1;o=0==n[s].CATID||void 0==n[s].CATID?n[s].ACTI_REC.DES:n[s].CTSDESC;var g=d.indexOf(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|0");if(-1==g&&parseFloat(n[s].TEID)<=parseFloat(E.weeklyMaxTEID[0]))l+=parseFloat(n[s].HRS,10),d.push(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|0"),p.push({CLIENO:n[s].CEP_REC.CLIENO,ENGNO:n[s].CEP_REC.ENGNO,PRJNO:n[s].CEP_REC.PRJNO,CTDESC:n[s].CTDESC,DES:n[s].DES,Hrs1:null,Hrs2:null,Hrs3:null,Hrs4:null,Hrs5:null,Hrs6:null,Hrs7:null,HrsTotal:l,TEID_data:n[s].TEID,data:n[s]}),p[p.length-1]["Hrs"+D]=parseFloat(n[s].HRS,10),p[p.length-1]["TEID"+D]=n[s].TEID;else if(parseFloat(n[s].TEID)>parseFloat(E.weeklyMaxTEID[0])&&E.isPasteClicked&&E.weeklyMaxTEID.length>1){for(var v=E.weeklyMaxTEID[E.weeklyMaxTEID.length-2]+"--"+E.weeklyMaxTEID[E.weeklyMaxTEID.length-1],m=0;m<E.weeklyMaxTEID.length-1;m++)if(parseFloat(n[s].TEID)>parseFloat(E.weeklyMaxTEID[m])&&parseFloat(n[s].TEID)<=parseFloat(E.weeklyMaxTEID[m+1])){v=E.weeklyMaxTEID[m]+"--"+E.weeklyMaxTEID[m+1];break}for(var O=!1,T=i.length-1;T>-1;T--)if((g=d.indexOf(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|"+i[T]))>-1){O=!0;break}if(O||(g=d.indexOf(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|"+v)),-1==g)l+=parseFloat(n[s].HRS,10),d.push(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|"+v),p.push({CLIENO:n[s].CEP_REC.CLIENO,ENGNO:n[s].CEP_REC.ENGNO,PRJNO:n[s].CEP_REC.PRJNO,CTDESC:n[s].CTDESC,DES:n[s].DES,Hrs1:null,Hrs2:null,Hrs3:null,Hrs4:null,Hrs5:null,Hrs6:null,Hrs7:null,HrsTotal:l,TEID_data:n[s].TEID,data:n[s]}),p[p.length-1]["Hrs"+D]=parseFloat(n[s].HRS,10),p[p.length-1]["TEID"+D]=n[s].TEID;else if(g>-1&&null!=p[g]["Hrs"+D]&&parseFloat(n[s].TEID)>parseFloat(E.weeklyMaxTEID[0])){var f=v+" -- "+s;i.push(f),l+=parseFloat(n[s].HRS,10),d.push(n[s].CEP_REC.CLIENO+"|"+n[s].CEP_REC.ENGNO+"|"+n[s].CEP_REC.PRJNO+"|"+o+"|"+n[s].DES+"|"+n[s].TIMSUB+"|"+n[s].REGFLAG+"|"+n[s].PRSTCD+"|"+f),p.push({CLIENO:n[s].CEP_REC.CLIENO,ENGNO:n[s].CEP_REC.ENGNO,PRJNO:n[s].CEP_REC.PRJNO,CTDESC:n[s].CTDESC,DES:n[s].DES,Hrs1:null,Hrs2:null,Hrs3:null,Hrs4:null,Hrs5:null,Hrs6:null,Hrs7:null,HrsTotal:l,TEID_data:n[s].TEID,data:n[s]}),g=-1,p[p.length-1]["Hrs"+D]=parseFloat(n[s].HRS,10),p[p.length-1]["TEID"+D]=n[s].TEID}}g>-1&&(null==p[g]["Hrs"+D]&&(p[g]["Hrs"+D]=0),p[g]["Hrs"+D]=parseFloat(p[g]["Hrs"+D],10)+parseFloat(n[s].HRS,10),p[g].HrsTotal=parseFloat(p[g].HrsTotal,10)+parseFloat(n[s].HRS,10),p[g]["TEID"+D]=void 0!=p[g]["TEID"+D]?p[g]["TEID"+D]+","+parseInt(n[s].TEID,10):parseInt(n[s].TEID,10))}u.HrsGrandTotalSum=0;for(var y=1;y<=7;y++){for(var S=0,R=!1,s=0;s<p.length;s++)null!=p[s]["Hrs"+y]&&(R=!0,S+=parseFloat(p[s]["Hrs"+y],10),u["HrsTotalSum"+y]=S);R?u.HrsGrandTotalSum=parseFloat(u.HrsGrandTotalSum,10)+parseFloat(u["HrsTotalSum"+y],10):u["HrsTotalSum"+y]=0}p.sort(function(e,t){var a=e.CLIENO.toLowerCase(),r=t.CLIENO.toLowerCase();if(a<r)return-1;if(a>r)return 1;if(a=r){if(e.ENGNO<t.ENGNO)return-1;if(e.ENGNO>t.ENGNO)return 1;if(e.ENGNO=t.ENGNO){if(e.PRJNO<t.PRJNO)return-1;if(e.PRJNO>t.PRJNO)return 1}}return 0}),e.itemsDataFinal1=p,e.itemsDataTotal=u,e.weeklyTtlHours=u.HrsGrandTotalSum,e.weeklyTtlHours=e.weeklyTtlHours.toFixed(2),e.addPropertyForExpandCollapse(!1)}void 0!=e.gridData&&(e.ttlHrs=e.icChrge=0,$.each(e.gridData,function(t,a){e.ttlHrs+=parseFloat(e.gridData[t].HRS),e.icChrge+=parseInt(e.gridData[t].ICCHRGE,10)}),e.ttlHrs=e.ttlHrs.toFixed(2),e.icChrge=e.icChrge.toFixed(2))}else e.gridData=JSON.parse("[]"),e.gridNoEntryMessage=1,e.ttlHrs=0,e.ttlHrs=e.ttlHrs.toFixed(2),e.weeklyTtlHours=0,e.weeklyTtlHours=e.weeklyTtlHours.toFixed(2),e.monthlyTtlHrs=parseFloat(r.RETTIM_OUT_OBJ.TIME_SUMM.MTOTTIME),e.monthlyTtlHrs=e.monthlyTtlHrs.toFixed(2),e.nonSubmittedEntries=r.RETTIM_OUT_OBJ.TIME_SUMM.NONSUBMITTED,0==E.cntrExpandCollapse&&(e.isDefaultExpanded?(e.expandAllText="Collapse All",e.expandClass="fa fa-minus",$(".weekly-details.task-container").css("padding-bottom","28px")):(e.expandAllText="Expand All",e.expandClass="fa fa-plus",$(".weekly-details.task-container").css("padding-bottom","11px")));var P=void 0,I=new Date,_=new Date(e.currentDate.valueOf());_=t("date")(new Date(_.getFullYear(),_.getMonth(),_.getDate()),"yyyy-MM-dd");var h=["January","February","March","April","May","June","July","August","September","October","November","December"],A=null,M=t("date")(e.currentDate.valueOf(),"yyyy-MM-dd"),N=new Date(e.currentDate.valueOf());if(M=V(M),null!=(A=E.chekRevDateInLocalStorage(M,t("translate")("msg_invalidSession"),!0)))te(A,I,h,N);else{var L=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(L.SESKEY,_,function(e){if(void 0!=(P=e.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=P)for(var t=0;t<P.length;t++)if(null!=P[t]&&void 0!=P[t]&&void 0!=P[t].STRTDTE&&M>=V(P[t].STRTDTE)&&M<=V(P[t].ENDDTE)){A=P[t];break}null!=A&&te(A,I,h,N)})}$(".my-cloak").removeClass("my-cloak")}).catch(function(a){$(".my-cloak").removeClass("my-cloak"),e.loadErrorPopup(!0,t("translate")("lbl_Error")+":"+a)})},e.deleteTimeEntries=function(t,a,r,i,s){E.errorLogMethod("DailyTimeGridCtrl.$scope.deleteTimeEntries");var o=0,c="",d=E.GetLoginDetail(!1,!0);n.deleteTimeEntries(d.SESKEY,d.EMPLID,'"'+a.join('","')+'"').then(function(a){if(0!=a.DELTIM_OUT_OBJ.RETCD)l(function(){e.loadErrorPopup(!0,a.DELTIM_OUT_OBJ.ERRMSG)},200);else if(void 0!=a.DELTIM_OUT_OBJ.TEID_ARR&&null!=a.DELTIM_OUT_OBJ.TEID_ARR){var n=void 0!=a.DELTIM_OUT_OBJ.TEID_ARR.length?a.DELTIM_OUT_OBJ.TEID_ARR.length:1,d=0;(o=i-(d=t?i-n:r))>0&&(c+="Deleted "+o+" record(s) successfully."),d>0&&(""!=c&&(c+="<br/>"),c+=d+"  Deletion unsuccessful – unable to delete submitted record(s)."),$(".del").removeClass("active"),e.GetData(t,t?e.currentDate:e.weeklyStartDate),e.loadErrorPopup(!1,c)}else $(".del").removeClass("active"),X(s,t)})};var X=function(a,r){r?e.checkRevMonthFlag?e.loadErrorPopup(!1,t("translate")("lbl_cantDlt")):e.loadErrorPopup(!1,t("translate")("msg_dltFaild")):a?e.loadErrorPopup(!1,t("translate")("lbl_cantDlt")):e.loadErrorPopup(!1,t("translate")("msg_dltFaild"))};e.loadPreferences=function(){E.errorLogMethod("DailyTimeGridCtrl.$scope.loadPreferences"),$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500);var t={viewPref:e.objUsrPreference.viewPref};e.openModalCtrl="Preference",e.open("templates/Preference.html","Preference",t)},e.submitTimeEntries=function(){$(".navigation").animate({left:-w},500),$(".overlay").fadeOut(500),E.errorLogMethod("DailyTimeGridCtrl.$scope.submitTimeEntries");var a=void 0,r=new Date,n=new Date(e.currentDate.valueOf());n=t("date")(new Date(n.getFullYear(),n.getMonth(),n.getDate()),"yyyy-MM-dd");var i=["January","February","March","April","May","June","July","August","September","October","November","December"],s=null,o=t("date")(e.currentDate.valueOf(),"yyyy-MM-dd");if(o=V(o),null!=(s=E.chekRevDateInLocalStorage(o,t("translate")("msg_invalidSession"),!1)))q(s,r,i);else{var l=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(l.SESKEY,n,function(e){if(void 0!=(a=e.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=a)for(var t=0;t<a.length;t++)if(null!=a[t]&&void 0!=a[t]&&void 0!=a[t].STRTDTE&&o>=V(a[t].STRTDTE)&&o<=V(a[t].ENDDTE)){s=a[t];break}null!=s&&q(s,r,i)})}};var q=function(a,r,n){var i=null;a.TECUTTOFF.split(" ")&&(i=H(a.TECUTTOFF));var s=new Date(e.currentDate.valueOf());s=t("date")(new Date(s.getFullYear(),s.getMonth(),s.getDate()),"yyyy-MM-dd");var o=t("date")(new Date,"yyyy-MM-dd");if(new Date(i).setHours(0,0,0,0),r.getTime()>=i.getTime()&&s>=a.STRTDTE.substring(0,10)&&s<=a.ENDDTE.substring(0,10)&&o>=a.STRTDTE.substring(0,10)&&o<=a.ENDDTE.substring(0,10))e.checkRevMonthFlag=!1,e.isSbmtOpen=!1;else{var l=E.GetInitialDetail(!1,!0),c=l.REVM_REC.STRTDTE.split("-"),d=l.REVM_REC.ENDDTE.valueOf().split("-"),p=new Date(c[0],c[1]-1,c[2].split(" ")[0]),u=new Date(d[0],d[1]-1,d[2].split(" ")[0]);p=new Date(p.getTime()+60*p.getTimezoneOffset()*1e3),u=new Date(u.getTime()+60*u.getTimezoneOffset()*1e3);var C=new Date(e.currentDate.valueOf()),D=p,g=C;if(C.setHours(0,0,0,0),p.setHours(0,0,0,0),C>=p){var v=parseInt(e.nonSubmittedEntries);console.log("ttlRcrdToSmt=="+v);var m=E.GetLoginDetail(!1,!0);C=t("date")(new Date(C.valueOf()),"yyyy-MM-dd HH:mm:ss"),v>0?e.submitIfConfirm(e.currentDate.valueOf(),m.SESKEY,m.EMPLID,C,v,D,g):e.loadErrorPopup(!1,t("translate")("msg_NoTEntryToSubmit"),!1,!1)}}};e.loadErrorPopup=function(t,a,r,n){E.errorLogMethod("DailyTimeGridCtrl.$scope.loadErrorPopup");var i={isError:t,message:a,isReloadPage:r,isCancelBtnOn:n};e.openModalCtrl="ErrorPopup",e.open("templates/ErrorPopup.html","ErrorPopup",i)},e.submitIfConfirm=function(a,r,n,i,s,o,l){E.errorLogMethod("DailyTimeGridCtrl.$scope.submitIfConfirm");var c={message:t("translate")("msg_SubmitTimeMsg",{date:t("date")(a,"dd-MMM-yyyy")}),isSubmit:!0,empId:n,sesKey:r,selDte:i,ttlRcd:s,revSDteOriginal:o,selDteOriginal:l,isCancelBtnOn:!0};e.openModalCtrl="submitConfirm",e.open("templates/ConfirmMessage.html","ConfirmMessage",c)};var Q=function(t,a,r,i,s,o){E.errorLogMethod("DailyTimeGridCtrl.callApiToSubmitEntries"),n.submitTimeEntries("N",t,a,r,function(t){e.loadErrorPopup(!1,t.SUBTIM_OUT_OBJ.ERRMSG,!0,!1),e.isDailyMode?e.GetData(e.isDailyMode,e.currentDate):e.GetData(e.isDailyMode,e.weeklyStartDate)})};e.editTimeEntry=function(t){E.errorLogMethod("DailyTimeGridCtrl.$scope.editTimeEntry");var a,r=e.isDailyMode;if(r)localStorage.setItem("Time_Entry",JSON.stringify(t)),a=new Date(e.currentDate.valueOf());else{localStorage.setItem("Time_Entry",JSON.stringify(t.data));var n=[];n[0]=t.Hrs1,n[1]=t.Hrs2,n[2]=t.Hrs3,n[3]=t.Hrs4,n[4]=t.Hrs5,n[5]=t.Hrs6,n[6]=t.Hrs7,localStorage.setItem("weeklyhours",JSON.stringify(n));var i=[];i[0]=void 0!==t.TEID1?t.TEID1:0,i[1]=void 0!==t.TEID2?t.TEID2:0,i[2]=void 0!==t.TEID3?t.TEID3:0,i[3]=void 0!==t.TEID4?t.TEID4:0,i[4]=void 0!==t.TEID5?t.TEID5:0,i[5]=void 0!==t.TEID6?t.TEID6:0,i[6]=void 0!==t.TEID7?t.TEID7:0,localStorage.setItem("teid_data",JSON.stringify(i)),a=new Date(e.weeklyStartDate.valueOf())}e.NewClick(a,e.currentDate.valueOf(),r,!0)};var Z=function(e){return E.errorLogMethod("DailyTimeGridCtrl.var.getMonthName"),{0:t("translate")("lbl_Mnth1"),1:t("translate")("lbl_Mnth2"),2:t("translate")("lbl_Mnth3"),3:t("translate")("lbl_Mnth4"),4:t("translate")("lbl_Mnth5"),5:t("translate")("lbl_Mnth6"),6:t("translate")("lbl_Mnth7"),7:t("translate")("lbl_Mnth8"),8:t("translate")("lbl_Mnth9"),9:t("translate")("lbl_Mnth10"),10:t("translate")("lbl_Mnth11"),11:t("translate")("lbl_Mnth12")}[e]},ee=function(e,t){E.errorLogMethod("DailyTimeGridCtrl.var.getRevenueMonthAndYear");var a="",r=e.getFullYear();0!=e.getMonth()?a=parseInt(e.getMonth())-t:(a=1==t?11:0,r=parseInt(r)-t);var n={};return n.monthname=Z(a),n.year=r,n},te=function(a,r,n,i){var s=null;a.TECUTTOFF.split(" ")&&(s=H(a.TECUTTOFF)),i=t("date")(new Date(i.getFullYear(),i.getMonth(),i.getDate()),"yyyy-MM-dd");var o=t("date")(new Date,"yyyy-MM-dd");new Date(s).setHours(0,0,0,0),r.getTime()>=s.getTime()&&i>=a.STRTDTE.substring(0,10)&&i<=a.ENDDTE.substring(0,10)&&o>=a.STRTDTE.substring(0,10)&&o<=a.ENDDTE.substring(0,10)&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1)},ae=function(a,r,n,i,s,o,l){E.errorLogMethod("DailyTimeGridCtrl.redirectToNewEntryPage");T.DATETIME_FORMATS.MONTH;if(a.TECUTTOFF.split(" "))var c=H(a.TECUTTOFF);var d=t("date")(r,"yyyy-MM-dd"),p=t("date")(new Date,"yyyy-MM-dd");if(new Date(c).setHours(0,0,0,0),n.getTime()>=c.getTime()&&d>=a.STRTDTE.substring(0,10)&&d<=a.ENDDTE.substring(0,10)&&p>=a.STRTDTE.substring(0,10)&&p<=a.ENDDTE.substring(0,10)){if(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1,i){var u=JSON.parse(localStorage.getItem("Time_Entry"));u.TIMSUB="Y",localStorage.setItem("Time_Entry",JSON.stringify(u)),s&&C.go("mNewEntry",{startDate:o,isDailyMode:l,IsEditMode:s,currentDate:r})}}else(e.checkRevMonthFlag||s)&&C.go("mNewEntry",{startDate:o,isDailyMode:l,IsEditMode:s,currentDate:r})};e.NewClick=function(a,r,n,i){if(E.errorLogMethod("DailyTimeGridCtrl.$scope.NewClick"),re()){E.lastCurrentDate=t("date")(r,"yyyy-MM-dd"),E.lastExpandAllText=e.expandAllText,E.lastExpandClass=e.expandClass,E.cntrExpandCollapse=2,n||(E.isPasteClicked=!0,E.weekStateCurrentDate=t("date")(r,"yyyy-MM-dd"));var s=void 0,o=null,l=new Date,d=t("date")(r,"yyyy-MM-dd"),p=t("date")(r,"yyyy-MM-dd");if(p=V(p),null!=(o=E.chekRevDateInLocalStorage(p,t("translate")("msg_invalidSession"),!1)))ae(o,r,l,d,i,a,n);else{var u=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(u.SESKEY,d,function(e){if(void 0!=(s=e.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=s){var c=t("date")(r,"yyyy-MM-dd");c=V(c);for(var p=0;p<s.length;p++)if(null!=s[p]&&void 0!=s[p]&&void 0!=s[p].STRTDTE&&c>=V(s[p].STRTDTE)&&c<=V(s[p].ENDDTE)){o=s[p];break}}null!=o&&ae(o,r,l,d,i,a,n)})}}};var re=function(){E.errorLogMethod("DailyTimeGridCtrl.var.timePriorToBillingStartDate");var a=E.GetInitialDetail(!1,!0),r=e.isDailyMode?e.currentDate:ne(),n=e.currentDate;e.isDailyMode||(n=r.setDate(r.getDate()+6),n=new Date(n.valueOf()));var i=t("date")(a.EMPL_REC.BRSTDTE,"yyyy-MM-dd");if(E.isDatePriorToBillingDate(i,n)){var s=i.split("-"),o=s[2].split(" "),l=new Date(s[0],s[1]-1,o[0]).toString().split(" "),c=l[2]+"-"+l[1]+"-"+l[3];return e.loadErrorPopup(!0,t("translate")("msg_TimePriorToBillingStartDate",{dateVal:c})),!1}return!0},ne=function(){return new Date(e.weeklyStartDate.valueOf())},V=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null},H=function(e){if(void 0!=e&&null!=e){var t=(e=e.trim()).split("-"),a=t[2].split(" "),r=a[1].split(":");return new Date(t[0],t[1]-1,a[0],r[0],r[1],r[2])}return new Date};e.prevDate=function(){E.errorLogMethod("DailyTimeGridCtrl.$scope.prevDate"),E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=0;var a=0,r=[],n=e.isDailyMode,i=new Date;if(n){(D=new Date(e.currentDate.valueOf())).setDate(D.getDate()-1);var s=new Date(D.valueOf()),o=t("date")(new Date(s.getFullYear(),s.getMonth(),1),"yyyy-MM-dd"),l=t("date")(s,"yyyy-MM-dd"),p=null;if(l=V(l),null!=(p=E.chekRevDateInLocalStorage(l,t("translate")("msg_invalidSession"),!1))){e.currentDate=new Date(D.valueOf()),localStorage.setItem("updDate",e.currentDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(n,e.currentDate);T=null;p.TECUTTOFF.split(" ")&&(T=H(p.TECUTTOFF));var u=t("date")(new Date(D.getFullYear(),D.getMonth(),D.getDate()),"yyyy-MM-dd"),C=t("date")(new Date,"yyyy-MM-dd");(f=new Date(T)).setHours(0,0,0,0),i.getTime()>=T.getTime()&&u>=p.STRTDTE.substring(0,10)&&u<=p.ENDDTE.substring(0,10)&&C>=p.STRTDTE.substring(0,10)&&C<=p.ENDDTE.substring(0,10)&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1)}else{y=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(y.SESKEY,o,function(a){if(localStorage.setItem("REV_MON_RANGE",JSON.stringify(a.LOADREVM_OUT_OBJ.REVM_ARR)),void 0!=(r=a.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=r&&null!=r){for(var s=0;s<r.length;s++)if(null!=r[s]&&void 0!=r[s]&&void 0!=r[s].STRTDTE&&l>=V(r[s].STRTDTE)&&l<=V(r[s].ENDDTE)){p=r[s];break}if(null!=p)e.currentDate=new Date(D.valueOf()),localStorage.setItem("updDate",e.currentDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(n,e.currentDate);else{var o=t("date")(l,"dd-MMM-yyyy");e.loadErrorPopup(!0,t("translate")("msg_RevenueMonth",{dateVal:o}))}}if(null!=p){var c=null;p.TECUTTOFF.split(" ")&&(c=H(p.TECUTTOFF));var u=t("date")(new Date(D.getFullYear(),D.getMonth(),D.getDate()),"yyyy-MM-dd"),E=t("date")(new Date,"yyyy-MM-dd");new Date(c).setHours(0,0,0,0),i.getTime()>=c.getTime()&&u>=p.STRTDTE.substring(0,10)&&u<=p.ENDDTE.substring(0,10)&&E>=p.STRTDTE.substring(0,10)&&E<=p.ENDDTE.substring(0,10)&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1)}})}}else{a=e.currentDate.getDay();var D=new Date(e.weeklyStartDate.valueOf());D.setDate(D.getDate()-13);for(var g=0;g<7&&0!=D.getDay();g++)D.setDate(D.getDate()+1);var v=new Date(D.valueOf()),o=t("date")(new Date(v.getFullYear(),v.getMonth(),1),"yyyy-MM-dd"),m=t("date")(v,"yyyy-MM-dd");m=V(m);p=null;if(null!=(p=E.chekRevDateInLocalStorage(m,t("translate")("msg_invalidSession"),!1))){e.weeklyStartDate=new Date(D.valueOf());var O=new Date(D.valueOf());O.setDate(O.getDate()+a),e.currentDate=new Date(O.valueOf()),localStorage.setItem("updDate",e.weeklyStartDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(n,e.weeklyStartDate);var T=null;p.TECUTTOFF.split(" ")&&(T=H(p.TECUTTOFF));var u=t("date")(e.currentDate,"yyyy-MM-dd"),C=t("date")(new Date,"yyyy-MM-dd"),f=new Date(T);f.setHours(0,0,0,0),i.getTime()>=T.getTime()&&u>=p.STRTDTE.substring(0,10)&&u<=p.ENDDTE.substring(0,10)&&C>=p.STRTDTE.substring(0,10)&&C<=p.ENDDTE.substring(0,10)&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1)}else{var y=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(y.SESKEY,o,function(s){if(localStorage.setItem("REV_MON_RANGE",JSON.stringify(s.LOADREVM_OUT_OBJ.REVM_ARR)),void 0!=(r=s.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=r&&null!=r){for(var o=0;o<r.length;o++)if(null!=r[o]&&void 0!=r[o]&&void 0!=r[o].STRTDTE&&m>=V(r[o].STRTDTE)&&m<=V(r[o].ENDDTE)){p=r[o];break}if(null!=p){e.weeklyStartDate=new Date(D.valueOf());var l=new Date(D.valueOf());l.setDate(l.getDate()+a),e.currentDate=new Date(l.valueOf()),localStorage.setItem("updDate",e.weeklyStartDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(n,e.weeklyStartDate)}else{var c=t("date")(new Date(m),"dd-MMM-yyyy");e.loadErrorPopup(!0,t("translate")("msg_RevenueMonth",{dateVal:c}))}}if(null!=p){var u=null;p.TECUTTOFF.split(" ")&&(u=H(p.TECUTTOFF));var E=t("date")(e.currentDate,"yyyy-MM-dd"),C=t("date")(new Date,"yyyy-MM-dd");new Date(u).setHours(0,0,0,0),i.getTime()>=u.getTime()&&E>=p.STRTDTE.substring(0,10)&&E<=p.ENDDTE.substring(0,10)&&C>=p.STRTDTE.substring(0,10)&&C<=p.ENDDTE.substring(0,10)&&(e.checkRevMonthFlag=!1,e.isSbmtOpen=!1)}})}}E.isPasteClicked=!1,E.weeklyMaxTEID=[]},e.nextDate=function(){E.errorLogMethod("DailyTimeGridCtrl.$scope.nextDate");var a=0;E.expandedEntries=[],E.collapsedEntries=[],E.cntrExpandCollapse=0;var r=new Date,n=["January","February","March","April","May","June","July","August","September","October","November","December"],i=e.isDailyMode,s=[];if(i){(C=new Date(e.currentDate.valueOf())).setDate(C.getDate()+1);var o=new Date(C.valueOf()),l=t("date")(new Date(o.getFullYear(),o.getMonth(),1),"yyyy-MM-dd"),p=t("date")(o,"yyyy-MM-dd"),u=null;if(p=V(p),null!=(u=E.chekRevDateInLocalStorage(p,t("translate")("msg_invalidSession"),!1)))e.currentDate=new Date(C.valueOf()),localStorage.setItem("updDate",e.currentDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(i,e.currentDate),te(u,r,n,C);else{O=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(O.SESKEY,l,function(a){if(localStorage.setItem("REV_MON_RANGE",JSON.stringify(a.LOADREVM_OUT_OBJ.REVM_ARR)),void 0!=(s=a.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=s&&null!=s){for(var o=0;o<s.length;o++)if(null!=s[o]&&void 0!=s[o]&&void 0!=s[o].STRTDTE&&p>=V(s[o].STRTDTE)&&p<=V(s[o].ENDDTE)){u=s[o];break}if(null!=u)e.currentDate=new Date(C.valueOf()),localStorage.setItem("updDate",e.currentDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(i,e.currentDate);else{var l=t("date")(p,"dd-MMM-yyyy");e.loadErrorPopup(!0,t("translate")("msg_RevenueMonth",{dateVal:l}))}}null!=u&&te(u,r,n,C)})}}else{var C=new Date(e.weeklyStartDate.valueOf());a=e.currentDate.getDay(),C.setDate(C.getDate()+7);for(var D=0;D<7&&0!=C.getDay();D++)C.setDate(C.getDate()-1);var g=new Date(C.valueOf()),l=t("date")(new Date(g.getFullYear(),g.getMonth(),1),"yyyy-MM-dd"),v=t("date")(g,"yyyy-MM-dd"),u=null;if(v=V(v),null!=(u=E.chekRevDateInLocalStorage(v,t("translate")("msg_invalidSession"),!1))){e.weeklyStartDate=new Date(C.valueOf());var m=new Date(C.valueOf());m.setDate(m.getDate()+a),e.currentDate=new Date(m.valueOf()),localStorage.setItem("updDate",e.weeklyStartDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(i,e.weeklyStartDate),te(u,r,n,e.currentDate)}else{var O=E.GetLoginDetail(!1,!0);c.loadRevenueMonths(O.SESKEY,l,function(o){if(localStorage.setItem("REV_MON_RANGE",JSON.stringify(o.LOADREVM_OUT_OBJ.REVM_ARR)),void 0!=(s=o.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=s&&null!=s){for(var l=0;l<s.length;l++)if(null!=s[l]&&void 0!=s[l]&&void 0!=s[l].STRTDTE&&v>=V(s[l].STRTDTE)&&v<=V(s[l].ENDDTE)){u=s[l];break}if(null!=u){e.weeklyStartDate=new Date(C.valueOf());var c=new Date(C.valueOf());c.setDate(c.getDate()+a),e.currentDate=new Date(c.valueOf()),localStorage.setItem("updDate",e.weeklyStartDate),localStorage.SelectedCalendardate=e.currentDate,d.notifyDateTimeSlider(e.currentDate),e.GetData(i,e.weeklyStartDate)}else{var p=t("date")(v,"dd-MMM-yyyy");e.loadErrorPopup(!0,t("translate")("msg_RevenueMonth",{dateVal:p}))}null!=u&&te(u,r,n,e.currentDate)}})}}E.isPasteClicked=!1,E.weeklyMaxTEID=[]},e.copyRecords=function(t){E.errorLogMethod("DailyTimeGridCtrl.$scope.copyRecords");for(var a=document.getElementsByName("chkEntries"),r=[],n=!1,i=0;i<a.length;i++)if(1==a[i].checked){var s=JSON.parse(a[i].value);t?(delete s.class,delete s.isOpen,delete s.rowIndex):(delete s.data.class,delete s.data.isOpen,delete s.data.rowIndex),r.push(JSON.stringify(s)),n=!0}if(n){for(var o=!0,i=0;i<r.length;i++){var l=JSON.parse(r[i]),c=JSON.parse(JSON.stringify(l)),d=JSON.parse(JSON.stringify(c));if(t||(c=c.data),"T"==c.CEP_REC.CHARBASIS||"S"==c.CEP_REC.CHARBASIS||"C"==c.CEP_REC.CHARBASIS){if(t&&parseFloat(c.HRS)<0){o=!1;break}if(!t&&(parseFloat(d.Hrs1)<0||parseFloat(d.Hrs2)<0||parseFloat(d.Hrs3)<0||parseFloat(d.Hrs4)<0||parseFloat(d.Hrs5)<0||parseFloat(d.Hrs6)<0||parseFloat(d.Hrs7)<0)){o=!1;break}}}return o?(e.moveEntryToClipBoard(t,r),!0):($(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.loadErrorPopup(!0,"You cannot copy a record with negative hours."),!1)}return!1},e.SelectedID="",e.selectedTEIDs=[],e.entryCheckedUnchecked=function(t,a){E.errorLogMethod("DailyTimeGridCtrl.$scope.entryCheckedUnchecked"),e.afterTecuttOff=!1,e.IsClone=!1,e.IsTodayCopied=!1,e.IsWeekCopied=!1;for(var r=document.getElementsByName("chkEntries"),n=!1,i=!1,s="",o=0;o<r.length;o++){if(s=t?JSON.parse(r[o].value).TIMSUB.toUpperCase():JSON.parse(r[o].value).data.TIMSUB.toUpperCase(),1==r[o].checked&&"N"==s){n=!0,i=!0;break}1!=r[o].checked||i||(i=!0)}e.selectedForDelete=n,e.IsSelectedForAll=i,checkAfterCuttOff();var c=document.getElementById(a);null!=c&&void 0!=c&&"undefined"!=c?(!0,JSON.parse(c.value),e.SelectedID=a,t?$("#"+a).is(":checked")?$("#d"+a).addClass("selected"):$("#d"+a).removeClass("selected"):($("#"+a).is(":checked")?$("#week"+a.substring(1)).addClass("selected"):$("#week"+a.substring(1)).removeClass("selected"),a=a.substring(1)),e.selectedTEIDs.push(a)):(!1,l(function(){for(var t=document.getElementsByName("chkEntries"),a=0;a<t.length;a++)t[a].checked=!1;e.SelectedID=""},100)),$(".dots").css("display","none"),$(".bottom-footer").css("display","none"),$(".sub_popup-action .show-dayWeek").css("display","block"),$(".content").css("padding-bottom","84px"),$(".sub_popup-action .cancel-cross").css("display","block"),$(".sub_popup-action .dots").css("display","none"),$(".expand-footer").css("display","none"),$(".sub_popup-action .cancel-cross-left").css("display","none"),E.isPanelOpen=!0,$(".sub_popup-action .cancel-cross").click(function(){E.isPanelOpen=!1,$(".sub_popup-action .show-dayWeek").css("display","none"),$(".content").css("padding-bottom","60px"),$(".task-container.selected").removeClass("selected"),$(".sub_popup-action .dots").css("display","block"),$("input:checkbox[class^=checked]").each(function(e){this.checked=!1}),e.IsSelectedForAll=!1,e.selectedForDelete=!1,$(".bottom-footer").css("display","block"),$(".sub_popup-action .cancel-cross").css("display","none"),$("#dv_sub_popup").remove(),$(".sub_popup-action").append('<div id=\'dv_sub_popup\' class=\'sub_popup-action-inner\' onclick=\'$(".sub_popup-action .show-dayWeek").css("display", "block");$(".sub_popup-action .cancel-cross").css("display", "block");$(".sub_popup-action .dots").css("display", "none");\'></div>')}),$(".sub_popup-action .more").click(function(){$(".show-dayWeek").css("display","none"),$(".expand-footer").css("display","block"),$(".cancel-cross").css("display","none"),$(".sub_popup-action .cancel-cross-left").css("display","block")}),$(".sub_popup-action .cancel-cross-left").click(function(){$(".show-dayWeek").css("display","block"),$(".expand-footer").css("display","none"),$(".cancel-cross").css("display","block"),$(".sub_popup-action .cancel-cross-left").css("display","none")})};var ie=function(){var e=new Date,a=null,r=e.getTimezoneOffset();e.setMinutes(e.getMinutes()-r);var n=E.chekRevDateInLocalStorage(e,t("translate")("msg_invalidSession"),!1);if(null!=n)a=n.TECUTTOFF;return a};checkAfterCuttOff=function(){var t=H(ie()),a=new Date;(e.checkRevMonthFlag||e.isDailyMode&&t>a||!e.isDailyMode&&(t>a&&6==a.getDay()||6!=a.getDay()))&&(e.afterTecuttOff=!0),t>a||t.setHours(0,0,0,0)!=a.setHours(0,0,0,0)?e.afterTecuttOff=!0:e.afterTecuttOff=!1;var r=t.setHours(0,0,0,0);e.currentDate>r?e.afterTecuttOffWeek=!0:e.afterTecuttOffWeek=!1};var se=function(e){return E.errorLogMethod("DailyTimeGridCtrl.var.isInvalidFutureEntry"),P.futureEntry(e)};e.checkPasteMulCnt=0,e.pasteRecords=function(a,r){E.errorLogMethod("DailyTimeGridCtrl.$scope.pasteRecords");var n=JSON.parse(localStorage.getItem("Initial_Data")).EMPL_REC.BRSTDTE.split("-"),i=n[2].split(" "),s=new Date(n[0],n[1]-1,i[0]),l=0;e.highestWeekRecordNumber=0,e.totalDailyPastedHours=0,e.totalWeeklyPastedHours=[0,0,0,0,0,0,0],e.exceedHrs=[],E.totalPastedHrs=0,E.lastExpandAllText=e.expandAllText,E.lastExpandClass=e.expandClass,E.cntrExpandCollapse=2,e.IspasteAdvance||(e.renewalMessage=[]);var c="";e.IsTodayCopied||e.IsWeekCopied?c="Copy":e.IsClone?c="Clone":c="Paste",e.checkDbPartition=0,$(".copy").removeClass("active");var d=H(ie()),p=new Date;if((e.checkRevMonthFlag||e.IsTodayCopied&&a&&d>p||e.IsWeekCopied&&!a&&(d>p&&6==p.getDay()||6!=p.getDay())||e.IspasteAdvance)&&((e.afterTecuttOff||!a&&(e.afterTecuttOff||e.afterTecuttOffWeek))&&(e.IsTodayCopied||e.IsWeekCopied)||!e.IsTodayCopied&&!e.IsWeekCopied)){e.IsTodayCopied||e.IsWeekCopied||e.IspasteAdvance||e.IsClone||!(null!==localStorage.getItem("DailyDataCopied")&&a||null!==localStorage.getItem("WeeklyDataCopied")&&!a)||$(".paste").addClass("active"),e.round=!1,$("input:checkbox[class^=checked]").each(function(e){this.checked=!1}),e.IsSelectedForAll=!1,$(".task-container.selected").removeClass("selected");for(var u=document.getElementsByName("chkEntries"),C=0,D=0;C<u.length;C++)u[C].checked=!1;var g=E.GetInitialDetail(!1,!0);if(void 0==g||null==g)return $(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),void $(".clone").removeClass("active");var v=new Date(g.REVM_REC.STRTDTE.split(" ")[0]),m=new Date(g.REVM_REC.ENDDTE.split(" ")[0]);if(v=new Date(v.getTime()+60*v.getTimezoneOffset()*1e3),m=new Date(m.getTime()+60*m.getTimezoneOffset()*1e3),v.setHours(0,0,0,0),a){var O=null;if(e.IsTodayCopied){b=(L=new Date).getTimezoneOffset();L.setMinutes(L.getMinutes()-b),O=L}else O=e.IspasteAdvance?e.pasteAdvanceDate:e.currentDate.valueOf();if(null!==localStorage.getItem("DailyDataCopied")){for(var T=JSON.parse(localStorage.getItem("copiedRecordsDaily")),C=0;C<T.length;C++){if(O<new Date(s.valueOf())&&!e.isPriorToBillingDate){J=(k=s.toString().split(" "))[2]+"-"+k[1]+"-"+k[3];return e.loadErrorPopup(!0,t("translate")("msg_TimePriorToBillingStartDate",{dateVal:J})),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.IspasteAdvance&&(e.isPriorToBillingDate=!0),!1}T[C].DTE=t("date")(new Date(O),"yyyy-MM-dd HH:mm:ss");new Date(O);(N=new Date).setHours(0,0,0,0);b=(L=new Date).getTimezoneOffset();L.setMinutes(L.getMinutes()-b),L.setHours(0,0,0,0),se(T[C])&&(T[C].HRS=0)}if(1==T.length&&1==r){(F=e.validateEntries(a,T[0],null,O,!1))||($(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"));w=T[0];o.searchPRCCode(e.loginDetail.SESKEY,w.CEP_REC.CATID,w.CEP_REC.PRJID).then(function(a){var n=!0;if(0==parseInt(a.LOADPCOMTSK_OUT_OBJ.RETCD)){var i=!1,s=!1,o=!1,l=null;l=a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM;for(d=0;d<l.length;d++){if(l[d].CMPTID==w.CMPTID){if("Y"!=l[d].ACTIVE){i=!0;break}if(void 0!==l[d].ARR_PTSK.PTSK_OBJ&&void 0!=l[d].ARR_PTSK.PTSK_OBJ&&null!=l[d].ARR_PTSK.PTSK_OBJ){if(l[d].ARR_PTSK.PTSK_OBJ.TSKID==w.TSKID&&"Y"!=l[d].ARR_PTSK.PTSK_OBJ.ACTIVE){s=!0;break}}else for(var c=0;c<l[d].ARR_PTSK.length;c++)if(l[d].ARR_PTSK[c].TSKID==w.TSKID&&"Y"!=l[d].ARR_PTSK[c].ACTIVE){s=!0;break}}if(s)break}if(void 0!=a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP&&null!=a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP)for(var d=0;d<a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP.length;d++)if(a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP[d].SCOPID==w.SCOID&&"Y"!=a.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP[d].ACTIVE){o=!0;break}i||s?F&&($(".copy").removeClass("active"),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.loadErrorPopup(!0,t("translate")("msg_invalidProjectComponent")),n=!1):o&&F&&($(".copy").removeClass("active"),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.loadErrorPopup(!0,e.prjScopeNoValidMsg),n=!1)}F&&n&&(e.selectedRecordArray=[],e.highestRecordNum=null,e.highestRecordNumTemp=null,e.pasteSave(T,!1,r,0,0))})}else{e.selectedRecordArray=[],e.highestRecordNum=null,e.highestRecordNumTemp=null;B=[];e.totalDailyPastedHours=0,e.exceedHrs=[];for(var f=0,y=0,C=0;C<T.length;C++)e.validateEntries(a,T[C],null,O,!0)?(B[y]=JSON.parse(JSON.stringify(T[C])),y++):f++;f>0&&B.length<1?(messages=r*f+" "+c+" unsuccessful – record(s) no longer valid for new time entry.",0==e.checkPasteMulCnt&&e.loadErrorPopup(!1,messages),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")):B.length>0&&e.pasteSave(B,!0,r,f,0)}e.SelectedID=""}}else{var S=e.weeklyStartDate.valueOf();if(1==e.IsWeekCopied){b=(L=new Date).getTimezoneOffset();L.setMinutes(L.getMinutes()-b),(S=L).setDate(S.getDate()+1),S.setDate(S.getDate()-7);for(C=0;C<7&&0!=S.getDay();C++)S.setDate(S.getDate()+1)}var R=[],P=null;E.selRecordNumber=1;var _=angular.copy(v);if(null!==localStorage.getItem("WeeklyDataCopied")){for(var T=JSON.parse(localStorage.getItem("copiedRecordsWeekly")),h=0,A=0,C=0,D=0;C<T.length;C++){T[C].selectedRecordNumber>A&&(A=T[C].selectedRecordNumber,h++);var M=new Date(S);M=new Date(M.setDate(M.getDate()+T[C].DTECount));var N=new Date;N.setHours(0,0,0,0);var L=new Date,b=L.getTimezoneOffset();if(L.setMinutes(L.getMinutes()-b),L.setHours(0,0,0,0),T[C].DTE=t("date")(new Date(M.valueOf()),"yyyy-MM-dd HH:mm:ss"),_.setHours(M.getHours(),M.getMinutes(),M.getSeconds(),M.getMilliseconds()),null!=(P=I.timeEntryToNextRevenue(M,v,T,C,_))&&(delete P.DTECount,R[D]=P,D++),se(T[C])&&(T[C].HRS=0),M.setHours(0,0,0,0)<v.setHours(0,0,0,0))l++;else{if(M<new Date(s.valueOf())){var k=s.toString().split(" "),J=k[2]+"-"+k[1]+"-"+k[3];return e.loadErrorPopup(!0,t("translate")("msg_TimePriorToBillingStartDate",{dateVal:J})),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),!1}delete T[C].DTECount,R[D]=T[C],D++}}if(R.length,R.length>0&&1==h){var F=e.validateEntries(a,R[0],R,S,!1),w=R[0];o.searchPRCCode(e.loginDetail.SESKEY,w.CEP_REC.CATID,w.CEP_REC.PRJID).then(function(n){var i=!0;if(0==parseInt(n.LOADPCOMTSK_OUT_OBJ.RETCD)){var s=!1,o=!1,d=!1,p=null;p=n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PCOM;for(v=0;v<p.length;v++){if(p[v].CMPTID==w.CMPTID){if("Y"!=p[v].ACTIVE){s=!0;break}if(void 0!==p[v].ARR_PTSK.PTSK_OBJ&&void 0!=p[v].ARR_PTSK.PTSK_OBJ&&null!=p[v].ARR_PTSK.PTSK_OBJ){if(p[v].ARR_PTSK.PTSK_OBJ.TSKID==w.TSKID&&"Y"!=p[v].ARR_PTSK.PTSK_OBJ.ACTIVE){o=!0;break}}else for(f=0;f<p[v].ARR_PTSK.length;f++)if(p[v].ARR_PTSK[f].TSKID==w.TSKID&&"Y"!=p[v].ARR_PTSK[f].ACTIVE){o=!0;break}}if(o)break}if(void 0!=n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP&&null!=n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP)for(v=0;v<n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP.length;v++)if(n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP[v].SCOPID==w.SCOID&&"Y"!=n.LOADPCOMTSK_OUT_OBJ.PCAT_ARR.PCAT_OBJ.ARR_PSCOP[v].ACTIVE){d=!0;break}s||o?F&&($(".copy").removeClass("active"),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.loadErrorPopup(!0,t("translate")("msg_invalidProjectComponent")),i=!1):d&&F&&($(".copy").removeClass("active"),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.loadErrorPopup(!0,e.prjScopeNoValidMsg),i=!1)}if(F&&i){e.selectedRecordArray=[],e.highestRecordNum=null,e.highestRecordNumTemp=null;var u=[],E=0,C=0,D=!0,g=0;e.totalWeeklyPastedHours=[0,0,0,0,0,0,0],e.exceedHrs=[];for(var v=0;v<R.length;v++){if(JSON.parse(JSON.stringify(R[v])).selectedRecordNumber!=E){for(var m=JSON.parse(JSON.stringify(R[v])).selectedRecordNumber,O=[],T=0,f=0;f<R.length;f++)m==JSON.parse(JSON.stringify(R[f])).selectedRecordNumber&&(O[T]=JSON.parse(JSON.stringify(R[f])),T++);e.validateEntries(a,R[v],O,S,!0)?D=!0:(C+=O.length,D=!1),E=JSON.parse(JSON.stringify(R[v])).selectedRecordNumber}D&&(u[g]=JSON.parse(JSON.stringify(R[v])),g++)}C>0&&u.length<1?(messages=r*C+" "+c+" unsuccessful – record(s) no longer valid for new time entry.",0==e.checkPasteMulCnt&&e.loadErrorPopup(!1,messages),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")):u.length>0&&e.pasteSave(u,!1,r,C,l)}else $(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")}),e.SelectedID=""}else if(R.length>0&&h>1){e.selectedRecordArray=[],e.highestRecordNum=null,e.highestRecordNumTemp=null;var B=[],x=0,f=0,V=!0,y=0;e.totalDailyPastedHours=0,e.totalWeeklyPastedHours=[0,0,0,0,0,0,0],e.exceedHrs=[];for(C=0;C<R.length;C++){if(JSON.parse(JSON.stringify(R[C])).selectedRecordNumber!=x){for(var U=JSON.parse(JSON.stringify(R[C])).selectedRecordNumber,G=[],Y=0,D=0;D<R.length;D++)U==JSON.parse(JSON.stringify(R[D])).selectedRecordNumber&&(G[Y]=JSON.parse(JSON.stringify(R[D])),Y++);e.validateEntries(a,R[C],G,S,!0)?V=!0:(f+=G.length,V=!1),x=JSON.parse(JSON.stringify(R[C])).selectedRecordNumber}V&&(B[y]=JSON.parse(JSON.stringify(R[C])),y++)}f>0&&B.length<1?(messages=r*f+l+" "+c+" unsuccessful – record(s) no longer valid for new time entry.",0==e.checkPasteMulCnt&&e.loadErrorPopup(!1,messages),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")):B.length>0&&e.pasteSave(B,!0,r,f,l)}else{if(l>0){var K=l+" "+c+" unsuccessful – record(s) no longer valid for new time entry.";e.loadErrorPopup(!1,K)}$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")}}}}else $(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")},e.moveEntryToClipBoard=function(t,a){if(E.errorLogMethod("DailyTimeGridCtrl.$scope.moveEntryToClipBoard"),t){for(var r=[],n=0;n<a.length;n++)r[n]=JSON.parse(a[n]),r[n].TEID=0,r[n].TIMSUB="N";localStorage.setItem("copiedRecordsDaily",JSON.stringify(r)),localStorage.setItem("DailyDataCopied",!0),e.DailyDataCopied=!0}else{for(var i=[],n=0,s=0;s<a.length;s++){var o=JSON.parse(a[s]);null!=o.Hrs1&&(o.data.TEID=0,o.data.DTECount=0,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs1,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs2&&(o.data.TEID=0,o.data.DTECount=1,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs2,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs3&&(o.data.TEID=0,o.data.DTECount=2,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs3,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs4&&(o.data.TEID=0,o.data.DTECount=3,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs4,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs5&&(o.data.TEID=0,o.data.DTECount=4,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs5,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs6&&(o.data.TEID=0,o.data.DTECount=5,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs6,i[n]=JSON.parse(JSON.stringify(o.data)),n++),null!=o.Hrs7&&(o.data.TEID=0,o.data.DTECount=6,o.data.selectedRecordNumber=s+1,o.data.TIMSUB="N",o.data.HRS=o.Hrs7,i[n]=JSON.parse(JSON.stringify(o.data)),n++)}var c=JSON.parse(JSON.stringify(i));localStorage.setItem("copiedRecordsWeekly",JSON.stringify(c)),localStorage.setItem("WeeklyDataCopied",!0),e.WeeklyDataCopied=!0}$(".copy").addClass("active"),l(function(){$(".copy").removeClass("active")},400)};var oe=function(t){var a=[];return e.exceedHrs.length>0?(t="Pasted "+t.split(" ")[1]+" entry/ies successfully. Note, you have entered more than 24 hours on one or more days.",a.push(t)):a.push(t),a};e.pasteSave=function(a,r,n,i,o){var l=1,c=i;e.IspasteAdvance&&i>0&&(c=i*n),null==e.highestRecordNum&&(e.highestRecordNum=0),null==e.highestRecordNumTemp&&(e.highestRecordNumTemp=0),(parseFloat(a.length)>parseFloat(e.highestRecordNum)||0==a.length&&c>0)&&(e.highestRecordNum=a.length),l=a.length,a.length>0&&delete a[0].selectedRecordNumber,E.errorLogMethod("DailyTimeGridCtrl.$scope.pasteSave");e.IsTodayCopied||e.IsWeekCopied||e.IsClone?e.pasteMultipleCount=0:e.IspasteAdvance||(e.pasteMultipleCount=0),s.saveTimeSheet(e.loginDetail.SESKEY,e.loginDetail.EMPLID,JSON.stringify(a[0]),"").then(function(s){if(0==parseInt(s.SAVTIM_OUT_OBJ.RETCD)){if(a.splice(0,1),a.length>0&&e.pasteSave(a,r,n,i,o),0==a.length&&void 0!=e.pasteMultipleCount&&e.pasteMultipleCount>0&&e.pasteMultipleCount--,0==a.length&&(void 0==e.pasteMultipleCount||0==e.pasteMultipleCount)){var d="",p=(e.highestRecordNum+i-(void 0!=e.selectedRecordArray?e.selectedRecordArray.length:0))*(void 0!=n?n:1);p-=e.checkDbPartition,(p-=c)>0&&(d+="Pasted "+p+(p>1?" entries":" entry")+" successfully.");C=e.selectedRecordArray.length*n;C+=e.checkDbPartition,C+=c,""!=d&&(d+="<br/>"),(C+=o)>0&&(d+=C+" Paste unsuccessful – record(s) no longer valid for new time entry."),e.loadErrorPopup(!1,oe(d)),e.isDailyMode?e.GetData(e.isDailyMode,e.currentDate):(E.isPasteClicked=!0,E.weekStateCurrentDate=t("date")(e.currentDate,"yyyy-MM-dd"),e.GetData(e.isDailyMode,e.weeklyStartDate)),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")}}else{if(0==a.length&&void 0!=e.pasteMultipleCount&&e.pasteMultipleCount>0&&e.pasteMultipleCount--,0==a.length&&(void 0==e.pasteMultipleCount||0==e.pasteMultipleCount)){var d="",p=(e.highestRecordNum+i-(void 0!=e.selectedRecordArray?e.selectedRecordArray.length:0))*(void 0!=n?n:1);(p-=c)>0&&(d+="Pasted "+p+(p>1?" entries":" entry")+" successfully.");C=c;""!=d&&(d+="<br/>"),(C+=o)>0&&(d+=C+" Paste unsuccessful – record(s) no longer valid for new time entry."),e.loadErrorPopup(!1,oe(d)),e.isDailyMode?e.GetData(e.isDailyMode,e.currentDate):(E.isPasteClicked=!0,E.weekStateCurrentDate=t("date")(e.currentDate,"yyyy-MM-dd"),e.GetData(e.isDailyMode,e.weeklyStartDate)),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")}if(r){if(r&&(ce(s.SAVTIM_OUT_OBJ.ERRMSG,a)?e.checkDbPartition=e.checkDbPartition+1:"-1"==e.selectedRecordArray.indexOf(l)&&e.selectedRecordArray.push(l),a.splice(0,1),a.length>0&&e.pasteSave(a,r,n,i,o),0==a.length&&void 0!=e.pasteMultipleCount&&e.pasteMultipleCount>0&&e.pasteMultipleCount--,0==a.length&&0==e.round&&0!=e.highestRecordNum&&(void 0==e.pasteMultipleCount||0==e.pasteMultipleCount))){e.round=!0;var u="",p=(e.highestRecordNum+i-(void 0!=e.selectedRecordArray?e.selectedRecordArray.length:0))*(void 0!=n?n:1);if(p-=e.checkDbPartition,(p-=c)>0&&(u+="Pasted "+p+(p>1?" entries":" entry")+" successfully."),void 0!=e.selectedRecordArray&&e.selectedRecordArray.length>0||e.checkDbPartition>0){var C=e.selectedRecordArray.length*(void 0!=n?n:1);C+=e.checkDbPartition,C+=c,""!=u&&(u+="<br/>"),(C+=o)>0&&(u+=C+" Paste unsuccessful – record(s) no longer valid for new time entry."),e.loadErrorPopup(!1,u),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active")}e.isDailyMode?e.GetData(e.isDailyMode,e.currentDate):(E.isPasteClicked=!0,E.weekStateCurrentDate=t("date")(e.currentDate,"yyyy-MM-dd"),e.GetData(e.isDailyMode,e.weeklyStartDate))}}else le(s.SAVTIM_OUT_OBJ.ERRMSG,a)||(e.loadErrorPopup(!0,s.SAVTIM_OUT_OBJ.ERRMSG),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"))}})};var le=function(a,r){var n=!1;if(E.errorLogMethod("DailyTimeGridCtrl.chekForDBPartitionError"),null!=a&&""!=a&&(a=a.toLowerCase()).indexOf("database partition")>0){for(var i="",s=0;s<r.length;s++){var o=r[s],l=m.createDate(o.DTE);l=t("date")(l,"dd-MMM-yyyy"),i=""==i?l:i+","+l}if(""!=i){n=!0;var c=t("translate")("msg_DBParttionEr",{dateValue:i});e.isDailyMode,e.loadErrorPopup(!0,c),$(".paste").removeClass("active"),$(".copyToday").removeClass("active"),$(".copyWeek").removeClass("active"),$(".clone").removeClass("active"),e.isDailyMode?e.GetData(e.isDailyMode,e.currentDate):e.isDailyMode||(E.isPasteClicked=!0,E.weekStateCurrentDate=t("date")(e.currentDate,"yyyy-MM-dd"),e.GetData(e.isDailyMode,e.weeklyStartDate))}}return n},ce=function(e,a){var r=!1;if(E.errorLogMethod("DailyTimeGridCtrl.chekForDBPartitionErrorPasteAdvance"),null!=e&&""!=e&&(e=e.toLowerCase()).indexOf("database partition")>0){for(var n="",i=0;i<a.length;i++){var s=a[i],o=m.createDate(s.DTE);o=t("date")(o,"dd-MMM-yyyy"),n=""==n?o:n+","+o}""!=n&&(r=!0)}return r},de=function(){var e=new Date,t=[],a=e.getTimezoneOffset();e.setMinutes(e.getMinutes()-a),e.setDate(e.getDate()+1),e.setDate(e.getDate()-7);for(var r=0;r<7&&0!=e.getDay();r++)e.setDate(e.getDate()+1);return t[0]=new Date(e.valueOf()),e.setDate(e.getDate()+6),t[1]=e,t},pe=function(t,a){var r=!1;if(e.IsTodayCopied||e.IsWeekCopied||e.IspasteAdvance){if(e.IsTodayCopied)e.totalTodayHrs=parseFloat(e.totalTodayHrs)+parseFloat(t),e.totalTodayHrs>24&&(r=!0),console.log("MOBILE today HOURS--"+e.totalTodayHrs);else if(e.IsWeekCopied){var n=de(),i=angular.copy(n[0]);i.setHours(0,0,0,0),(a=V(a)).setHours(0,0,0,0);o=parseInt((a-i)/864e5);e.totalWeeklyPastedHours[o]=(0==parseFloat(e.totalWeeklyPastedHours[o])?parseFloat(e.weekTotalHrs[o]):parseFloat(e.totalWeeklyPastedHours[o]))+parseFloat(t),e.totalWeeklyPastedHours[o]>24&&(r=!0),console.log("MOBILE COPY TO THIS WEEK $scope.totalWeeklyPastedHours[dayDiff]--"+e.totalWeeklyPastedHours[o]+"--dayDiff--"+o)}}else if(e.isDailyMode)t>24?r=!0:(e.totalDailyPastedHours=(0==parseFloat(e.totalDailyPastedHours)?parseFloat(e.ttlHrs):parseFloat(e.totalDailyPastedHours))+parseFloat(t),console.log("MOBILE DAILY HOURS--"+e.totalDailyPastedHours),e.totalDailyPastedHours>24&&(r=!0));else{var s=[0,0,0,0,0,0,0];if((i=angular.copy(e.weeklyStartDate)).setHours(0,0,0,0),(a=V(a)).setHours(0,0,0,0),t>24)r=!0,console.log("MOBILE WEEKLY HOURS--"+t+" entryDate--"+a);else{s[0]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum1?0:e.itemsDataTotal.HrsTotalSum1),s[1]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum2?0:e.itemsDataTotal.HrsTotalSum2),s[2]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum3?0:e.itemsDataTotal.HrsTotalSum3),s[3]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum4?0:e.itemsDataTotal.HrsTotalSum4),s[4]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum5?0:e.itemsDataTotal.HrsTotalSum5),s[5]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum6?0:e.itemsDataTotal.HrsTotalSum6),s[6]=parseFloat(void 0==e.itemsDataTotal.HrsTotalSum7?0:e.itemsDataTotal.HrsTotalSum7);var o=parseInt((a-i)/864e5);e.totalWeeklyPastedHours[o]=(0==parseFloat(e.totalWeeklyPastedHours[o])?parseFloat(s[o]):parseFloat(e.totalWeeklyPastedHours[o]))+parseFloat(t),e.totalWeeklyPastedHours[o]>24&&(r=!0),console.log("MOBILE WEEKLY HOURS--"+e.totalWeeklyPastedHours[o]+"--dayDiff--"+o)}}return r};e.validateEntries=function(a,r,n,i,s){if(E.errorLogMethod("DailyTimeGridCtrl.$scope.validateEntries"),"Y"!=r.CEP_REC.CLIEACTIVE)return s||e.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.CEP_REC.ENGACTIVE)return s||e.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.CEP_REC.ENGTIMFLAG)return s||e.loadErrorPopup(!0,t("translate")("msg_SelectAnotherEng")),!1;if("Y"!=r.CEP_REC.PRJACTIVE)return s||e.loadErrorPopup(!0,t("translate")("msg_InActiveCep")),!1;if("Y"!=r.CEP_REC.PRJTIMFLAG)return s||e.loadErrorPopup(!0,t("translate")("msg_SelectAnotherPrj")),!1;o=E.GetInitialDetail(!1,!0);if("Y"!=r.ACTI_REC.STAT&&0==parseInt(r.CEP_REC.CATID))return s||e.loadErrorPopup(!0,t("translate")("msg_InActiveActivity")),!1;var o=null,l=E.GetLoginDetail(!1,!0);p.retrieveInitialData(l.SESKEY,l.EMPLID).then(function(e){0==parseInt(e.RETINIT_OUT_OBJ.RETCD)&&(localStorage.setItem("Initial_Data",JSON.stringify(e.RETINIT_OUT_OBJ)),o=E.GetInitialDetail(!1,!0))}),o=E.GetInitialDetail(!1,!0);var c=!1;if(a)if(parseFloat(r.HRS)<0){if(!(u=e.validateEntryHours(r,o,s)))return!1}else pe(parseFloat(r.HRS),r.DTE)&&(c=!0);else for(var d=0;d<n.length;d++)if(parseFloat(n[d].HRS)<0){var u=e.validateEntryHours(n[d],o,s);if(!u)return!1}else pe(parseFloat(n[d].HRS),n[d].DTE)&&(c=!0);if(c&&(maxHourMsg=t("translate")("msg_24HrsPaste"),0==e.exceedHrs.length&&e.exceedHrs.push(maxHourMsg)),null!=r.CEP_REC.RENPRJNO&&" "!=r.CEP_REC.RENPRJNO&&void 0!==r.CEP_REC.RENPRJNO){var C=parseInt(r.CEP_REC.RENPRJNO)>99?parseInt(r.CEP_REC.RENPRJNO).toString():parseInt(r.CEP_REC.RENPRJNO)>9?"0"+parseInt(r.CEP_REC.RENPRJNO).toString():"00"+parseInt(r.CEP_REC.RENPRJNO).toString(),D=r.CEP_REC.CLIENO+"-"+r.CEP_REC.ENGNO+"-"+r.CEP_REC.PRJNO;-1==e.renewalMessage.indexOf(D)&&(e.renewalMessage.push(D),e.loadErrorPopup("z",t("translate")("msg_ProjectRenewedPaste",{pName:C,cepProject:D})))}return!0},e.validateEntryHours=function(a,r,n){switch(E.errorLogMethod("DailyTimeGridCtrl.$scope.validateEntryHours"),a.CEP_REC.CHARBASIS){case"N":if("Y"!=r.COMP_REC.NTIM)return n||e.loadErrorPopup(!0,t("translate")("msg_NegativeHrs")),!1;break;case"T":if("Y"!=r.COMP_REC.NBTM)return n||e.loadErrorPopup(!0,t("translate")("msg_BillingNegativeHrs")),!1;break;case"S":case"C":return n||e.loadErrorPopup(!0,t("translate")("msg_NegativeHrs")),!1}return!0},e.deleteTimeEntriesConfirm=function(t){E.errorLogMethod("DailyTimeGridCtrl.$scope.deleteTimeEntriesConfirm");for(var a=0,r=!1,n=document.getElementsByName("chkEntries"),i=0;i<n.length;i++)if(1==n[i].checked){var s=JSON.parse(n[i].value);t?a++:(null!=s.Hrs1&&a++,null!=s.Hrs2&&a++,null!=s.Hrs3&&a++,null!=s.Hrs4&&a++,null!=s.Hrs5&&a++,null!=s.Hrs6&&a++,null!=s.Hrs7&&a++),r||(t&&"N"==s.TIMSUB||!t&&"N"==s.data.TIMSUB)&&(JSON.parse(n[i].value),r=!0)}if(a>0&&r){var o={message:"Do you wish to delete "+a+" record(s)?",isCancelBtnOn:!0,isDailyModeOption:t};e.openModalCtrl="deleteConfirm",e.open("templates/ConfirmMessage.html","ConfirmMessage",o)}},e.deleteTimeEntriesClicked=function(t){if(E.errorLogMethod("DailyTimeGridCtrl.$scope.deleteTimeEntriesClicked"),$(".del").addClass("active"),e.selectedForDelete){for(var a=document.getElementsByName("chkEntries"),r=[],n=!1,i=0;i<a.length;i++)1==a[i].checked&&(r.push(a[i].value),n=!0);if(n){var s=[];if(E.lastExpandAllText=e.expandAllText,E.lastExpandClass=e.expandClass,E.cntrExpandCollapse=2,t){for(var o=0,i=0;i<r.length;i++)"Y"!=JSON.parse(r[i]).TIMSUB.toUpperCase()?s.push(parseFloat(JSON.parse(r[i]).TEID)):o++;e.deleteTimeEntries(t,s,o,r.length)}else{var l="",c=0,d=0,p=new Date(e.weeklyStartDate.valueOf());p.setHours(0,0,0,0);for(var u=_.getWkDayOnOpenCloseRevStatus(p),C=!1,i=0;i<r.length;i++){var D=JSON.parse(r[i]);if("Y"!=JSON.parse(r[i]).data.TIMSUB.toUpperCase()){var g=_.getDeleteTeIdObj(D,u);C=!!C||g.isTEInOpenREVWeekExist,l+=(""==l?"":",")+g.tEIdsStr,d+=g.invalidCount,c+=_.countNoOfTimeEntry(D)}else{var v=_.countNoOfTimeEntry(D);c+=v,d+=v}}e.deleteTimeEntries(t,l.split(","),d,c,C)}}}},e.pasteAdvance=function(t){e.renewalMessage=[];var a=E.GetLoginDetail(!1,!0);if(null!=a&&void 0!=a&&(e.DailyDataCopied||e.IsTodayCopied||e.IsClone)){e.round=!1,E.errorLogMethod("DailyTimeGridCtrl.$scope.pasteAdvance"),e.openModalCtrl="pasteAdvanced";var r={currentDateValue:e.currentDate};e.open("templates/Multidatepicker.html","multidatepickerCtrl",r)}},e.CopytoToday=function(a){if(a&&e.IsSelectedForAll){$(".copyToday").addClass("active"),e.IsTodayCopied=!0,e.totalTodayHrs=0;var r=E.GetLoginDetail(!1,!0),n=new Date,i=n.getTimezoneOffset();n.setMinutes(n.getMinutes()-i),n=t("date")(n,"yyyy-MM-dd HH:mm:ss"),_.copyToTodayCopyToWeekService(r.SESKEY,r.EMPLID,n,n,t("date")(e.currentDate,"yyyy-MM-dd HH:mm:ss")).then(function(t){if(0==t.RETTIM_OUT_OBJ.RETCD){for(var r=0;r<t.RETTIM_OUT_OBJ.TIME_ARR.length;r++)e.totalTodayHrs=parseFloat(e.totalTodayHrs)+parseFloat(t.RETTIM_OUT_OBJ.TIME_ARR[r].HRS);e.copyRecords(a)?e.pasteRecords(a,1):e.IsTodayCopied=!1}})}},e.CopytoThisWeek=function(a){if(!a&&e.IsSelectedForAll){$(".copyWeek").addClass("active"),e.IsWeekCopied=!0;var r=E.GetLoginDetail(!1,!0);e.IsWeekCopied=!0,e.weekTotalHrs=[0,0,0,0,0,0,0];var n=de();e.currentWeekStartDate=n[0],_.copyToTodayCopyToWeekService(r.SESKEY,r.EMPLID,t("date")(n[0],"yyyy-MM-dd HH:mm:ss"),t("date")(n[1],"yyyy-MM-dd HH:mm:ss"),t("date")(e.currentDate,"yyyy-MM-dd HH:mm:ss")).then(function(r){if(0==r.RETTIM_OUT_OBJ.RETCD){for(var i=0;i<7;i++){for(var s=0;s<r.RETTIM_OUT_OBJ.TIME_ARR.length;s++)n[0].setHours(0,0,0,0),t("date")(n[0],"yyyy-MM-dd HH:mm:ss")==t("date")(r.RETTIM_OUT_OBJ.TIME_ARR[s].DTE,"yyyy-MM-dd")&&(e.weekTotalHrs[i]=parseFloat(e.weekTotalHrs[i])+parseFloat(r.RETTIM_OUT_OBJ.TIME_ARR[s].HRS));n[0].setDate(n[0].getDate()+1)}console.log("MOBILE $scope.weekTotalHrs--"+JSON.stringify(e.weekTotalHrs)),e.copyRecords(a)?e.pasteRecords(a,1):e.IsWeekCopied=!1}})}},e.Clone=function(t){e.IsSelectedForAll&&e.checkRevMonthFlag&&($(".clone").addClass("active"),e.IsClone=!0,e.copyRecords(t)?e.pasteRecords(t,1):e.IsClone=!1)},e.pasteMultiple=function(t){var a=t.length;e.pasteMultipleCount=a,e.isPriorToBillingDate=!1;for(var r=0;r<a;r++)if(!e.isPriorToBillingDate){var n=new Date(t[r]);e.IspasteAdvance=!0,e.pasteAdvanceDate=n,e.pasteRecords(!0,a),e.checkPasteMulCnt=r+1}e.isPriorToBillingDate=!1,e.checkPasteMulCnt=0},e.showWeeks=!1,e.loadErrorPopup=function(t,a){E.errorLogMethod("DailyTimeGridCtrl.$scope.loadErrorPopup");var r={isError:t,message:a};e.openModalCtrl="ErrorPopup",e.open("templates/ErrorPopup.html","ErrorPopup",r)}}]).controller("InfoController",["$scope","$rootScope","$modal","$modalInstance","$filter","$interval","selectedRow",function(e,t,a,r,n,i,s){e.selectedRow=s,e.ok=function(){t.errorLogMethod("InfoController.$scope.ok"),e.selectedRow=null,r.close()},e.cancel=function(){t.errorLogMethod("InfoController.$scope.cancel"),e.selectedRow=null,r.dismiss("cancel")}}]).controller("deviceCtrl",["$scope","deviceDetector",function(e,t){e.name="World",e.deviceDetector=t}]).controller("calController",["$scope","$rootScope","$filter","$localStorage","broadcastService","loadRevenueMonthsServices","$modalInstance","selectedData","retrieveSharedService","commonUtilityService",function(e,t,a,r,n,i,s,o,l,c){function d(e){t.errorLogMethod("calController.convertMonthNameToNumber");var a=new Date(l.getMonthName(e)+" 1, 2000").getMonth();return isNaN(a)?0:a+1}function p(e){var t=c.getRevStartEndDateBySelDate(a("date")(e,"yyyy-MM-dd"));if(null!=t){E(t.revStartDate);var r=E(t.revEndDate);currentMonth=parseInt(r.getMonth())+1,currentYear=r.getFullYear()}$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner").each(function(){$(this).find("li").each(function(){$(this).text()==currentYear&&$(this).children().addClass("liActive")})}),$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer").each(function(){$(this).find("li").each(function(){d($(this).text())==currentMonth&&$(this).children().addClass("liActive")})})}function u(e,t,a){var r=new Date(e,t,a);return r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===a}e.dateArray=[],e.dateSubmitArray=[],datesHighError=[],e.direction=[];e.arguments=o,e.init=function(){t.errorLogMethod("calController.$scope.init"),e.currentDateValue=angular.copy(e.arguments.currentDateValue)};var E=function(e){if(t.errorLogMethod("calController.var.createDate"),void 0!=e){var a=e.split("-"),r=a[2].split(" ");return new Date(a[0],a[1]-1,r[0])}return null};void 0!=r.dateVal&&(e.dateSubmitArray=null,e.dateSubmitArray=angular.fromJson(r.dateVal),e.dateSubmitArray.formats="dd/MM/yyyy"),e.currdate=function(){t.errorLogMethod("calController.$scope.currdate"),r.SelectedCalendardate=null,r.CalDate=null;var a=new Date,n=a.getTimezoneOffset();a.setMinutes(a.getMinutes()-n),e.dt=a,r.SelectedCalendardate=e.dt,r.currDate=e.dt,r.todayClicked="1",angular.element(document.getElementById("selectedValue"))[0].value=e.dt,angular.element(document.getElementById("selectedValue")).triggerHandler("change"),e.ok()},e.today=function(){t.errorLogMethod("calController.$scope.today");var r=angular.element(document.getElementById("txtcurrentDate"))[0].value;if(""!=r&&null!=r){var n=new Date(r),i=parseInt(a("date")(n,"yyyy")),s=parseInt(a("date")(n,"MM")),o=parseInt(a("date")(n,"dd"));e.dt=new Date(i,s-1,o)}else e.dt=new Date},e.today(),e.$on("updateUiCalSelectedDate",function(a,r){t.errorLogMethod("calController.$scope.$on.updateUiCalSelectedDate"),e.dt=new Date(r.value.valueOf())}),e.selectCalendarDate=function(){for(var r=$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner .liActive").text(),s=$("#dvdatepicker .calendarOver.mobileCalOver .monthContainer .liActive").text(),o=angular.copy(e.currentDateValue);!u(parseInt(r.substring(0,4)),parseInt(d(s))-1,o.getDate());)o.setDate(o.getDate()-1);o=new Date(r.substring(0,4),parseInt(d(s))-1,o.getDate());var l=c.getRevStartEndDateBySelDate(a("date")(o,"yyyy-MM-dd"));if(null!=l)parseInt(E(l.revEndDate).getMonth())!=parseInt(d(s))-1&&o.setDate(E(l.revStartDate).getDate()-1),n.notifyYearUpCalendar(o,!0),p(o);else{var C=a("date")(o,"yyyy-MM-dd"),D=E(C),g=t.GetLoginDetail(!1,!0);i.loadRevenueMonths(g.SESKEY,C,function(e){var t=e.LOADREVM_OUT_OBJ.REVM_ARR,a=null;if(null!=t){for(var r=0;r<t.length;r++)if(null!=t[r]&&void 0!=t[r]&&void 0!=t[r].STRTDTE&&D>=E(t[r].STRTDTE)&&D<=E(t[r].ENDDTE)){a=t[r];break}parseInt(E(a.ENDDTE).getMonth())!=parseInt(d(s))-1&&o.setDate(E(a.STRTDTE).getDate()-1),n.notifyYearUpCalendar(o,!0),p(o)}})}$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner ul li a").click(function(){$("#dvdatepicker .calendarOver.mobileCalOver .yearContainerinner ul li a").removeClass("liActive"),$(this).addClass("liActive")})},e.Chkhours=function(){t.errorLogMethod("calController.$scope.Chkhours"),e.dateSubmitArray.splice(e.dateSubmitArray.indexOf(e.dt.setHours(0,0,0,0)),1),e.dateSubmitArray.push({date:e.dt.setHours(0,0,0,0),hours:e.hours}),r.dateVal=e.dateSubmitArray,e.dateSubmitArray.formats="dd/MM/yyyy",e.hours="",$window.location.reload("/Mercer.MyTime.Web/Calendar.html")};var C=t.GetInitialDetail(!1,!0).EMPL_REC.REQHRS;e.dateError=function(a,r){t.errorLogMethod("calController.$scope.dateError");for(var n=0;n<e.dateSubmitArray.length;n++)if(parseFloat(e.dateSubmitArray[n].HRS)<parseFloat(C)&&new Date(e.dateSubmitArray[n].DTE.substring(0,e.dateSubmitArray[n].DTE.indexOf(" "))).setHours(0,0,0,0)==new Date(a).setHours(0,0,0,0))return!0},e.dateHighlight=function(a,r){t.errorLogMethod("calController.$scope.dateHighlight");for(var n=0;n<e.dateSubmitArray.length;n++)if(parseFloat(e.dateSubmitArray[n].HRS)>=parseFloat(C)&&new Date(e.dateSubmitArray[n].DTE.substring(0,e.dateSubmitArray[n].DTE.indexOf(" "))).setHours(0,0,0,0)==new Date(a).setHours(0,0,0,0))return!0},e.dateChange=function(){t.errorLogMethod("calController.$scope.dateChange"),e.dt=new Date(angular.element(document.getElementById("selectedValue"))[0].value),"true"!=localStorage.calendarchange&&e.ok()},e.showWeeks=!1,e.toggleWeeks=function(){t.errorLogMethod("calController.$scope.toggleWeeks"),e.showWeeks=!e.showWeeks},e.clear=function(){t.errorLogMethod("calController.$scope.clear"),e.dt=null},e.open=function(a){t.errorLogMethod("calController.$scope.open"),a.preventDefault(),a.stopPropagation(),e.opened=!0},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","shortDate"],e.format=e.formats[0],e.$watch("dt",function(){var s=a("date")(new Date(e.dt),"yyyy-MM-dd"),o=[],l=[];if("null"==localStorage.revnotsetup&&void 0!=localStorage.revnotsetup){var c=t.GetLoginDetail(!1,!0);i.loadRevenueMonths(c.SESKEY,s,function(t){void 0!=(l=t.LOADREVM_OUT_OBJ.REVM_ARR)&&"undefined"!=l&&(updDate=new Date(s),updDate=new Date(updDate.getTime()+60*updDate.getTimezoneOffset()*1e3),void 0!=(o=angular.fromJson(l).filter(function(e){if(null!=e&&e.REVM===updDate.getFullYear().toString()+("0"+(updDate.getMonth()+1)).slice(-2).toString())return!0}))&&0!=o.length?void 0!=o[0].STRTDTE&&"undefined"!=o[0].STRTDTE&&("null"!=r.currDate&&void 0!=r.currDate?e.dt=new Date(r.currDate):"null"!=localStorage.SelectedCalendardate&&void 0!=localStorage.SelectedCalendardate&&(e.dt=new Date(localStorage.SelectedCalendardate)),n.notifyUiGrid(e.dt),localStorage.revnotsetup=e.dt):localStorage.SelectedCalendardate=null),r.currDate=null})}"null"!=r.currDate&&void 0!=r.currDate&&(e.dt=r.currDate,localStorage.SelectedCalendardate=e.dt)}),e.ok=function(){s.close()},e.cancel=function(){s.dismiss("cancel")}}]).controller("importCalCtrl",["$rootScope","$filter","$scope","$modalInstance","$state","$rootScope","$timeout","$window","constantService","importCalService","selectedData",function(e,t,a,r,n,e,i,s,o,l,c){var d=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null},p=function(e){if(void 0!=e&&null!=e){var t=(e=e.trim()).split("-"),a=t[2].split(" "),r=a[1].split(":");return new Date(t[0],t[1]-1,a[0],r[0],r[1],r[2])}return new Date},u=function(){this.items=[],this.busy=!0,this.loadMsg="Search Results . . ."};a.importCalObj=new u,a.currentDate="",a.callClick=function(e){var a=(e=p(e)).getTimezoneOffset();e.setMinutes(e.getMinutes()-a),e=t("date")(e,"yyyy-MM-dd"),$(".i"+e).attr("class").indexOf("fa fa-minus")>-1?($(".c"+e).hide(),$(".i"+e).removeClass("fa fa-minus"),$(".i"+e).addClass("fa fa-plus")):($(".c"+e).show(),$(".i"+e).removeClass("fa fa-plus"),$(".i"+e).addClass("fa fa-minus"))},a.CalNoEntryMessage=0,a.initGetCalImport=function(){e.errorLogMethod("importCalCtrl.$scope.initGetCalImport"),a.checkVisibilityFlag=!0;var r=c.isDailyMode?c.currentDate:c.weekStartDate;r.setHours(0,0,0,0);var n=d(c.revEndDate.substring(0,10)),i=d(c.revStartDate.substring(0,10));n.setHours(0,0,0,0),i.setHours(0,0,0,0);var s=new Date(r.valueOf()),p=new Date(s.valueOf());if(c.isDailyMode)p=p.setDate(p.getDate());else{p.setDate(p.getDate()+7);for(var u=0;u<7&&6!=p.getDay();u++)p.setDate(p.getDate()-1);a.weeklyStartDate=c.weekStartDate}var E=p,C=r;p>n&&!c.isDailyMode&&(p=new Date(n.valueOf())),r<i&&(r=new Date(i.valueOf()),s=new Date(r.valueOf()),p=E),c.isDailyMode||(c.currentDate.setHours(0,0,0,0)>n&&c.weekStartDate.setHours(0,0,0,0)<n&&((r=new Date(n.valueOf())).setDate(r.getDate()+1),s=new Date(r.valueOf()),p=E),c.currentDate.setHours(0,0,0,0)<n&&c.weekStartDate.setHours(0,0,0,0)<n&&p>n&&(r=new Date(c.weekStartDate.valueOf()),s=new Date(r.valueOf()),p=new Date(n.valueOf())),c.currentDate.setHours(0,0,0,0)>n&&c.weekStartDate.setHours(0,0,0,0)>=n&&(r=C,s=new Date(r.valueOf()),p=E)),a.isDailyMode=c.isDailyMode,p=new Date(p),s.setHours(0,0,0,0),currentTimezone=s.getTimezoneOffset(),s.setMinutes(s.getMinutes()+currentTimezone),p.setHours(24,0,0,0),currentTimezone=p.getTimezoneOffset(),p.setMinutes(p.getMinutes()+currentTimezone);var D=t("date")(s,"yyyy-MM-dd HH:mm:ss");p=t("date")(p,"yyyy-MM-dd HH:mm:ss"),a.currentDate=c.currentDate;var g=e.GetLoginDetail(!1,!0),v=e.GetInitialDetail(!1,!0);a.CalImportData=[];var m=o.DOMAINNAME;"Y"==c.flag?(null!=localStorage.getItem("calENCKEY")&&void 0!=localStorage.getItem("calENCKEY")||localStorage.setItem("calENCKEY",c.encKey),null!=localStorage.getItem("nonADDomain")&&void 0!=localStorage.getItem("nonADDomain")||localStorage.setItem("nonADDomain",c.domain),m=localStorage.getItem("nonADDomain")):localStorage.setItem("calENCKEY",g.ENCKEY),l.getCalImportEntries(g.SESKEY,localStorage.getItem("calENCKEY"),m,D,p,v.EMPL_REC.EMAIL,v.EMPL_REC.EMAIL).then(function(e){if(0==parseInt(e.RETCALENT_OUT_OBJ.RETCD)){if(void 0==e.RETCALENT_OUT_OBJ.CALI_ARR||0==e.RETCALENT_OUT_OBJ.CALI_ARR.length)return a.importCalObj.busy=!0,a.importCalObj.loadMsg=t("translate")("msg_NoMoreData"),void(a.CalNoEntryMessage=1);if("[object Array]"!=Object.prototype.toString.call(e.RETCALENT_OUT_OBJ.CALI_ARR)){var r=e.RETCALENT_OUT_OBJ.CALI_ARR;e.RETCALENT_OUT_OBJ.CALI_ARR=[],e.RETCALENT_OUT_OBJ.CALI_ARR.push(r.CALI_OBJ)}var n=e.RETCALENT_OUT_OBJ.CALI_ARR,i=a.importCalObj.items.length;if(n.length>0)for(var s=0;s<n.length;s++)0!=n[s].CALID&&(n[s].index=i,a.importCalObj.items.push(n[s]),i++);else"object"==typeof e.RETCALENT_OUT_OBJ.CALI_ARR&&0!=e.RETCALENT_OUT_OBJ.CALI_ARR.CALI_OBJ.CALID&&(e.RETCALENT_OUT_OBJ.CALI_ARR.CALI_OBJ.index=i,a.importCalObj.items.push(e.RETCALENT_OUT_OBJ.CALI_ARR.CALI_OBJ))}else e.RETCALENT_OUT_OBJ.ERRMSG.trim();a.CalNoEntryMessage=2,a.message=e.RETCALENT_OUT_OBJ.ERRMSG})},a.timediff=function(e,t){var a=p(e),r=a.getTimezoneOffset();a.setMinutes(a.getMinutes()-r);var n=p(t),r=n.getTimezoneOffset();return n.setMinutes(n.getMinutes()-r),((n.getTime()-a.getTime())/1e3/60/60).toFixed(2)},a.formatDates=function(e){var t=p(e),a=t.getTimezoneOffset();t.setMinutes(t.getMinutes()-a);var r=t.getHours(),n=t.getMinutes(),i=r>=12?"pm":"am";return(r=(r%=12)||12)+":"+(n=n<10?"0"+n:n)+" "+i},a.viewEntry=function(r,i,s,o){e.importViewed=!0,s=(s=(s=null==s?"":s).replace(/\n/g," ")).replace(/\t/g," "),e.lastCurrentDate=t("date")(c.currentDate,"yyyy-MM-dd"),e.lastExpandAllText=c.lastExpandAllText,e.lastExpandClass=c.lastExpandClass,e.cntrExpandCollapse=2,c.isDailyMode||(e.isPasteClicked=!0,e.weekStateCurrentDate=t("date")(c.currentDate,"yyyy-MM-dd"));var l,d=[],u=p(o),E=u.getTimezoneOffset();u.setMinutes(u.getMinutes()-E);var C=u.getDay();i=a.isDailyMode?i:i+"|"+C,d.push({itemId:r,Hours:i,Description:s}),localStorage.setItem("calDetail_Entry",JSON.stringify(d)),l=a.currentDate,e.isRefresh=!1,n.go("mNewEntry",{startDate:c.isDailyMode?c.currentDate:c.weekStartDate,isDailyMode:c.isDailyMode,IsEditMode:!1,currentDate:l,Hours:i,Description:s,isCalFlg:!0})};var E=0;a.checkVisibility=function(e,r){0==r&&(E=0);var n=p(e),i=n.getTimezoneOffset();n.setMinutes(n.getMinutes()-i);var s=n.getDate();if(s==E)return a.checkVisibilityFlag=!1,"";E=s,a.checkVisibilityFlag=!0;var o=t("date")(n,"yyyy-MM-dd HH:mm:ss");return o=p(o)},a.getStartTime=function(e){var a=p(e),r=a.getTimezoneOffset();return a.setMinutes(a.getMinutes()-r),(a=t("date")(a,"yyyy-MM-dd")).substring(0,10)},a.cancel=function(){e.isCalOpen=!1,r.dismiss("cancel")}}]).controller("ConfirmBroadcastMessage",["$rootScope","$scope","$modalInstance","$state","selectedData","broadcastMessageServices",function(e,t,a,r,n,i){t.popUpName="ConfirmBroadcastMessage",t.selectedData=n,t.isCancelBtnOn=n.isCancelBtnOn,t.ok=function(){e.errorLogMethod("ConfirmBroadcastMessage.$scope.ok");var t=e.GetLoginDetail(!1,!0);i.dismissBroadcastMessage(t.SESKEY,n.messageid).then(function(e){parseInt(0==e.DISBROADM_OUT_OBJ.RETCD)}),a.close()},t.cancel=function(){e.errorLogMethod("ConfirmBroadcastMessage.$scope.cancel"),a.dismiss("cancel")},t.isError=!1,t.message="",t.init=function(){e.errorLogMethod("ConfirmBroadcastMessage.$scope.init"),t.isError=t.selectedData.isError,t.message=t.selectedData.message}}]).controller("multidatepickerCtrl",["$rootScope","$scope","$filter","$modalInstance","broadcastService","selectedData","$timeout","retrieveSharedService",function(e,t,a,r,n,s,o,l){function c(e){var t=new Date(l.getMonthName(e)+" 1, 2000").getMonth();return isNaN(t)?0:t+1}t.IspasteEnabled=!1,t.activeDate=(new Date).setHours(0,0,0,0),t.selectedDates=[],t.arguments=s;var d=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null};t.init=function(){t.currentDateValue=angular.copy(t.arguments.currentDateValue),o(function(){function t(e,t){var a=new Date("sessiontimeout"),r=l.getCurrentRevenueStartEndDate(),n=e;parseInt(a.getMonth())+1>e&&a.getFullYear()==t&&(n=parseInt(d(r.STRTDTE).getMonth()+1)),a.getFullYear()==t&&(e=parseInt(d(r.STRTDTE).getMonth()+1)),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .yearContainerinner").each(function(){$(this).find("li").each(function(){$(this).text()==t&&$(this).children().addClass("liActive"),parseInt($(this).text())<parseInt(t)&&a.getFullYear()>parseInt($(this).text())&&$(this).children().addClass("liDisabled")})}),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer").each(function(){$(this).find("li").each(function(){c($(this).text())==n&&$(this).children().addClass("liActive"),a.getFullYear()==t&&c($(this).text())<e?$(this).children().addClass("liDisabled"):c($(this).text())<parseInt(e)&&a.getFullYear()>parseInt(t)&&$(this).children().addClass("liDisabled")})})}function r(r){var n=e.chekRevDateInLocalStorage(r,a("translate")("msg_invalidSession"),!1);if(null!=n){var i=d(n.ENDDTE);t(parseInt(i.getMonth())+1,i.getFullYear())}else t(parseInt(r.getMonth())+1,r.getFullYear())}var n=parseInt(new Date("sessiontimeout").getFullYear()-1);!function(){for(i=0;i<=2;i++)$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .yearContainerinner #firstColYear").append("<li><a href='javascript:void(0)'>"+n+"</a></li>"),n+=1}(),$(".datepicker-modal-container .pasteAdvCalendar .btn.btn-default.btn-sm.btnMultiDatePickerCal").click(function(){$(".calendarOver.mobileCalOver.pasteAdvCalOver").fadeIn();var e=$(".btnMultiDatePickerCal .ng-binding").text().split(" ");$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").removeClass("liActive"),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .yearContainerinner ul li a").removeClass("liActive"),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").removeClass("liDisabled"),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .yearContainerinner ul li a").removeClass("liDisabled"),r(new Date(e[1],parseInt(c(e[0]))-1,1))}),$(".calendarOver.mobileCalOver.pasteAdvCalOver .selectOC ul li .cancelCalPopup").click(function(){$(".calendarOver.mobileCalOver.pasteAdvCalOver").fadeOut()}),$(".calendarOver.mobileCalOver.pasteAdvCalOver .selectOC .selectCalDate").click(function(){$(".calendarOver.mobileCalOver.pasteAdvCalOver").fadeOut()}),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").click(function(){$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").removeClass("liActive"),$(this).addClass("liActive")}),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthYearCont .yearContainer .yearContainerinner #firstColYear li a").click(function(){$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthYearCont .yearContainer .yearContainerinner #firstColYear li a").removeClass("liActive"),$(this).addClass("liActive");var e=$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .yearContainerinner .liActive").text(),t=$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer .liActive").text();$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").removeClass("liActive"),$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer ul li a").removeClass("liDisabled"),r(new Date(e,parseInt(c(t))-1,1))})},100)},t.paste=function(e){e.length>0&&(t.IsPasteEnabled=!0,r.close(e))},t.reset=function(e){for(var t=e.length,a=0;a<t;a++){var r=new Date(e[a]);e.splice(e.indexOf(r),1),$(".paste-btn").addClass("pasteadvance"),$(".re-btn").addClass("resetadvance")}},t.multidateChange=function(a){0!=a.length?(t.IsPasteEnabled=!0,$(".paste-btn").removeClass("pasteadvance"),$(".re-btn").removeClass("resetadvance")):($(".paste-btn").addClass("pasteadvance"),$(".re-btn").addClass("resetadvance")),e.selDates=a},t.btnMobilePasteAdvOk=function(){var e=$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthYearCont .yearContainer .yearContainerinner #firstColYear .liActive").text(),a=$(".pasteAdvCalendar .calendarOver.mobileCalOver.pasteAdvCalOver .monthContainer .liActive").text(),r=new Date(e.substring(0,4),parseInt(c(a))-1,t.currentDateValue.getDate());n.notifyMultidatepickerSelect(r),GetRevenueYearMonthDetail(r)}}]).controller("importCalLoginCtrl",["$rootScope","$filter","$scope","$modal","loginService","constantService","selectedData",function(e,t,a,r,n,i,s){a.username="",a.domain="mercer",a.password="",a.loginNote="Login using your network username and password.",a.popUpName="importCalLoginCtrl",a.enableLoginFlag=!0,a.animationsEnabled=!0;var o=function(e){if(void 0!=e){var t=e.split("-"),a=t[2].split(" ");return new Date(t[0],t[1]-1,a[0])}return null};a.open=function(t,n,i){e.errorLogMethod("importCalLoginCtrl.$scope.open");r.open({animation:a.animationsEnabled,templateUrl:t,controller:n,resolve:{selectedData:function(){return i}}})},a.IsValue=function(){e.errorLogMethod("importCalLoginCtrl.scope.IsValue"),""!=a.username&&""!=a.password&&""!=a.domain?(a.enableLoginFlag=!1,$("#loginbtnImport").removeAttr("disabled")):(a.enableLoginFlag=!0,$("#loginbtnImport").attr("disabled",!0))},a.resetField=function(e){"dom"==e?a.domain="":a.username="",a.IsValue()},a.checkDisable=function(){return e.errorLogMethod("importCalLoginCtrl.scope.checkDisable"),a.enableLoginFlag},a.cancel=function(){a.$close()},a.login=function(){e.errorLogMethod("importCalLoginCtrl.scope.login");var r=JSON.parse(localStorage.getItem("Login_Detail")),l=(s.currentDate,s.isDailyMode,s.weeklyStartDate,escape(a.username)),c=e.GetLoginDetail(!1,!0),d=new Date(s.currentDate.valueOf());d=t("date")(d,"yyyy-MM-dd");var p=JSON.parse(localStorage.getItem("Revenue_Months_ImportCal")),u=null;if(null!=p){var E=new Date(d);E=new Date(E.getTime()+60*E.getTimezoneOffset()*1e3),u=angular.fromJson(p).filter(function(e){if(null!=e&&E>=o(e.STRTDTE)&&E<=o(e.ENDDTE))return!0})}null!=u&&void 0!=u&&0!=u.length&&(a.revStartDate=u[0].STRTDTE,a.revEndDate=u[0].ENDDTE),n.nonADlogin(c.SESKEY,l,a.password,a.domain,function(e){if(0==parseInt(e.GETENCRYPT_OUT_OBJ.RETCD))if(e.GETENCRYPT_OUT_OBJ.CCMAIL==JSON.parse(localStorage.getItem("Initial_Data")).EMPL_REC.EMAIL){localStorage.setItem("nonADLogin","Y"),a.$close();var t={currentDate:s.currentDate,isDailyMode:s.isDailyMode,weekCurrentDate:s.weekCurrentDate,weekStartDate:s.weekStartDate,flag:"Y"==r.ISNONAD?"Y":"N",encKey:e.GETENCRYPT_OUT_OBJ.ENCKEY,revStartDate:a.revStartDate,revEndDate:a.revEndDate,lastExpandAllText:s.lastExpandAllText,lastExpandClass:s.lastExpandClass,domain:a.domain};a.openModalCtrl="importCalCtrl",a.open("templates/ImportCalEntries.html","importCalCtrl",t)}else a.message=i.SHAREDCALMSG1+e.GETENCRYPT_OUT_OBJ.CCMAIL+i.SHAREDCALMSG2;else e.GETENCRYPT_OUT_OBJ.ERRMSG.trim().toLowerCase().indexOf("invalid credentials")>-1||e.GETENCRYPT_OUT_OBJ.ERRMSG.trim().toLowerCase().indexOf("invalid login")>-1||e.GETENCRYPT_OUT_OBJ.ERRMSG.trim().toLowerCase().indexOf("invalid user credentials")>-1?a.message=i.nonADinvalidMsg:""!=e.GETENCRYPT_OUT_OBJ.ERRMSG.trim()&&(a.message=e.GETENCRYPT_OUT_OBJ.ERRMSG)})}}]);